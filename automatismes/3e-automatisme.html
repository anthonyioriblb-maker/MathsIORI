<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Emp√™cher la mise en cache du fichier -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>G√©n√©rateur de Questions - Automatismes DNB</title>

    <!-- Scratchblocks pour le rendu des blocs Scratch -->
    <link rel="stylesheet" href="../scratch/lib/scratchblocks.css?v=20241125v2">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .content {
            padding: 20px;
        }

        .theme-selection {
            margin-bottom: 20px;
        }

        .theme-selection h2 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.3em;
        }

        .themes-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .theme-category {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            border: 2px solid #e9ecef;
        }

        .theme-category-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            user-select: none;
        }

        .theme-category-header:hover {
            opacity: 0.8;
        }

        .theme-category-icon {
            font-size: 1.3em;
        }

        .theme-category-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
            flex: 1;
        }

        .theme-category-toggle {
            font-size: 0.85em;
            color: #6c757d;
        }

        .sous-themes-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .sous-theme-group {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #764ba2;
        }

        .sous-theme-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 6px;
            font-size: 0.9em;
        }

        .theme-checkbox {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            margin-bottom: 4px;
        }

        .theme-checkbox:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .theme-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
        }

        .theme-checkbox label {
            cursor: pointer;
            font-weight: 500;
            color: #333;
            font-size: 0.95em;
        }

        .theme-checkbox input[type="checkbox"]:checked + label {
            color: #667eea;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .questions-container {
            margin-top: 30px;
            display: none;
        }

        .questions-container.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .question-item {
            margin-bottom: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .question-item:nth-child(even) {
            border-left-color: #764ba2;
        }

        .question-number {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-item .theme-badge {
            display: inline-block;
            background: #764ba2;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-left: 10px;
        }

        .question-item .question-text {
            font-size: 1.2em;
            color: #333;
            margin: 15px 0;
            line-height: 1.6;
            font-weight: 500;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-box .label {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .stat-box .value {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
        }

        .select-all-btn {
            margin-bottom: 10px;
        }

        .question-count-section {
            margin: 15px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .question-count-section label {
            font-weight: 600;
            color: #667eea;
            font-size: 1em;
        }

        .question-count-section input[type="number"] {
            width: 70px;
            padding: 8px;
            font-size: 1em;
            border: 2px solid #667eea;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }

        .question-count-section input[type="number"]:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .print-buttons {
            display: none;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .print-buttons.active {
            display: flex;
        }

        .btn-print {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-correction {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-correction:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        @media print {
            @page {
                size: A4;
                margin: 0.5cm;
            }

            * {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            body {
                background: white;
                margin: 0;
                padding: 0;
                font-size: 10pt;
            }

            .container {
                box-shadow: none;
                border-radius: 0;
                max-width: 100%;
            }

            .header,
            .theme-selection,
            .question-count-section,
            .buttons,
            .stats,
            .print-buttons,
            .exam-timer,
            .no-print {
                display: none !important;
            }

            .content {
                padding: 0;
                margin: 0;
            }

            .question-item {
                page-break-inside: avoid;
                margin-bottom: 5px;
                padding: 4px 6px;
                background: #fafafa !important;
                border-left: 2px solid #667eea !important;
                border-radius: 3px;
            }

            .question-number {
                font-size: 8pt;
                padding: 1px 6px;
                margin-bottom: 2px;
            }

            .theme-badge {
                font-size: 7pt !important;
                padding: 1px 4px !important;
                margin-left: 4px !important;
            }

            .question-text {
                font-size: 10pt !important;
                margin: 4px 0 !important;
                line-height: 1.2 !important;
            }

            /* R√©duire la taille des SVG pour l'impression */
            .question-item svg.number-line {
                width: 300px !important;
                height: 40px !important;
                margin: 3px auto !important;
            }

            .question-item svg.graph {
                width: 250px !important;
                height: 180px !important;
                margin: 3px auto !important;
            }

            .question-item svg text {
                font-size: 8px !important;
            }

            .question-item svg line {
                stroke-width: 0.8px !important;
            }

            .question-item svg circle {
                r: 2.5 !important;
            }

            .question-item svg path {
                stroke-width: 1.2px !important;
            }

            /* R√©duire la taille des fractions */
            .fraction {
                font-size: 0.85em !important;
            }

            /* Optimiser les tableaux pour l'impression */
            .question-item table {
                font-size: 9pt !important;
                margin: 4px auto !important;
            }

            .question-item table td {
                padding: 3px 6px !important;
                border: 1.5px solid #667eea !important;
            }

            .correction-space {
                min-height: 35px;
                border-top: 1px dashed #ccc;
                margin-top: 4px;
                padding-top: 4px;
                font-size: 9pt;
            }

            .correction-space::before {
                content: "R√©ponse : ";
                font-style: italic;
                color: #666;
            }

            .answer-section {
                font-size: 9pt !important;
                padding: 4px !important;
                margin-top: 4px !important;
            }

            .answer-section strong {
                font-size: 9pt !important;
            }

            .answer-text {
                margin-top: 3px !important;
                font-size: 9pt !important;
            }

            /* Optimiser les blocs Scratch pour l'impression */
            .question-item pre.blocks {
                font-size: 9pt !important;
                margin: 4px 0 !important;
                padding: 4px !important;
            }

            .question-item pre.blocks svg {
                max-width: 100% !important;
                height: auto !important;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .themes-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Styles pour les fractions */
        .fraction {
            display: inline-flex;
            flex-direction: column;
            vertical-align: middle;
            text-align: center;
            font-size: 1em;
            line-height: 1;
            margin: 0 0.1em;
        }

        .fraction .numerator {
            border-bottom: 1px solid #333;
            padding: 0 0.3em 0.1em;
            font-size: 0.9em;
        }

        .fraction .denominator {
            padding: 0.1em 0.3em 0;
            font-size: 0.9em;
        }

        .answer-section {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #d4edda;
            border-left: 4px solid #28a745;
            border-radius: 8px;
        }

        .answer-section.visible {
            display: block;
        }

        .answer-section strong {
            color: #155724;
        }

        .answer-text {
            color: #155724;
            margin-top: 8px;
            font-weight: 500;
        }

        .btn-show-answers {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #000;
        }

        .btn-show-answers:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        @media print {
            .answer-section.print-mode {
                display: block !important;
            }
        }

        /* Styles pour le mode examen */
        .btn-exam {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-exam:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .exam-timer {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            font-size: 2em;
            font-weight: bold;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        .exam-timer.active {
            display: block;
        }

        .exam-timer.warning {
            background: linear-gradient(135deg, #ff9800 0%, #ff6b00 100%);
            animation: pulse 1s infinite;
        }

        .exam-timer.critical {
            background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .exam-mode-active .theme-selection,
        .exam-mode-active .question-count-section,
        .exam-mode-active .buttons .btn-primary {
            opacity: 0.5;
            pointer-events: none;
        }

        .exam-timer-label {
            font-size: 0.5em;
            display: block;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .btn-stop-exam {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
        }

        .btn-stop-exam:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Timer pour le mode examen -->
    <div class="exam-timer" id="examTimer">
        <span class="exam-timer-label">‚è±Ô∏è Temps restant</span>
        <span id="timerDisplay">20:00</span>
    </div>

    <div class="container">
        <div class="header">
            <h1>üìê G√©n√©rateur de Questions</h1>
            <p>Automatismes pour le Dipl√¥me National du Brevet</p>
        </div>

        <div class="content">
            <div class="theme-selection">
                <h2>S√©lectionnez les th√®mes :</h2>

                <div class="buttons select-all-btn">
                    <button class="btn btn-success" onclick="selectAllThemes()">Tout s√©lectionner</button>
                    <button class="btn btn-secondary" onclick="deselectAllThemes()">Tout d√©s√©lectionner</button>
                </div>

                <div class="themes-grid" id="themesGrid"></div>
            </div>

            <div class="question-count-section">
                <label for="questionCount">Nombre de questions :</label>
                <input type="number" id="questionCount" min="1" max="50" value="1">
            </div>

            <div class="buttons">
                <button class="btn btn-primary" onclick="generateQuestions()">üé≤ G√©n√©rer les questions</button>
                <button class="btn btn-exam" id="examButton" onclick="startExamMode()">‚è±Ô∏è Mode Examen Blanc (20 min)</button>
                <button class="btn btn-stop-exam" id="stopExamButton" onclick="stopExamMode()" style="display: none;">‚èπÔ∏è Arr√™ter l'examen</button>
                <button class="btn btn-secondary" onclick="resetStats()">üîÑ R√©initialiser</button>
            </div>

            <div class="stats" id="statsSection" style="display: none;">
                <div class="stat-box">
                    <div class="label">Questions g√©n√©r√©es</div>
                    <div class="value" id="questionsCount">0</div>
                </div>
            </div>

            <div class="print-buttons" id="printButtons">
                <button class="btn btn-print" onclick="printQuestions()">üñ®Ô∏è Imprimer les questions</button>
                <button class="btn btn-correction" onclick="printWithCorrection()">üìù Imprimer avec espace correction</button>
                <button class="btn btn-show-answers" onclick="toggleAnswers()">üëÅÔ∏è Afficher/Masquer le corrig√©</button>
                <button class="btn btn-print" onclick="printAnswers()">üñ®Ô∏è Imprimer le corrig√©</button>
            </div>

            <div class="questions-container" id="questionsContainer">
            </div>
        </div>
    </div>

    <!-- Biblioth√®que Scratchblocks pour le rendu des blocs (charg√©e AVANT le script principal) -->
    <script src="../scratch/lib/scratchblocks.min.js?v=20241125v2"></script>
    <script src="../scratch/lib/translations-all.js?v=20241125v2"></script>

    <script>
        // Utilitaires pour g√©n√©rer des nombres al√©atoires
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randChoice(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function randDecimal(min, max, decimals = 1) {
            const num = Math.random() * (max - min) + min;
            return Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
        }

        // Fonction pour convertir un nombre en notation fran√ßaise (virgule au lieu du point)
        function toFrenchNumber(num) {
            const str = num.toString();
            const parts = str.split('.');

            // Partie enti√®re avec espaces pour les milliers
            let integerPart = parts[0];
            const isNegative = integerPart.startsWith('-');
            if (isNegative) {
                integerPart = integerPart.substring(1);
            }

            // Ajouter les espaces tous les 3 chiffres (de droite √† gauche)
            integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');

            if (isNegative) {
                integerPart = '-' + integerPart;
            }

            // Partie d√©cimale avec virgule
            if (parts.length > 1) {
                return integerPart + ',' + parts[1];
            }

            return integerPart;
        }

        // Fonction pour calculer le PGCD
        function pgcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b !== 0) {
                const temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        // Fonction pour simplifier une fraction
        function simplifyFraction(numerator, denominator) {
            const gcd = pgcd(numerator, denominator);
            return {
                num: numerator / gcd,
                den: denominator / gcd
            };
        }

        // Fonction pour formater les fractions en HTML
        function formatFraction(numerator, denominator) {
            return `<span class="fraction"><span class="numerator">${numerator}</span><span class="denominator">${denominator}</span></span>`;
        }

        // Fonction pour g√©n√©rer des blocs Scratch - EXACTEMENT comme scratch/4e/4-activite1-correction.html
        function generateScratchBlocks(code) {
            return `<pre class="blocks">${code}</pre>`;
        }

        // Fonction pour g√©n√©rer un tableau HTML de proportionnalit√©
        function generateProportionalityTable(row1Values, row2Values, row1Label = "", row2Label = "") {
            let table = `<table style="border-collapse: collapse; margin: 15px auto; text-align: center; font-size: 1.1em;">`;

            // Premi√®re ligne (en-t√™te optionnel + valeurs)
            table += `<tr>`;
            if (row1Label) {
                table += `<td style="border: 2px solid #667eea; padding: 8px 12px; background: #f0f0f0; font-weight: bold;">${row1Label}</td>`;
            }
            for (let val of row1Values) {
                const displayVal = val === "?" ? "?" : (typeof val === 'number' && val % 1 !== 0 ? toFrenchNumber(val) : val);
                const cellContent = displayVal === "?" ? `<span style="color: red; font-weight: bold; font-size: 1.3em;">${displayVal}</span>` : displayVal;
                table += `<td style="border: 2px solid #667eea; padding: 8px 12px; background: #f8f9fa;">${cellContent}</td>`;
            }
            table += `</tr>`;

            // Deuxi√®me ligne (en-t√™te optionnel + valeurs)
            table += `<tr>`;
            if (row2Label) {
                table += `<td style="border: 2px solid #667eea; padding: 8px 12px; background: #f0f0f0; font-weight: bold;">${row2Label}</td>`;
            }
            for (let val of row2Values) {
                const displayVal = val === "?" ? "?" : (typeof val === 'number' && val % 1 !== 0 ? toFrenchNumber(val) : val);
                const cellContent = displayVal === "?" ? `<span style="color: red; font-weight: bold; font-size: 1.3em;">${displayVal}</span>` : displayVal;
                table += `<td style="border: 2px solid #667eea; padding: 8px 12px; background: #f8f9fa;">${cellContent}</td>`;
            }
            table += `</tr>`;

            table += `</table>`;
            return table;
        }

        // Fonction pour g√©n√©rer un graphique simple en SVG
        function generateGraph(points, title = "", xLabel = "x", yLabel = "y", showPoint = null) {
            const width = 400;
            const height = 300;
            const marginLeft = 50;
            const marginRight = 30;
            const marginTop = 30;
            const marginBottom = 40;
            const graphWidth = width - marginLeft - marginRight;
            const graphHeight = height - marginTop - marginBottom;

            // Trouver les valeurs min/max
            let minX = Math.min(...points.map(p => p.x));
            let maxX = Math.max(...points.map(p => p.x));
            let minY = 0;
            let maxY = Math.max(...points.map(p => p.y)) * 1.1; // 10% de marge

            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg" style="display: block; margin: 10px auto; background: white;" class="graph">`;

            // Axes
            svg += `<line x1="${marginLeft}" y1="${height - marginBottom}" x2="${width - marginRight}" y2="${height - marginBottom}" stroke="#333" stroke-width="2"/>`;
            svg += `<line x1="${marginLeft}" y1="${marginTop}" x2="${marginLeft}" y2="${height - marginBottom}" stroke="#333" stroke-width="2"/>`;

            // Fl√®ches
            svg += `<polygon points="${width - marginRight + 5},${height - marginBottom} ${width - marginRight},${height - marginBottom - 4} ${width - marginRight},${height - marginBottom + 4}" fill="#333"/>`;
            svg += `<polygon points="${marginLeft},${marginTop - 5} ${marginLeft - 4},${marginTop} ${marginLeft + 4},${marginTop}" fill="#333"/>`;

            // Labels des axes
            svg += `<text x="${width - marginRight + 10}" y="${height - marginBottom + 5}" font-size="12" fill="#333">${xLabel}</text>`;
            svg += `<text x="${marginLeft - 10}" y="${marginTop - 10}" font-size="12" fill="#333">${yLabel}</text>`;

            // Graduations et labels sur axe X
            for (let x = minX; x <= maxX; x++) {
                const px = marginLeft + ((x - minX) / (maxX - minX)) * graphWidth;
                svg += `<line x1="${px}" y1="${height - marginBottom - 3}" x2="${px}" y2="${height - marginBottom + 3}" stroke="#333" stroke-width="1"/>`;
                svg += `<text x="${px}" y="${height - marginBottom + 18}" text-anchor="middle" font-size="11" fill="#333">${x}</text>`;
            }

            // Graduations sur axe Y (tous les 5 ou 10)
            const stepY = maxY > 20 ? 10 : 5;
            for (let y = 0; y <= maxY; y += stepY) {
                const py = height - marginBottom - ((y - minY) / (maxY - minY)) * graphHeight;
                svg += `<line x1="${marginLeft - 3}" y1="${py}" x2="${marginLeft + 3}" y2="${py}" stroke="#333" stroke-width="1"/>`;
                svg += `<text x="${marginLeft - 8}" y="${py + 4}" text-anchor="end" font-size="11" fill="#333">${Math.round(y)}</text>`;
            }

            // Tracer la courbe
            let pathData = "";
            points.forEach((point, i) => {
                const px = marginLeft + ((point.x - minX) / (maxX - minX)) * graphWidth;
                const py = height - marginBottom - ((point.y - minY) / (maxY - minY)) * graphHeight;
                if (i === 0) {
                    pathData += `M ${px} ${py}`;
                } else {
                    pathData += ` L ${px} ${py}`;
                }
            });
            svg += `<path d="${pathData}" stroke="#667eea" stroke-width="2" fill="none"/>`;

            // Afficher un point sp√©cifique si demand√©
            if (showPoint) {
                const px = marginLeft + ((showPoint.x - minX) / (maxX - minX)) * graphWidth;
                const py = height - marginBottom - ((showPoint.y - minY) / (maxY - minY)) * graphHeight;
                svg += `<circle cx="${px}" cy="${py}" r="4" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>`;
                svg += `<text x="${px + 10}" y="${py - 10}" font-size="11" font-weight="bold" fill="#e74c3c">(${toFrenchNumber(showPoint.x)} ; ${toFrenchNumber(showPoint.y)})</text>`;
            }

            svg += `</svg>`;
            return svg;
        }

        // Fonction pour g√©n√©rer un triangle rectangle en SVG
        function generateRightTriangle(a, b, c, labelA = "a", labelB = "b", labelC = "c", showRightAngle = true) {
            const scale = 30; // pixels par unit√©
            const width = Math.max(a, b) * scale + 100;
            const height = Math.max(a, b) * scale + 80;
            const marginLeft = 40;
            const marginBottom = 40;

            // Position des sommets (triangle rectangle en bas √† gauche)
            const x1 = marginLeft;
            const y1 = height - marginBottom; // Coin en bas √† gauche (angle droit)
            const x2 = x1 + (b * scale); // Coin en bas √† droite
            const y2 = y1;
            const x3 = x1; // Coin en haut √† gauche
            const y3 = y1 - (a * scale);

            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg" style="display: block; margin: 15px auto; background: white;" class="triangle">`;

            // Tracer le triangle
            svg += `<path d="M ${x1} ${y1} L ${x2} ${y2} L ${x3} ${y3} Z" stroke="#2c3e50" stroke-width="2" fill="#ecf0f1" fill-opacity="0.3"/>`;

            // Marquer l'angle droit
            if (showRightAngle) {
                const squareSize = 12;
                svg += `<rect x="${x1}" y="${y1 - squareSize}" width="${squareSize}" height="${squareSize}" fill="none" stroke="#e74c3c" stroke-width="1.5"/>`;
            }

            // Labels des c√¥t√©s
            // C√¥t√© a (vertical gauche)
            svg += `<text x="${x1 - 15}" y="${(y1 + y3) / 2}" text-anchor="middle" font-size="14" font-weight="bold" fill="#667eea">${labelA}</text>`;

            // C√¥t√© b (horizontal bas)
            svg += `<text x="${(x1 + x2) / 2}" y="${y1 + 25}" text-anchor="middle" font-size="14" font-weight="bold" fill="#667eea">${labelB}</text>`;

            // C√¥t√© c (hypot√©nuse)
            const midX = (x2 + x3) / 2;
            const midY = (y2 + y3) / 2;
            svg += `<text x="${midX + 15}" y="${midY}" text-anchor="middle" font-size="14" font-weight="bold" fill="#e74c3c">${labelC}</text>`;

            svg += `</svg>`;
            return svg;
        }

        // Fonction pour g√©n√©rer une droite gradu√©e en SVG
        function generateNumberLine(min, max, step, targetValue, showPoint = false) {
            const width = 500;
            const height = 80;
            const marginLeft = 35;
            const marginRight = 35;
            const lineY = 40;
            const lineWidth = width - marginLeft - marginRight;

            // Calculer la position du point
            const range = max - min;
            const pointX = marginLeft + ((targetValue - min) / range) * lineWidth;

            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg" style="display: block; margin: 10px auto;" class="number-line">`;

            // Ligne principale
            svg += `<line x1="${marginLeft}" y1="${lineY}" x2="${width - marginRight}" y2="${lineY}" stroke="#333" stroke-width="1.5"/>`;

            // Fl√®ches aux extr√©mit√©s
            svg += `<polygon points="${marginLeft-4},${lineY} ${marginLeft},${lineY-4} ${marginLeft},${lineY+4}" fill="#333"/>`;
            svg += `<polygon points="${width-marginRight+4},${lineY} ${width-marginRight},${lineY-4} ${width-marginRight},${lineY+4}" fill="#333"/>`;

            // Graduations et labels
            for (let val = min; val <= max; val += step) {
                const x = marginLeft + ((val - min) / range) * lineWidth;
                svg += `<line x1="${x}" y1="${lineY - 6}" x2="${x}" y2="${lineY + 6}" stroke="#333" stroke-width="1.2"/>`;
                svg += `<text x="${x}" y="${lineY + 20}" text-anchor="middle" font-size="11" fill="#333">${toFrenchNumber(val)}</text>`;
            }

            // Point (seulement si showPoint = true, pour la correction)
            if (showPoint) {
                svg += `<circle cx="${pointX}" cy="${lineY}" r="4" fill="#e74c3c" stroke="#c0392b" stroke-width="1.5"/>`;
                svg += `<text x="${pointX}" y="${lineY - 12}" text-anchor="middle" font-size="10" font-weight="bold" fill="#e74c3c">‚Ä¢</text>`;
            }

            svg += `</svg>`;
            return svg;
        }

        // STRUCTURE HI√âRARCHIQUE DES TH√àMES - CONFORME AU PROGRAMME DNB 2026
        const themesHierarchie = {
            "NOMBRES ET CALCULS": {
                icon: "üî¢",
                sousThemes: {
                    "Fractions et nombres d√©cimaux": [
                        "√âcriture d√©cimale des fractions simples",
                        "Comparer et calculer avec des nombres d√©cimaux",
                        "Tiers, quart, cinqui√®me d'un nombre"
                    ],
                    "Nombres relatifs": ["Nombres relatifs"],
                    "Puissances et racines": ["Carr√©s des nombres de 1 √† 12", "Notation scientifique"],
                    "Arithm√©tique": ["Crit√®res de divisibilit√©", "D√©composition en facteurs premiers et PGCD"],
                    "Pourcentages": ["Pourcentages - conversions", "Pourcentages - augmentation et diminution"],
                    "Calcul litt√©ral": [
                        "Expressions autour d'un nombre entier",
                        "D√©velopper et r√©duire des expressions litt√©rales",
                        "Calculer la valeur d'une expression alg√©brique",
                        "D√©velopper et factoriser"
                    ],
                    "√âquations": ["R√©soudre des √©quations simples"],
                    "QCM": ["QCM - Calculs et op√©rations"]
                }
            },
            "ESPACE ET G√âOM√âTRIE": {
                icon: "üìê",
                sousThemes: {
                    "Rep√©rage": ["Rep√®re orthogonal", "Droite gradu√©e - lecture d'abscisse"],
                    "Figures planes - Propri√©t√©s": ["Exploiter le codage d'une figure", "Angles", "Somme des angles d'un triangle"],
                    "Figures planes - Mesures": ["P√©rim√®tres", "Aires"],
                    "Solides": ["Volumes"],
                    "Th√©or√®mes": ["Th√©or√®me de Pythagore", "Th√©or√®me de Thal√®s"],
                    "Trigonom√©trie": ["Trigonom√©trie - Cosinus", "Trigonom√©trie - Sinus et Tangente"],
                    "Transformations": ["Sym√©tries", "Translations"]
                }
            },
            "GRANDEURS ET MESURES": {
                icon: "üìè",
                sousThemes: {
                    "Conversions et calculs": ["Conversions d'unit√©s"]
                }
            },
            "ORGANISATION ET GESTION DE DONN√âES": {
                icon: "üìä",
                sousThemes: {
                    "Statistiques": ["Moyenne", "M√©diane", "Effectif total et diagrammes", "Lire tableaux et graphiques"],
                    "Probabilit√©s": ["Probabilit√©s simples", "Fr√©quence"]
                }
            },
            "PROPORTIONNALIT√â ET FONCTIONS": {
                icon: "üìà",
                sousThemes: {
                    "Proportionnalit√©": ["Reconna√Ætre une situation de proportionnalit√©", "R√©soudre un probl√®me de proportionnalit√©"],
                    "Fonctions": ["Reconna√Ætre fonctions lin√©aire, affine, constante - par formule", "Reconna√Ætre fonctions lin√©aire, affine, constante - par graphique", "Exploiter un graphique", "Calculer une image par une fonction", "Calcul d'ant√©c√©dent"],
                    "Pourcentages": ["Pourcentages - calcul mental", "Pourcentages - augmentation et diminution"]
                }
            },
            "ALGORITHMIQUE ET PROGRAMMATION": {
                icon: "üíª",
                sousThemes: {
                    "Programmes de calcul": ["Programmes de calcul"],
                    "Scratch": ["G√©om√©trie avec Scratch"]
                }
            }
        };

        // G√©n√©rateurs de questions avec valeurs al√©atoires
        // Les g√©n√©rateurs peuvent retourner :
        // - Un objet {question, answer} pour une question simple
        // - Un tableau [{question, answer}, {question, answer}] pour une paire th√©orie-pratique
        const automatismes = {
            "Nombres et calculs": [
                {
                    desc: "√âcriture d√©cimale des fractions simples",
                    generator: () => {
                        const fractions = [
                            {n: 1, d: 2}, {n: 1, d: 4}, {n: 3, d: 4},
                            {n: 3, d: 2}, {n: 4, d: 2}, {n: 5, d: 2},
                            {n: 1, d: 10}, {n: 100, d: 100}, {n: 7, d: 1}
                        ];
                        const f = randChoice(fractions);
                        const result = toFrenchNumber(f.n / f.d);
                        return {
                            question: `Donner l'√©criture d√©cimale de ${formatFraction(f.n, f.d)}`,
                            answer: result
                        };
                    }
                },
                {
                    desc: "Calcul mental - multiplications et divisions",
                    generator: () => {
                        const ops = [
                            // Tables de multiplication simples
                            () => {
                                const a = randInt(2, 12);
                                const b = randInt(2, 12);
                                return {
                                    question: `Calculer : ${a} √ó ${b}`,
                                    answer: `${a * b}`
                                };
                            },
                            // Multiplier par 10, 100, 1000
                            () => {
                                const a = randInt(2, 99);
                                const mult = randChoice([10, 100, 1000]);
                                return {
                                    question: `Calculer : ${a} √ó ${mult}`,
                                    answer: `${a * mult}`
                                };
                            },
                            // Diviser par 10, 100
                            () => {
                                const mult = randChoice([10, 100]);
                                const a = randInt(2, 20) * mult;
                                return {
                                    question: `Calculer : ${a} √∑ ${mult}`,
                                    answer: `${a / mult}`
                                };
                            },
                            // Doubles simples
                            () => {
                                const a = randChoice([5, 10, 15, 20, 25, 30, 40, 50]);
                                return {
                                    question: `Calculer le double de ${a}`,
                                    answer: `${a * 2}`
                                };
                            },
                            // Moiti√©s simples
                            () => {
                                const a = randChoice([10, 20, 30, 40, 50, 60, 80, 100]);
                                return {
                                    question: `Calculer la moiti√© de ${a}`,
                                    answer: `${a / 2}`
                                };
                            },
                            // Additions simples avec 100
                            () => {
                                const a = randInt(10, 90);
                                return {
                                    question: `Calculer : 100 - ${a}`,
                                    answer: `${100 - a}`
                                };
                            },
                            // Multiplier par 5
                            () => {
                                const a = randChoice([4, 6, 8, 10, 12, 14, 16, 20]);
                                return {
                                    question: `Calculer : ${a} √ó 5`,
                                    answer: `${a * 5}`
                                };
                            },
                            // Diviser par 5
                            () => {
                                const a = randChoice([20, 25, 30, 35, 40, 45, 50]);
                                return {
                                    question: `Calculer : ${a} √∑ 5`,
                                    answer: `${a / 5}`
                                };
                            },
                            // Carr√© de nombres simples
                            () => {
                                const a = randChoice([5, 10, 12, 15, 20, 25]);
                                return {
                                    question: `Calculer : ${a}¬≤`,
                                    answer: `${a * a}`
                                };
                            },
                            // Additions/soustractions mentales
                            () => {
                                const a = randInt(10, 50);
                                const b = randInt(5, 30);
                                return {
                                    question: `Calculer : ${a} + ${b}`,
                                    answer: `${a + b}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Comparer et calculer avec des nombres d√©cimaux",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randDecimal(-5, 5);
                                const b = randDecimal(-5, 5);
                                const result = a + b;
                                return {
                                    question: `Calculer : ${toFrenchNumber(a)} + (${toFrenchNumber(b)})`,
                                    answer: toFrenchNumber(result)
                                };
                            },
                            () => {
                                const a = randDecimal(1, 10);
                                const b = randDecimal(1, 5);
                                const result = a * b;
                                return {
                                    question: `Calculer : ${toFrenchNumber(a)} √ó ${toFrenchNumber(b)}`,
                                    answer: toFrenchNumber(result)
                                };
                            },
                            () => {
                                const a = randDecimal(-10, 10);
                                const b = randDecimal(-10, 10);
                                const comparison = a < b ? `${toFrenchNumber(a)} < ${toFrenchNumber(b)}` : a > b ? `${toFrenchNumber(a)} > ${toFrenchNumber(b)}` : `${toFrenchNumber(a)} = ${toFrenchNumber(b)}`;
                                return {
                                    question: `Comparer ${toFrenchNumber(a)} et ${toFrenchNumber(b)}`,
                                    answer: comparison
                                };
                            },
                            () => {
                                const nums = [randDecimal(-5, 5), randDecimal(-5, 5), randDecimal(-5, 5), randDecimal(-5, 5)];
                                const sorted = [...nums].sort((a, b) => a - b);
                                return {
                                    question: `Ranger dans l'ordre croissant : ${nums.map(toFrenchNumber).join(' ; ')}`,
                                    answer: sorted.map(toFrenchNumber).join(' < ')
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Nombres relatifs",
                    generator: () => {
                        const ops = [
                            // Addition de relatifs
                            () => {
                                const a = randInt(-10, 10);
                                const b = randInt(-10, 10);
                                const result = a + b;
                                return {
                                    question: `Calculer : ${a} + (${b})`,
                                    answer: `${result}`
                                };
                            },
                            // Soustraction de relatifs
                            () => {
                                const a = randInt(-10, 10);
                                const b = randInt(-10, 10);
                                const result = a - b;
                                return {
                                    question: `Calculer : ${a} - (${b})`,
                                    answer: `${a} - (${b}) = ${a} + (${-b}) = ${result}`
                                };
                            },
                            // Multiplication de relatifs (m√™me signe)
                            () => {
                                const a = randInt(-8, -2);
                                const b = randInt(-8, -2);
                                const result = a * b;
                                return {
                                    question: `Calculer : (${a}) √ó (${b})`,
                                    answer: `${result}<br><em>R√®gle : (-) √ó (-) = (+)</em>`
                                };
                            },
                            // Multiplication de relatifs (signes diff√©rents)
                            () => {
                                const a = randInt(-8, -2);
                                const b = randInt(2, 8);
                                const result = a * b;
                                return {
                                    question: `Calculer : (${a}) √ó ${b}`,
                                    answer: `${result}<br><em>R√®gle : (-) √ó (+) = (-)</em>`
                                };
                            },
                            // Multiplication positifs
                            () => {
                                const a = randInt(2, 9);
                                const b = randInt(2, 9);
                                const result = a * b;
                                return {
                                    question: `Calculer : ${a} √ó ${b}`,
                                    answer: `${result}<br><em>R√®gle : (+) √ó (+) = (+)</em>`
                                };
                            },
                            // Division de relatifs (m√™me signe)
                            () => {
                                const b = randInt(2, 8);
                                const result = randInt(2, 8);
                                const a = b * result;
                                return {
                                    question: `Calculer : (${-a}) √∑ (${-b})`,
                                    answer: `${result}<br><em>R√®gle : (-) √∑ (-) = (+)</em>`
                                };
                            },
                            // Division de relatifs (signes diff√©rents)
                            () => {
                                const b = randInt(2, 8);
                                const result = randInt(2, 8);
                                const a = b * result;
                                return {
                                    question: `Calculer : (${-a}) √∑ ${b}`,
                                    answer: `${-result}<br><em>R√®gle : (-) √∑ (+) = (-)</em>`
                                };
                            },
                            // Oppos√© d'un nombre
                            () => {
                                const a = randInt(-10, 10);
                                return {
                                    question: `Quel est l'oppos√© de ${a} ?`,
                                    answer: `${-a}`
                                };
                            },
                            // Distance √† z√©ro (valeur absolue)
                            () => {
                                const a = randInt(-15, -1);
                                return {
                                    question: `Quelle est la distance √† z√©ro de ${a} ?`,
                                    answer: `${-a}<br><em>La distance √† z√©ro est toujours positive</em>`
                                };
                            },
                            () => {
                                const a = randInt(1, 15);
                                return {
                                    question: `Quelle est la distance √† z√©ro de ${a} ?`,
                                    answer: `${a}`
                                };
                            },
                            // Op√©ration combin√©e simple
                            () => {
                                const a = randInt(-5, 5);
                                const b = randInt(-5, 5);
                                const c = randInt(-5, 5);
                                const result = a + b + c;
                                return {
                                    question: `Calculer : ${a} + ${b} + ${c}`,
                                    answer: `${result}`
                                };
                            },
                            // Somme alg√©brique
                            () => {
                                const a = randInt(5, 15);
                                const b = randInt(2, 8);
                                const c = randInt(3, 10);
                                const result = a - b + c;
                                return {
                                    question: `Calculer : ${a} - ${b} + ${c}`,
                                    answer: `${result}`
                                };
                            },
                            // Produit et somme
                            () => {
                                const a = randInt(-5, 5);
                                const b = randInt(-5, 5);
                                const c = randInt(-5, 5);
                                const result = a * b + c;
                                return {
                                    question: `Calculer : ${a} √ó ${b} + ${c}`,
                                    answer: `${a} √ó ${b} + ${c} = ${a * b} + ${c} = ${result}`
                                };
                            },
                            // Comparaison de relatifs
                            () => {
                                const a = randInt(-10, -1);
                                const b = randInt(-10, -1);
                                const comp = a < b ? '<' : a > b ? '>' : '=';
                                return {
                                    question: `Comparer ${a} et ${b} (utiliser <, > ou =)`,
                                    answer: `${a} ${comp} ${b}`
                                };
                            },
                            // Ranger des relatifs
                            () => {
                                const nums = [randInt(-10, -1), randInt(-10, 10), randInt(1, 10), randInt(-10, 10)];
                                const sorted = [...nums].sort((a, b) => a - b);
                                return {
                                    question: `Ranger dans l'ordre croissant : ${nums.join(' ; ')}`,
                                    answer: sorted.join(' < ')
                                };
                            },
                            // Encadrement
                            () => {
                                const a = randInt(-8, 8);
                                return {
                                    question: `Donner un encadrement de ${a} par deux entiers cons√©cutifs`,
                                    answer: `${a-1} < ${a} < ${a+1}`
                                };
                            },
                            // Signe d'un produit
                            () => ({
                                question: "Quel est le signe du produit de deux nombres n√©gatifs ?",
                                answer: "Positif<br><em>(-) √ó (-) = (+)</em>"
                            }),
                            // Signe d'un quotient
                            () => ({
                                question: "Quel est le signe du quotient de deux nombres de signes diff√©rents ?",
                                answer: "N√©gatif<br><em>(+) √∑ (-) = (-) ou (-) √∑ (+) = (-)</em>"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Simplifier, comparer et calculer avec des fractions",
                    generator: () => {
                        const ops = [
                            () => {
                                const pgcd = randChoice([2, 3, 4, 5, 6]);
                                const a = randInt(2, 6) * pgcd;
                                const b = randInt(3, 8) * pgcd;
                                const simplified_a = a / pgcd;
                                const simplified_b = b / pgcd;
                                return {
                                    question: `Simplifier la fraction ${formatFraction(a, b)}`,
                                    answer: formatFraction(simplified_a, simplified_b)
                                };
                            },
                            () => {
                                const a = randInt(1, 5);
                                const b = randInt(2, 6);
                                const c = randInt(1, 5);
                                const d = randInt(2, 6);
                                const num = a * d + c * b;
                                const den = b * d;
                                const simplified = simplifyFraction(num, den);
                                return {
                                    question: `Calculer : ${formatFraction(a, b)} + ${formatFraction(c, d)}`,
                                    answer: formatFraction(simplified.num, simplified.den)
                                };
                            },
                            () => {
                                const a = randInt(1, 5);
                                const b = randInt(2, 6);
                                const c = randInt(1, 5);
                                const d = randInt(2, 6);
                                const num = a * c;
                                const den = b * d;
                                const simplified = simplifyFraction(num, den);
                                return {
                                    question: `Calculer : ${formatFraction(a, b)} √ó ${formatFraction(c, d)}`,
                                    answer: formatFraction(simplified.num, simplified.den)
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Prendre une fraction simple d'un nombre",
                    generator: () => {
                        const fractions = [
                            {text: "le tiers", mult: 3, num: 1, den: 3},
                            {text: "le quart", mult: 4, num: 1, den: 4},
                            {text: "la moiti√©", mult: 2, num: 1, den: 2},
                            {text: "les " + formatFraction(2, 3), mult: 3, num: 2, den: 3},
                            {text: "les " + formatFraction(3, 4), mult: 4, num: 3, den: 4}
                        ];
                        const f = randChoice(fractions);
                        const n = randInt(2, 10) * f.mult;
                        const result = (n * f.num) / f.den;
                        return {
                            question: `Calculer ${f.text} de ${n}`,
                            answer: `${result}`
                        };
                    }
                },
                {
                    desc: "D√©terminer un pourcentage",
                    generator: () => {
                        const pcts = [100, 50, 25, 10, 1];
                        const pct = randChoice(pcts);
                        const n = randInt(20, 200);
                        const result = (pct * n) / 100;
                        return {
                            question: `Calculer ${pct}% de ${n}`,
                            answer: toFrenchNumber(result)
                        };
                    }
                },
                {
                    desc: "√âcritures multiples d'un m√™me nombre",
                    generator: () => {
                        const ops = [
                            () => {
                                const decimals = [0.5, 1.5, 2.5, 0.25, 0.75, 1.25, 0.2, 0.4, 0.6, 0.8];
                                const n = randChoice(decimals);
                                const num = n * (n < 1 ? (n === 0.5 ? 2 : n === 0.25 ? 4 : n === 0.75 ? 4 : 5) : 2);
                                const den = n < 1 ? (n === 0.5 ? 2 : n === 0.25 ? 4 : n === 0.75 ? 4 : 5) : 2;
                                return {
                                    question: `√âcrire ${toFrenchNumber(n)} sous forme de fraction`,
                                    answer: formatFraction(num, den)
                                };
                            },
                            () => {
                                const nums = [
                                    {val: 0.25, pct: 25}, {val: 0.5, pct: 50}, {val: 0.75, pct: 75},
                                    {val: 0.2, pct: 20}, {val: 0.4, pct: 40}, {val: 0.6, pct: 60}, {val: 0.8, pct: 80}
                                ];
                                const chosen = randChoice(nums);
                                return {
                                    question: `√âcrire ${toFrenchNumber(chosen.val)} en pourcentage`,
                                    answer: `${chosen.pct}%`
                                };
                            },
                            () => {
                                const fracs = [
                                    {a: 1, b: 2, pct: 50}, {a: 1, b: 4, pct: 25}, {a: 3, b: 4, pct: 75},
                                    {a: 1, b: 5, pct: 20}, {a: 2, b: 5, pct: 40}
                                ];
                                const f = randChoice(fracs);
                                return {
                                    question: `Convertir ${formatFraction(f.a, f.b)} en pourcentage`,
                                    answer: `${f.pct}%`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Notation scientifique",
                    generator: () => {
                        const ops = [
                            () => {
                                const n = randInt(100, 9999);
                                const str = n.toString();
                                const exp = str.length - 1;
                                const mantisse = toFrenchNumber(n / Math.pow(10, exp));
                                return {
                                    question: `√âcrire ${n} en notation scientifique`,
                                    answer: `${mantisse} √ó 10<sup>${exp}</sup>`
                                };
                            },
                            () => {
                                const a = randDecimal(1, 9.9);
                                const exp = randInt(2, 5);
                                const result = a * Math.pow(10, exp);
                                return {
                                    question: `Convertir ${toFrenchNumber(a)} √ó 10<sup>${exp}</sup> en √©criture d√©cimale`,
                                    answer: toFrenchNumber(result)
                                };
                            },
                            () => {
                                const n = randDecimal(0.001, 0.099, 3);
                                const exp = Math.floor(Math.log10(n));
                                const mantisse = n / Math.pow(10, exp);
                                return {
                                    question: `√âcrire ${toFrenchNumber(n)} en notation scientifique`,
                                    answer: `${toFrenchNumber(mantisse.toFixed(2))} √ó 10<sup>${exp}</sup>`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Carr√©s des nombres de 1 √† 12",
                    generator: () => {
                        const n = randInt(1, 12);
                        return {
                            question: `Calculer ${n}¬≤`,
                            answer: `${n * n}`
                        };
                    }
                },
                {
                    desc: "Tiers, quart, cinqui√®me d'un nombre",
                    generator: () => {
                        const ops = [
                            () => {
                                const n = randInt(6, 30);
                                const result = n / 3;
                                return {
                                    question: `Quel est le tiers de ${n} ?`,
                                    answer: `${n} √∑ 3 = ${toFrenchNumber(result)}`
                                };
                            },
                            () => {
                                const n = randInt(8, 40);
                                const result = n / 4;
                                return {
                                    question: `Quel est le quart de ${n} ?`,
                                    answer: `${n} √∑ 4 = ${toFrenchNumber(result)}`
                                };
                            },
                            () => {
                                const n = randInt(10, 50);
                                const result = n / 5;
                                return {
                                    question: `Quel est le cinqui√®me de ${n} ?`,
                                    answer: `${n} √∑ 5 = ${toFrenchNumber(result)}`
                                };
                            },
                            () => {
                                const n = randInt(12, 60);
                                const result = n / 6;
                                return {
                                    question: `Calculer ${formatFraction(n, 6)}`,
                                    answer: `${n} √∑ 6 = ${toFrenchNumber(result)}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "D√©composition en facteurs premiers et PGCD",
                    generator: () => {
                        const ops = [
                            () => {
                                // Nombres simples √† d√©composer
                                const decomps = [
                                    {n: 12, d: "2¬≤ √ó 3"},
                                    {n: 18, d: "2 √ó 3¬≤"},
                                    {n: 20, d: "2¬≤ √ó 5"},
                                    {n: 24, d: "2¬≥ √ó 3"},
                                    {n: 30, d: "2 √ó 3 √ó 5"},
                                    {n: 36, d: "2¬≤ √ó 3¬≤"},
                                    {n: 40, d: "2¬≥ √ó 5"},
                                    {n: 45, d: "3¬≤ √ó 5"},
                                    {n: 48, d: "2‚Å¥ √ó 3"},
                                    {n: 50, d: "2 √ó 5¬≤"},
                                    {n: 60, d: "2¬≤ √ó 3 √ó 5"},
                                    {n: 72, d: "2¬≥ √ó 3¬≤"},
                                    {n: 75, d: "3 √ó 5¬≤"},
                                    {n: 77, d: "7 √ó 11"},
                                    {n: 84, d: "2¬≤ √ó 3 √ó 7"},
                                    {n: 90, d: "2 √ó 3¬≤ √ó 5"},
                                    {n: 91, d: "7 √ó 13"}
                                ];
                                const chosen = randChoice(decomps);
                                return {
                                    question: `D√©composer ${chosen.n} en produit de facteurs premiers`,
                                    answer: `${chosen.n} = ${chosen.d}`
                                };
                            },
                            () => {
                                // PGCD √† partir de d√©compositions
                                const pairs = [
                                    {a: 12, b: 18, pgcd: 6, expl: "12 = 2¬≤ √ó 3 et 18 = 2 √ó 3¬≤, donc PGCD = 2 √ó 3 = 6"},
                                    {a: 24, b: 36, pgcd: 12, expl: "24 = 2¬≥ √ó 3 et 36 = 2¬≤ √ó 3¬≤, donc PGCD = 2¬≤ √ó 3 = 12"},
                                    {a: 30, b: 45, pgcd: 15, expl: "30 = 2 √ó 3 √ó 5 et 45 = 3¬≤ √ó 5, donc PGCD = 3 √ó 5 = 15"},
                                    {a: 48, b: 72, pgcd: 24, expl: "48 = 2‚Å¥ √ó 3 et 72 = 2¬≥ √ó 3¬≤, donc PGCD = 2¬≥ √ó 3 = 24"},
                                    {a: 91, b: 77, pgcd: 7, expl: "91 = 7 √ó 13 et 77 = 7 √ó 11, donc PGCD = 7"}
                                ];
                                const chosen = randChoice(pairs);
                                return {
                                    question: `Calculer le PGCD de ${chosen.a} et ${chosen.b}`,
                                    answer: `PGCD(${chosen.a} ; ${chosen.b}) = ${chosen.pgcd}<br><em>${chosen.expl}</em>`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Crit√®res de divisibilit√©",
                    generator: () => {
                        const div = randChoice([2, 3, 5, 9]);
                        const n = randInt(100, 500);
                        let isDivisible = false;
                        if (div === 2) isDivisible = n % 2 === 0;
                        else if (div === 3) isDivisible = n % 3 === 0;
                        else if (div === 5) isDivisible = n % 5 === 0;
                        else if (div === 9) isDivisible = n % 9 === 0;
                        return {
                            question: `Le nombre ${n} est-il divisible par ${div} ?`,
                            answer: isDivisible ? `Oui, ${n} √∑ ${div} = ${n / div}` : "Non"
                        };
                    }
                },
                {
                    desc: "Expressions autour d'un nombre entier",
                    generator: () => {
                        const exprs = [
                            {text: "le double de n", answer: "2n ou 2 √ó n"},
                            {text: "le triple de n", answer: "3n ou 3 √ó n"},
                            {text: "la moiti√© de n", answer: `${formatFraction("n", 2)} ou n √∑ 2`},
                            {text: "le successeur de n", answer: "n + 1"},
                            {text: "le pr√©d√©cesseur de n", answer: "n - 1"},
                            {text: "le carr√© de n", answer: "n<sup>2</sup>"}
                        ];
                        const expr = randChoice(exprs);
                        return {
                            question: `Exprimer ${expr.text}`,
                            answer: expr.answer
                        };
                    }
                },
                {
                    desc: "D√©velopper et r√©duire des expressions litt√©rales",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 9);
                                const b = randInt(2, 9);
                                const sum = a + b;
                                return {
                                    question: `R√©duire : ${a}x + ${b}x`,
                                    answer: `${sum}x`
                                };
                            },
                            () => {
                                const a = randInt(3, 9);
                                const b = randInt(2, 6);
                                return {
                                    question: `D√©velopper et r√©duire : ${a}(x + ${b})`,
                                    answer: `${a}x + ${a * b}`
                                };
                            },
                            () => {
                                const a = randInt(5, 12);
                                const b = randInt(2, 5);
                                const c = randInt(1, 4);
                                const result = a - b + c;
                                return {
                                    question: `R√©duire : ${a}y - ${b}y + ${c}y`,
                                    answer: `${result}y`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Calculer la valeur d'une expression alg√©brique",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(3, 9);
                                const x = randInt(1, 5);
                                const result = a * x + b;
                                return {
                                    question: `Calculer ${a}x + ${b} pour x = ${x}`,
                                    answer: `${result}`
                                };
                            },
                            () => {
                                const a = randInt(1, 5);
                                const x = randInt(2, 6);
                                const result = x * x - a;
                                return {
                                    question: `Calculer x<sup>2</sup> - ${a} pour x = ${x}`,
                                    answer: `${result}`
                                };
                            },
                            () => {
                                const a = randInt(2, 4);
                                const b = randInt(2, 5);
                                const x = randInt(2, 4);
                                const result = a * x * x + b * x;
                                return {
                                    question: `Calculer ${a}x<sup>2</sup> + ${b}x pour x = ${x}`,
                                    answer: `${result}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "D√©velopper et factoriser",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 7);
                                const b = randInt(2, 9);
                                return {
                                    question: `D√©velopper : ${a}(x + ${b})`,
                                    answer: `${a}x + ${a * b}`
                                };
                            },
                            () => {
                                const a = randInt(2, 7);
                                const b = randInt(2, 9);
                                const c = randInt(2, 6);
                                return {
                                    question: `D√©velopper : ${a}(${b}x - ${c})`,
                                    answer: `${a * b}x - ${a * c}`
                                };
                            },
                            () => {
                                const a = randInt(2, 6);
                                const pgcd = randInt(2, 5);
                                const b = randInt(2, 6);
                                return {
                                    question: `Factoriser : ${a * pgcd}x + ${b * pgcd}`,
                                    answer: `${pgcd}(${a}x + ${b})`
                                };
                            },
                            () => {
                                // Identit√© remarquable (a+b)(a-b) = a¬≤ - b¬≤
                                const b = randInt(2, 7);
                                const bb = b * b;
                                return {
                                    question: `D√©velopper : (x + ${b})(x - ${b})`,
                                    answer: `x<sup>2</sup> - ${bb}<br><em>Formule : (a + b)(a - b) = a<sup>2</sup> - b<sup>2</sup></em>`
                                };
                            },
                            () => {
                                // Factoriser avec identit√© remarquable a¬≤ - b¬≤ = (a+b)(a-b)
                                const b = randInt(2, 8);
                                const bb = b * b;
                                return {
                                    question: `Factoriser : x<sup>2</sup> - ${bb}`,
                                    answer: `(x + ${b})(x - ${b})<br><em>Formule : a<sup>2</sup> - b<sup>2</sup> = (a + b)(a - b)</em>`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "R√©soudre des √©quations simples",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(2, 9);
                                const c = randInt(6, 36);
                                const x = c / a;
                                return {
                                    question: `R√©soudre : ${a}x = ${c}`,
                                    answer: `x = ${toFrenchNumber(x)}`
                                };
                            },
                            () => {
                                const b = randInt(2, 9);
                                const c = randInt(10, 25);
                                const x = c - b;
                                return {
                                    question: `R√©soudre : x + ${b} = ${c}`,
                                    answer: `x = ${x}`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(1, 5);
                                const c = randInt(10, 30);
                                const x = (c - b) / a;
                                return {
                                    question: `R√©soudre : ${a}x + ${b} = ${c}`,
                                    answer: `x = ${toFrenchNumber(x)}`
                                };
                            },
                            // QCM style DNB Sujet A Q7
                            () => {
                                const a = randInt(3, 6);
                                const b = randInt(2, 8);
                                const c = randInt(15, 30);
                                const correct = (c + b) / a;
                                const wrong1 = c / a + b;
                                const wrong2 = (c - a) + b;
                                const wrong3 = c * a + b;
                                
                                return {
                                    question: `Pour r√©soudre l'√©quation ${a}x - ${b} = ${c}, on effectue le calcul :<br>
A. x = ${formatFraction(c, a)} + ${b} &nbsp;&nbsp;&nbsp; B. x = (${c} - ${a}) + ${b}<br>
C. x = ${c} √ó ${a} + ${b} &nbsp;&nbsp;&nbsp; D. x = ${formatFraction(`${c} + ${b}`, a)}`,
                                    answer: `D. x = ${formatFraction(`${c} + ${b}`, a)} = ${formatFraction(c + b, a)} = ${toFrenchNumber(correct)}<br><em>M√©thode : ajouter ${b} aux deux c√¥t√©s, puis diviser par ${a}</em>`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(3, 9);
                                const c = randInt(20, 40);
                                const correct = (c - b) / a;
                                const wrong1 = c / a - b;
                                const wrong2 = (c + b) / a;
                                const wrong3 = c - b / a;
                                
                                return {
                                    question: `R√©soudre : ${a}x + ${b} = ${c}. Quelle est la solution ?<br>
A. x = ${toFrenchNumber(wrong1)} &nbsp;&nbsp; B. x = ${toFrenchNumber(wrong2)} &nbsp;&nbsp; C. x = ${toFrenchNumber(correct)} &nbsp;&nbsp; D. x = ${toFrenchNumber(wrong3)}`,
                                    answer: `C. x = ${toFrenchNumber(correct)}<br>M√©thode : ${a}x = ${c} - ${b} = ${c - b}, donc x = ${formatFraction(c - b, a)} = ${toFrenchNumber(correct)}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "QCM - Calculs et op√©rations",
                    generator: () => {
                        const ops = [
                            // QCM moyenne (style DNB Sujet A Q2)
                            () => {
                                const notes = [randInt(8, 12), randInt(10, 14), randInt(11, 15), randInt(11, 15)];
                                const sum = notes.reduce((a, b) => a + b, 0);
                                const correct = sum / notes.length;
                                const wrong1 = correct - 0.5;
                                const wrong2 = correct + 0.5;
                                const wrong3 = notes[notes.length - 1];
                                
                                return {
                                    question: `Voici une s√©rie de quatre notes : ${notes.join(', ')}. Quelle est la moyenne de cette s√©rie ?<br>
A. ${toFrenchNumber(wrong1)} &nbsp;&nbsp; B. ${toFrenchNumber(correct)} &nbsp;&nbsp; C. ${toFrenchNumber(wrong2)} &nbsp;&nbsp; D. ${wrong3}`,
                                    answer: `B. ${toFrenchNumber(correct)}<br>Calcul : (${notes.join(' + ')}) √∑ 4 = ${sum} √∑ 4 = ${toFrenchNumber(correct)}`
                                };
                            },
                            // QCM pourcentage
                            () => {
                                const total = randChoice([400, 600, 800, 1000]);
                                const pct = randChoice([20, 25, 30]);
                                const correct = total * pct / 100;
                                const wrong1 = total - correct;
                                const wrong2 = correct + 50;
                                const wrong3 = correct - 50;
                                
                                return {
                                    question: `Dans un coll√®ge de ${total} √©l√®ves, ${pct}% des √©l√®ves portent des lunettes. Combien d'√©l√®ves portent des lunettes ?<br>
A. ${wrong3} &nbsp;&nbsp; B. ${correct} &nbsp;&nbsp; C. ${wrong2} &nbsp;&nbsp; D. ${wrong1}`,
                                    answer: `B. ${correct}<br>Calcul : ${total} √ó ${formatFraction(pct, 100)} = ${total} √ó ${toFrenchNumber(pct/100)} = ${correct}`
                                };
                            },
                            // QCM vitesse/distance/temps (style DNB Sujet A Q5)
                            () => {
                                const vitesse = 90;
                                const distance = 45;
                                const correct = 30; // 30 min
                                
                                return {
                                    question: `Une voiture roule √† 90 km/h. Combien de temps met-elle pour parcourir 45 km ?<br>
A. 15 min &nbsp;&nbsp; B. 30 min &nbsp;&nbsp; C. 45 min &nbsp;&nbsp; D. 1 h`,
                                    answer: `B. 30 min<br>Calcul : 45 √∑ 90 = 0,5 h = 30 minutes`
                                };
                            },
                            () => {
                                const vitesse = randChoice([60, 80, 100, 120]);
                                const distance = vitesse / 2; // demi-heure de trajet
                                const correct = 30;
                                const wrong1 = 15;
                                const wrong2 = 45;
                                const wrong3 = 60;
                                
                                return {
                                    question: `Une voiture roule √† ${vitesse} km/h. Combien de temps met-elle pour parcourir ${toFrenchNumber(distance)} km ?<br>
A. ${wrong1} min &nbsp;&nbsp; B. ${correct} min &nbsp;&nbsp; C. ${wrong2} min &nbsp;&nbsp; D. ${wrong3} min`,
                                    answer: `B. ${correct} min<br>Calcul : ${toFrenchNumber(distance)} √∑ ${vitesse} = 0,5 h = 30 minutes`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Droite gradu√©e - lecture d'abscisse",
                    generator: () => {
                        const ops = [
                            () => {
                                // Nombre d√©cimal simple
                                const step = randChoice([0.5, 1]);
                                const min = 0;
                                const max = step === 0.5 ? 5 : 10;
                                const n = randDecimal(min + step, max - step);
                                const roundedN = Math.round(n / step) * step; // Arrondir au pas

                                return {
                                    question: `Placer le point d'abscisse ${toFrenchNumber(roundedN)} sur une droite gradu√©e :<br>${generateNumberLine(min, max, step, roundedN, false)}`,
                                    answer: `Point plac√© √† ${toFrenchNumber(roundedN)} sur la droite :<br>${generateNumberLine(min, max, step, roundedN, true)}`
                                };
                            },
                            () => {
                                // Fraction simple - QCM style DNB
                                const denoms = [2, 4];
                                const b = randChoice(denoms);
                                const a = randInt(1, b * 2 - 1);
                                const decimal = a / b;
                                
                                const allOptions = [
                                    formatFraction(a, b),
                                    formatFraction(a + 1, b),
                                    formatFraction(a - 1, b),
                                    formatFraction(a, b + 1)
                                ].filter((v, i, arr) => arr.indexOf(v) === i);

                                return {
                                    question: `Sur cette droite gradu√©e, l'abscisse du point E est :<br>${generateNumberLine(0, 2, 1/b, decimal, true)}<br>A. ${allOptions[0]} &nbsp;&nbsp; B. ${allOptions[1]} &nbsp;&nbsp; C. ${allOptions[2]} &nbsp;&nbsp; D. ${allOptions[3]}`,
                                    answer: `${formatFraction(a, b)} (soit ${toFrenchNumber(decimal)})`
                                };
                            },
                            () => {
                                // Fraction
                                const b = randChoice([2, 4, 5]); // D√©nominateur
                                const min = 0;
                                const max = b; // La droite va de 0 √† b
                                const step = 1 / b; // Pas de la graduation
                                const a = randInt(1, b * max - 1); // Num√©rateur
                                const decimal = a / b;

                                return {
                                    question: `Placer le point d'abscisse ${formatFraction(a, b)} sur une droite gradu√©e :<br>${generateNumberLine(min, max, step, decimal, false)}`,
                                    answer: `Point plac√© √† ${toFrenchNumber(decimal)} (soit ${formatFraction(a, b)}) :<br>${generateNumberLine(min, max, step, decimal, true)}`
                                };
                            },
                            () => {
                                // Lecture directe avec fractions - style sujet B Q4
                                const options = [
                                    {frac: formatFraction(5, 4), dec: 1.25},
                                    {frac: formatFraction(3, 2), dec: 1.5},
                                    {frac: formatFraction(7, 4), dec: 1.75},
                                    {frac: formatFraction(5, 2), dec: 2.5}
                                ];
                                const correct = randChoice(options);
                                const wrongOpts = options.filter(o => o !== correct).slice(0, 3);
                                const allOpts = [correct, ...wrongOpts].sort(() => Math.random() - 0.5);
                                
                                return {
                                    question: `Sur cette droite gradu√©e, l'abscisse du point E est :<br>${generateNumberLine(0, 3, 0.25, correct.dec, true)}<br>A. ${allOpts[0].frac} &nbsp;&nbsp; B. ${allOpts[1].frac} &nbsp;&nbsp; C. ${allOpts[2].frac} &nbsp;&nbsp; D. ${allOpts[3].frac}`,
                                    answer: `${correct.frac} (valeur d√©cimale : ${toFrenchNumber(correct.dec)})`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                }
            ],

            "Espace et g√©om√©trie": [
                {
                    desc: "Rep√®re orthogonal",
                    generator: () => {
                        const x = randInt(-5, 5);
                        const y = randInt(-5, 5);
                        const questions = [
                            {
                                question: `Placer le point A(${x}; ${y}) dans un rep√®re`,
                                answer: `Point plac√© avec abscisse ${x} et ordonn√©e ${y}`
                            },
                            {
                                question: `Lire les coordonn√©es d'un point visible sur un graphique`,
                                answer: `Identifier l'abscisse (x) et l'ordonn√©e (y) du point`
                            },
                            {
                                question: `Quelles sont les coordonn√©es de l'origine du rep√®re ?`,
                                answer: `(0 ; 0)`
                            }
                        ];
                        return randChoice(questions);
                    }
                },
                {
                    desc: "Exploiter le codage d'une figure",
                    generator: () => {
                        const ops = [
                            () => ({
                                question: "Sur une figure, deux segments ont le m√™me codage (un trait). Que peut-on en d√©duire ?",
                                answer: "Ces deux segments ont la m√™me longueur (ils sont isom√©triques)"
                            }),
                            () => ({
                                question: "Un triangle a trois c√¥t√©s cod√©s de la m√™me fa√ßon. Quelle est la nature de ce triangle ?",
                                answer: "Triangle √©quilat√©ral (tous les c√¥t√©s sont √©gaux)"
                            }),
                            () => ({
                                question: "Un triangle a deux c√¥t√©s cod√©s identiquement. Quelle est la nature de ce triangle ?",
                                answer: "Triangle isoc√®le (deux c√¥t√©s √©gaux)"
                            }),
                            () => ({
                                question: "Sur une figure, un angle est marqu√© d'un petit carr√©. Que repr√©sente ce symbole ?",
                                answer: "Un angle droit (90¬∞)"
                            }),
                            () => ({
                                question: "Un quadrilat√®re a ses 4 c√¥t√©s cod√©s de la m√™me fa√ßon et un angle droit. Quelle est sa nature ?",
                                answer: "Carr√© (4 c√¥t√©s √©gaux et un angle droit)"
                            }),
                            () => ({
                                question: "Un quadrilat√®re a ses c√¥t√©s oppos√©s cod√©s deux par deux. Quelle est sa nature ?",
                                answer: "Parall√©logramme (c√¥t√©s oppos√©s √©gaux)"
                            }),
                            () => ({
                                question: "Un triangle rectangle a deux c√¥t√©s de l'angle droit cod√©s de la m√™me fa√ßon. Quelle est sa nature compl√®te ?",
                                answer: "Triangle rectangle isoc√®le"
                            }),
                            () => ({
                                question: "Deux angles sont marqu√©s du m√™me codage (un arc). Que peut-on en d√©duire ?",
                                answer: "Ces deux angles ont la m√™me mesure"
                            }),
                            () => ({
                                question: "Une droite est trac√©e en pointill√©s perpendiculaire √† un segment [AB] en son milieu. Qu'est-ce que c'est ?",
                                answer: "La m√©diatrice du segment [AB]"
                            }),
                            () => ({
                                question: "Un point est marqu√© au milieu d'un segment avec un trait de codage. Comment appelle-t-on ce point ?",
                                answer: "Le milieu du segment"
                            }),
                            () => ({
                                question: "Un quadrilat√®re a 4 angles droits et les c√¥t√©s oppos√©s cod√©s deux par deux. Quelle est sa nature ?",
                                answer: "Rectangle"
                            }),
                            () => ({
                                question: "Sur une figure, deux droites sont marqu√©es avec des fl√®ches identiques. Que signifie ce codage ?",
                                answer: "Les deux droites sont parall√®les"
                            }),
                            () => ({
                                question: "Un triangle a un angle droit et tous ses c√¥t√©s cod√©s diff√©remment. Quelle est sa nature ?",
                                answer: "Triangle rectangle quelconque (ou scal√®ne)"
                            }),
                            () => ({
                                question: "Un losange est un quadrilat√®re dont les 4 c√¥t√©s sont cod√©s de la m√™me fa√ßon. Quelle autre propri√©t√© poss√®de-t-il ?",
                                answer: "Ses c√¥t√©s oppos√©s sont parall√®les (c'est un parall√©logramme particulier)"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Angles",
                    generator: () => {
                        const ops = [
                            () => ({
                                question: "Quelle est la mesure d'un angle droit ?",
                                answer: "90¬∞"
                            }),
                            () => ({
                                question: "Quelle est la mesure d'un angle plat ?",
                                answer: "180¬∞"
                            }),
                            () => {
                                const a = randInt(30, 80);
                                const result = 90 - a;
                                return {
                                    question: `Deux angles sont compl√©mentaires. L'un mesure ${a}¬∞, calculer l'autre`,
                                    answer: `90¬∞ - ${a}¬∞ = ${result}¬∞`
                                };
                            },
                            () => {
                                const a = randInt(60, 150);
                                const result = 180 - a;
                                return {
                                    question: `Deux angles sont suppl√©mentaires. L'un mesure ${a}¬∞, calculer l'autre`,
                                    answer: `180¬∞ - ${a}¬∞ = ${result}¬∞`
                                };
                            },
                            () => ({
                                question: "Quelle est la mesure d'un angle nul ?",
                                answer: "0¬∞"
                            }),
                            () => ({
                                question: "Qu'est-ce qu'un angle aigu ?",
                                answer: "Un angle dont la mesure est comprise entre 0¬∞ et 90¬∞"
                            }),
                            () => ({
                                question: "Qu'est-ce qu'un angle obtus ?",
                                answer: "Un angle dont la mesure est comprise entre 90¬∞ et 180¬∞"
                            }),
                            () => {
                                const a = randInt(40, 130);
                                return {
                                    question: `Deux angles sont oppos√©s par le sommet. L'un mesure ${a}¬∞, quelle est la mesure de l'autre ?`,
                                    answer: `${a}¬∞<br><em>Explication : Deux angles oppos√©s par le sommet ont la m√™me mesure</em>`
                                };
                            },
                            () => {
                                const a = randInt(50, 130);
                                const b = 180 - a;
                                return {
                                    question: `Deux angles adjacents forment un angle plat. L'un mesure ${a}¬∞, calculer l'autre`,
                                    answer: `180¬∞ - ${a}¬∞ = ${b}¬∞<br><em>Explication : Deux angles adjacents formant un angle plat sont suppl√©mentaires</em>`
                                };
                            },
                            () => ({
                                question: "Que peut-on dire de deux angles oppos√©s par le sommet ?",
                                answer: "Ils ont la m√™me mesure"
                            }),
                            () => ({
                                question: "Que sont deux angles adjacents ?",
                                answer: "Deux angles qui ont le m√™me sommet, un c√¥t√© commun, et sont situ√©s de part et d'autre de ce c√¥t√© commun"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Somme des angles d'un triangle",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(30, 70);
                                const b = randInt(40, 80);
                                const c = 180 - a - b;
                                return {
                                    question: `Dans un triangle, deux angles mesurent ${a}¬∞ et ${b}¬∞. Calculer le troisi√®me angle`,
                                    answer: `180¬∞ - ${a}¬∞ - ${b}¬∞ = ${c}¬∞`
                                };
                            },
                            () => ({
                                question: "Quelle est la somme des angles d'un triangle ?",
                                answer: "180¬∞"
                            }),
                            () => {
                                const a = randInt(30, 60);
                                const b = 90 - a;
                                return {
                                    question: `Dans un triangle rectangle, un angle aigu mesure ${a}¬∞. Calculer l'autre angle aigu`,
                                    answer: `90¬∞ - ${a}¬∞ = ${b}¬∞`
                                };
                            },
                            () => ({
                                question: "Dans un triangle √©quilat√©ral, quelle est la mesure de chaque angle ?",
                                answer: "60¬∞"
                            }),
                            // QCM style DNB Sujet B Q5
                            () => {
                                const angleA = randInt(25, 45);
                                const angleC = 90 - angleA;
                                const wrong1 = angleA;
                                const wrong2 = 90;
                                const wrong3 = 180 - angleA;
                                
                                return {
                                    question: `Dans le triangle ABC, rectangle en B, on sait que l'angle A = ${angleA}¬∞. Calculer l'angle C.<br>
A. ${wrong1}¬∞ &nbsp;&nbsp; B. ${angleC}¬∞ &nbsp;&nbsp; C. ${wrong2}¬∞ &nbsp;&nbsp; D. ${wrong3}¬∞`,
                                    answer: `B. ${angleC}¬∞<br>Dans un triangle rectangle, la somme des deux angles aigus est 90¬∞, donc C = 90¬∞ - ${angleA}¬∞ = ${angleC}¬∞`
                                };
                            },
                            () => {
                                const angleA = 35;
                                const angleC = 55;
                                
                                return {
                                    question: `Dans le triangle ABC, rectangle en B, on sait que √Ç = 35¬∞. Calculer ƒà.<br>
A. 35¬∞ &nbsp;&nbsp; B. 45¬∞ &nbsp;&nbsp; C. 55¬∞ &nbsp;&nbsp; D. 90¬∞`,
                                    answer: `C. 55¬∞<br>Dans un triangle rectangle : √Ç + ƒà = 90¬∞, donc ƒà = 90¬∞ - 35¬∞ = 55¬∞`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Conversions d'unit√©s",
                    generator: () => {
                        const ops = [
                            // LONGUEURS
                            () => {
                                const n = randDecimal(1, 10);
                                const result = n * 100;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} m en cm`,
                                    answer: `${toFrenchNumber(n)} m √ó 100 = ${toFrenchNumber(result)} cm`
                                };
                            },
                            () => {
                                const n = randInt(100, 5000);
                                const result = n / 1000;
                                return {
                                    question: `Convertir ${n} mm en m`,
                                    answer: `${n} mm √∑ 1000 = ${toFrenchNumber(result)} m`
                                };
                            },
                            () => {
                                const n = randInt(2, 10);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${n} km en m`,
                                    answer: `${n} km √ó 1000 = ${result} m`
                                };
                            },
                            () => {
                                const n = randInt(10, 100);
                                const result = n * 10;
                                return {
                                    question: `Convertir ${n} cm en mm`,
                                    answer: `${n} cm √ó 10 = ${result} mm`
                                };
                            },
                            // AIRES
                            () => {
                                const n = randInt(2, 8);
                                const result = n * 10000;
                                return {
                                    question: `Convertir ${n} m¬≤ en cm¬≤`,
                                    answer: `${n} m¬≤ √ó 10 000 = ${toFrenchNumber(result)} cm¬≤`
                                };
                            },
                            () => {
                                const n = randInt(50000, 200000);
                                const result = n / 10000;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} cm¬≤ en m¬≤`,
                                    answer: `${toFrenchNumber(n)} cm¬≤ √∑ 10 000 = ${toFrenchNumber(result)} m¬≤`
                                };
                            },
                            () => {
                                const n = randInt(2, 5);
                                const result = n * 1000000;
                                return {
                                    question: `Convertir ${n} km¬≤ en m¬≤`,
                                    answer: `${n} km¬≤ √ó 1 000 000 = ${toFrenchNumber(result)} m¬≤`
                                };
                            },
                            () => {
                                const n = randInt(500, 2000);
                                const result = n / 100;
                                return {
                                    question: `Convertir ${n} mm¬≤ en cm¬≤`,
                                    answer: `${n} mm¬≤ √∑ 100 = ${toFrenchNumber(result)} cm¬≤`
                                };
                            },
                            // VOLUMES
                            () => {
                                const n = randInt(2, 8);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${n} dm¬≥ en cm¬≥`,
                                    answer: `${n} dm¬≥ √ó 1000 = ${toFrenchNumber(result)} cm¬≥`
                                };
                            },
                            () => {
                                const n = randInt(2000, 8000);
                                const result = n / 1000;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} cm¬≥ en dm¬≥`,
                                    answer: `${toFrenchNumber(n)} cm¬≥ √∑ 1000 = ${toFrenchNumber(result)} dm¬≥`
                                };
                            },
                            () => {
                                const n = randInt(2, 10);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${n} m¬≥ en dm¬≥`,
                                    answer: `${n} m¬≥ √ó 1000 = ${toFrenchNumber(result)} dm¬≥`
                                };
                            },
                            // MASSES
                            () => {
                                const n = randInt(1000, 5000);
                                const result = n / 1000;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} g en kg`,
                                    answer: `${toFrenchNumber(n)} g √∑ 1000 = ${toFrenchNumber(result)} kg`
                                };
                            },
                            () => {
                                const n = randDecimal(1, 8);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} kg en g`,
                                    answer: `${toFrenchNumber(n)} kg √ó 1000 = ${toFrenchNumber(result)} g`
                                };
                            },
                            // VOLUMES LIQUIDES
                            () => {
                                const n = randDecimal(1, 5);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} L en mL`,
                                    answer: `${toFrenchNumber(n)} L √ó 1000 = ${toFrenchNumber(result)} mL`
                                };
                            },
                            () => {
                                const n = randDecimal(1, 5);
                                const result = n * 100;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} L en cL`,
                                    answer: `${toFrenchNumber(n)} L √ó 100 = ${toFrenchNumber(result)} cL`
                                };
                            },
                            () => {
                                const n = randDecimal(1, 5);
                                const result = n * 10;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} L en dL`,
                                    answer: `${toFrenchNumber(n)} L √ó 10 = ${toFrenchNumber(result)} dL`
                                };
                            },
                            () => {
                                const n = randInt(100, 500);
                                const result = n / 100;
                                return {
                                    question: `Convertir ${n} cL en L`,
                                    answer: `${n} cL √∑ 100 = ${toFrenchNumber(result)} L`
                                };
                            },
                            // TEMPS
                            () => {
                                const h = randInt(1, 5);
                                const min = randChoice([15, 30, 45]);
                                const result = h * 60 + min;
                                return {
                                    question: `Convertir ${h} h ${min} min en minutes`,
                                    answer: `${h} h √ó 60 + ${min} min = ${h * 60} min + ${min} min = ${result} min`
                                };
                            },
                            () => {
                                const min = randInt(60, 300);
                                const result = min / 60;
                                return {
                                    question: `Un film dure ${min} min. Quelle est sa dur√©e en heures ?`,
                                    answer: `${min} min √∑ 60 = ${toFrenchNumber(result)} h`
                                };
                            },
                            () => {
                                const h = randDecimal(1, 5);
                                const min = h * 60;
                                return {
                                    question: `Convertir ${toFrenchNumber(h)} h en minutes`,
                                    answer: `${toFrenchNumber(h)} h √ó 60 = ${toFrenchNumber(min)} min`
                                };
                            },
                            () => {
                                const sec = randInt(120, 600);
                                const min = sec / 60;
                                return {
                                    question: `Convertir ${sec} secondes en minutes`,
                                    answer: `${sec} s √∑ 60 = ${toFrenchNumber(min)} min`
                                };
                            },
                            // VITESSE - DISTANCE - TEMPS (calcul mental)
                            () => {
                                // Distance = Vitesse √ó Temps (nombres ronds)
                                const vitesse = randChoice([50, 60, 80, 100]);
                                const temps = randChoice([1, 2, 3]);
                                const distance = vitesse * temps;
                                return {
                                    question: `Une voiture roule √† ${vitesse} km/h pendant ${temps} h. Quelle distance parcourt-elle ?`,
                                    answer: `Distance = ${vitesse} km/h √ó ${temps} h = ${distance} km`
                                };
                            },
                            () => {
                                // Temps = Distance √∑ Vitesse (avec 30 min)
                                const vitesse = randChoice([60, 80, 100, 120]);
                                const distance = vitesse / 2; // 30 minutes
                                return {
                                    question: `Une voiture roule √† ${vitesse} km/h. Combien de temps met-elle pour parcourir ${distance} km ?`,
                                    answer: `${distance} √∑ ${vitesse} = 0,5 h = 30 min`
                                };
                            },
                            () => {
                                // Temps = Distance √∑ Vitesse (1 heure)
                                const vitesse = randChoice([60, 80, 90, 100, 120]);
                                const distance = vitesse;
                                return {
                                    question: `√Ä ${vitesse} km/h, combien de temps pour parcourir ${distance} km ?`,
                                    answer: `${distance} √∑ ${vitesse} = 1 h`
                                };
                            },
                            () => {
                                // Temps = Distance √∑ Vitesse (2 heures)
                                const vitesse = randChoice([50, 60, 70, 80]);
                                const distance = vitesse * 2;
                                return {
                                    question: `√Ä ${vitesse} km/h, combien de temps pour faire ${distance} km ?`,
                                    answer: `${distance} √∑ ${vitesse} = 2 h`
                                };
                            },
                            () => {
                                // Vitesse = Distance √∑ Temps
                                const temps = randChoice([2, 3, 4]);
                                const vitesse = randChoice([60, 80, 100]);
                                const distance = vitesse * temps;
                                return {
                                    question: `Un cycliste parcourt ${distance} km en ${temps} h. Quelle est sa vitesse moyenne ?`,
                                    answer: `Vitesse = ${distance} km √∑ ${temps} h = ${vitesse} km/h`
                                };
                            },
                            () => {
                                // 15 minutes = 1/4 d'heure
                                const vitesse = randChoice([60, 80, 100, 120]);
                                const distance = vitesse / 4;
                                return {
                                    question: `√Ä ${vitesse} km/h, quelle distance en 15 minutes ?`,
                                    answer: `15 min = ${formatFraction("1", "4")} h, donc ${vitesse} √∑ 4 = ${distance} km`
                                };
                            },
                            () => {
                                // Question mentale simple
                                return {
                                    question: `Une voiture roule √† 50 km/h pendant 2 h. Quelle distance parcourt-elle ?`,
                                    answer: `50 km/h √ó 2 h = 100 km`
                                };
                            },
                            () => {
                                // Question mentale simple
                                return {
                                    question: `Combien de temps pour faire 180 km √† 60 km/h ?`,
                                    answer: `180 √∑ 60 = 3 h`
                                };
                            },
                            () => {
                                // Question mentale simple
                                return {
                                    question: `√Ä quelle vitesse roule-t-on si on fait 150 km en 3 h ?`,
                                    answer: `150 √∑ 3 = 50 km/h`
                                };
                            },
                            () => {
                                // QCM calcul mental
                                const vitesse = 90;
                                const distance = 45;
                                return {
                                    question: `Une voiture roule √† 90 km/h. Combien de temps pour parcourir 45 km ?<br>
A. 15 min &nbsp;&nbsp; B. 30 min &nbsp;&nbsp; C. 45 min &nbsp;&nbsp; D. 1 h`,
                                    answer: `B. 30 min<br>45 √∑ 90 = 0,5 h = 30 min`
                                };
                            },
                            () => {
                                const s = randInt(120, 600);
                                const result = s / 60;
                                return {
                                    question: `Convertir ${s} s en minutes`,
                                    answer: `${s} s √∑ 60 = ${toFrenchNumber(result)} min`
                                };
                            },
                            () => {
                                const h = randInt(24, 120);
                                const result = h / 24;
                                return {
                                    question: `Convertir ${h} h en jours`,
                                    answer: `${h} h √∑ 24 = ${toFrenchNumber(result)} jour(s)`
                                };
                            },
                            // CORRESPONDANCES
                            () => {
                                const n = randInt(5, 25);
                                return {
                                    question: `Convertir ${n} dm¬≥ en L`,
                                    answer: `${n} L<br><em>Rappel : 1 dm¬≥ = 1 L</em>`
                                };
                            },
                            () => {
                                const n = randDecimal(1, 5);
                                const result = n * 1000;
                                return {
                                    question: `Convertir ${toFrenchNumber(n)} m¬≥ en L`,
                                    answer: `${toFrenchNumber(result)} L<br><em>Rappel : 1 m¬≥ = 1000 L</em>`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Reconna√Ætre des solides",
                    generator: () => {
                        const questions = [
                            {question: "Combien de faces a un cube ?", answer: "6 faces"},
                            {question: "Combien d'ar√™tes a un pav√© droit ?", answer: "12 ar√™tes"},
                            {question: "Combien de sommets a une pyramide √† base carr√©e ?", answer: "5 sommets (4 √† la base + 1 sommet)"},
                            {question: "D√©crire un prisme droit √† base triangulaire", answer: "Solide √† 5 faces : 2 bases triangulaires et 3 faces lat√©rales rectangulaires"},
                            {question: "Quelle est la diff√©rence entre un cylindre et un c√¥ne ?", answer: "Le cylindre a 2 bases circulaires identiques, le c√¥ne a 1 base circulaire et 1 sommet"}
                        ];
                        return randChoice(questions);
                    }
                },
                {
                    desc: "P√©rim√®tre",
                    generator: () => {
                        const ops = [
                            () => {
                                // Paire th√©orie + pratique pour rectangle
                                const L = randInt(5, 15);
                                const l = randInt(3, 10);
                                const p = 2 * (L + l);
                                return [
                                    {
                                        question: "Quelle est la formule du p√©rim√®tre d'un rectangle ?",
                                        answer: "P√©rim√®tre = 2 √ó (Longueur + largeur)"
                                    },
                                    {
                                        question: `Calculer le p√©rim√®tre d'un rectangle de longueur ${L} cm et largeur ${l} cm`,
                                        answer: `P = 2 √ó (${L} + ${l}) = 2 √ó ${L + l} = ${p} cm`
                                    }
                                ];
                            },
                            () => {
                                const c = randInt(4, 12);
                                const p = 4 * c;
                                return {
                                    question: `Calculer le p√©rim√®tre d'un carr√© de c√¥t√© ${c} cm`,
                                    answer: `P = 4 √ó ${c} cm = ${p} cm`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique pour cercle
                                const r = randInt(3, 10);
                                const p = 2 * Math.PI * r;
                                return [
                                    {
                                        question: "Quelle est la formule du p√©rim√®tre d'un cercle ?",
                                        answer: "P√©rim√®tre = 2 √ó œÄ √ó r"
                                    },
                                    {
                                        question: `Calculer le p√©rim√®tre d'un cercle de rayon ${r} cm (œÄ ‚âà 3,14)`,
                                        answer: `P = 2 √ó œÄ √ó ${r} cm = ${2 * r}œÄ cm ‚âà ${toFrenchNumber(p.toFixed(2))} cm`
                                    }
                                ];
                            },
                            () => {
                                const c = randInt(3, 8);
                                const p = 3 * c;
                                return {
                                    question: `Un triangle √©quilat√©ral a un c√¥t√© de ${c} cm. Quel est son p√©rim√®tre ?`,
                                    answer: `P = 3 √ó ${c} cm = ${p} cm`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Aires",
                    generator: () => {
                        const ops = [
                            () => {
                                // Paire th√©orie + pratique pour rectangle
                                const L = randInt(5, 15);
                                const l = randInt(3, 10);
                                const a = L * l;
                                return [
                                    {
                                        question: "Quelle est la formule de l'aire d'un rectangle ?",
                                        answer: "Aire = Longueur √ó largeur"
                                    },
                                    {
                                        question: `Calculer l'aire d'un rectangle de longueur ${L} cm et largeur ${l} cm`,
                                        answer: `Aire = ${L} cm √ó ${l} cm = ${a} cm¬≤`
                                    }
                                ];
                            },
                            () => {
                                // Paire th√©orie + pratique pour triangle
                                const b = randInt(4, 12);
                                const h = randInt(3, 10);
                                const a = (b * h) / 2;
                                return [
                                    {
                                        question: "Quelle est la formule de l'aire d'un triangle ?",
                                        answer: "Aire = (base √ó hauteur) √∑ 2"
                                    },
                                    {
                                        question: `Calculer l'aire d'un triangle de base ${b} cm et hauteur ${h} cm`,
                                        answer: `Aire = (${b} cm √ó ${h} cm) √∑ 2 = ${toFrenchNumber(a)} cm¬≤`
                                    }
                                ];
                            },
                            () => {
                                // Paire th√©orie + pratique pour disque
                                const r = randInt(3, 10);
                                const a = Math.PI * r * r;
                                return [
                                    {
                                        question: "Quelle est la formule de l'aire d'un disque ?",
                                        answer: "Aire = œÄ √ó r<sup>2</sup>"
                                    },
                                    {
                                        question: `Calculer l'aire d'un disque de rayon ${r} cm (œÄ ‚âà 3,14)`,
                                        answer: `Aire = œÄ √ó (${r} cm)<sup>2</sup> = ${r * r}œÄ cm¬≤ ‚âà ${toFrenchNumber(a.toFixed(2))} cm¬≤`
                                    }
                                ];
                            },
                            () => {
                                const c = randInt(5, 12);
                                const a = c * c;
                                return {
                                    question: `Calculer l'aire d'un carr√© de c√¥t√© ${c} cm`,
                                    answer: `Aire = ${c} cm √ó ${c} cm = ${a} cm¬≤`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Volumes",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(3, 8);
                                const v = a * a * a;
                                return {
                                    question: `Calculer le volume d'un cube d'ar√™te ${a} cm`,
                                    answer: `V = ${a} cm √ó ${a} cm √ó ${a} cm = ${v} cm¬≥`
                                };
                            },
                            () => {
                                const L = randInt(4, 10);
                                const l = randInt(3, 8);
                                const h = randInt(2, 6);
                                const v = L * l * h;
                                return {
                                    question: `Calculer le volume d'un pav√© droit de dimensions ${L} cm √ó ${l} cm √ó ${h} cm`,
                                    answer: `V = ${L} cm √ó ${l} cm √ó ${h} cm = ${v} cm¬≥`
                                };
                            },
                            () => {
                                const B = randInt(15, 40);
                                const h = randInt(5, 15);
                                const v = B * h;
                                return {
                                    question: `Calculer le volume d'un prisme droit d'aire de base ${B} cm¬≤ et de hauteur ${h} cm`,
                                    answer: `V = ${B} cm¬≤ √ó ${h} cm = ${v} cm¬≥`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const r = randInt(3, 6);
                                const h = randInt(5, 10);
                                const v = Math.PI * r * r * h;
                                return [
                                    {
                                        question: "Quelle est la formule du volume d'un cylindre ?",
                                        answer: "V = œÄ √ó r<sup>2</sup> √ó h"
                                    },
                                    {
                                        question: `Calculer le volume d'un cylindre de rayon ${r} cm et de hauteur ${h} cm (œÄ ‚âà 3,14)`,
                                        answer: `V = œÄ √ó (${r} cm)<sup>2</sup> √ó ${h} cm = ${r*r*h}œÄ cm¬≥ ‚âà ${toFrenchNumber(v.toFixed(2))} cm¬≥`
                                    }
                                ];
                            },
                            () => {
                                // Pyramide - th√©orie + pratique
                                const B = randInt(20, 60);
                                const h = randInt(6, 15);
                                const v = (B * h) / 3;
                                return [
                                    {
                                        question: "Quelle est la formule du volume d'une pyramide ?",
                                        answer: `V = ${formatFraction("Aire de la base √ó Hauteur", 3)}`
                                    },
                                    {
                                        question: `Calculer le volume d'une pyramide d'aire de base ${B} cm¬≤ et de hauteur ${h} cm`,
                                        answer: `V = ${formatFraction(`${B} cm¬≤ √ó ${h} cm`, 3)} = ${formatFraction(`${B * h} cm¬≥`, 3)} = ${toFrenchNumber(v.toFixed(2))} cm¬≥`
                                    }
                                ];
                            },
                            () => {
                                // Pyramide √† base carr√©e
                                const cote = randInt(4, 10);
                                const h = randInt(6, 12);
                                const B = cote * cote;
                                const v = (B * h) / 3;
                                return {
                                    question: `Calculer le volume d'une pyramide √† base carr√©e de c√¥t√© ${cote} cm et de hauteur ${h} cm`,
                                    answer: `Aire de la base = ${cote} cm √ó ${cote} cm = ${B} cm¬≤<br>V = ${formatFraction(`${B} cm¬≤ √ó ${h} cm`, 3)} = ${formatFraction(`${B * h} cm¬≥`, 3)} = ${toFrenchNumber(v.toFixed(2))} cm¬≥`
                                };
                            },
                            () => {
                                // C√¥ne - th√©orie + pratique
                                const r = randInt(3, 7);
                                const h = randInt(6, 12);
                                const v = (Math.PI * r * r * h) / 3;
                                return [
                                    {
                                        question: "Quelle est la formule du volume d'un c√¥ne ?",
                                        answer: `V = ${formatFraction("œÄ √ó r<sup>2</sup> √ó h", 3)}`
                                    },
                                    {
                                        question: `Calculer le volume d'un c√¥ne de rayon ${r} cm et de hauteur ${h} cm (œÄ ‚âà 3,14)`,
                                        answer: `V = ${formatFraction(`œÄ √ó (${r} cm)<sup>2</sup> √ó ${h} cm`, 3)} = ${formatFraction(`${r*r*h}œÄ cm¬≥`, 3)} ‚âà ${toFrenchNumber(v.toFixed(2))} cm¬≥`
                                    }
                                ];
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Th√©or√®me de Pythagore",
                    generator: () => {
                        const ops = [
                            () => {
                                const a = randInt(3, 8);
                                const b = randInt(4, 10);
                                const c = Math.sqrt(a * a + b * b);
                                return {
                                    question: `Dans un triangle rectangle, les c√¥t√©s de l'angle droit mesurent ${a} cm et ${b} cm. Calculer l'hypot√©nuse`,
                                    answer: `${toFrenchNumber(c.toFixed(2))} cm`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const a = randInt(3, 6);
                                const b = randInt(4, 8);
                                const c = Math.sqrt(a * a + b * b);
                                return [
                                    {
                                        question: "√ânoncer le th√©or√®me de Pythagore",
                                        answer: "Dans un triangle rectangle, le carr√© de l'hypot√©nuse est √©gal √† la somme des carr√©s des deux autres c√¥t√©s"
                                    },
                                    {
                                        question: `Application : Dans un triangle rectangle ABC, AB = ${a} cm et AC = ${b} cm. Calculer BC`,
                                        answer: `BC<sup>2</sup> = AB<sup>2</sup> + AC<sup>2</sup> = ${a}<sup>2</sup> + ${b}<sup>2</sup> = ${a*a} + ${b*b} = ${a*a + b*b}, donc BC = ${toFrenchNumber(c.toFixed(2))} cm`
                                    }
                                ];
                            },
                            () => {
                                const pythTriples = [[3,4,5], [5,12,13], [8,15,17], [7,24,25]];
                                const [a, b, c] = randChoice(pythTriples);
                                return {
                                    question: `Un triangle a des c√¥t√©s de ${a} cm, ${b} cm et ${c} cm. Est-il rectangle ?`,
                                    answer: `Oui, car ${a}<sup>2</sup> + ${b}<sup>2</sup> = ${a*a} + ${b*b} = ${a*a + b*b} = ${c}<sup>2</sup> = ${c*c}`
                                };
                            },
                            () => {
                                const c = randInt(5, 10);
                                const diag = c * Math.sqrt(2);
                                return {
                                    question: `Calculer la diagonale d'un carr√© de c√¥t√© ${c} cm (arrondir au dixi√®me)`,
                                    answer: `${toFrenchNumber(diag.toFixed(1))} cm`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Th√©or√®me de Thal√®s",
                    generator: () => {
                        const AB = randInt(4, 8);
                        const AC = randInt(6, 12);
                        const AM = randInt(2, 4);
                        const questions = [
                            () => {
                                // Paire th√©orie + pratique
                                const a = randInt(6, 10);
                                const b = randInt(3, 5);
                                const c = randInt(8, 12);
                                return [
                                    {
                                        question: "√ânoncer le th√©or√®me de Thal√®s",
                                        answer: "Si deux droites sont parall√®les, alors les rapports des c√¥t√©s correspondants sont √©gaux"
                                    },
                                    {
                                        question: `Application : Dans des triangles en position de Thal√®s, AB = ${a} cm, AM = ${b} cm, AC = ${c} cm. Si MN // BC, √©crire l'√©galit√© de Thal√®s`,
                                        answer: `${formatFraction("AM", "AB")} = ${formatFraction("AN", "AC")} = ${formatFraction("MN", "BC")} soit ${formatFraction(b, a)} = ${formatFraction("AN", c)} = ${formatFraction("MN", "BC")}`
                                    }
                                ];
                            },
                            () => ({
                                question: "Dans quelle configuration peut-on utiliser le th√©or√®me de Thal√®s ?",
                                answer: "Configuration papillon (2 droites parall√®les coup√©es par 2 s√©cantes) ou configuration triangle (droite parall√®le √† un c√¥t√©)"
                            }),
                            () => ({
                                question: `Dans des triangles en position de Thal√®s, AB = ${AB}, AC = ${AC}, AM = ${AM}. Si MN // BC, √©crire l'√©galit√© de Thal√®s`,
                                answer: `${formatFraction("AM", "AB")} = ${formatFraction("AN", "AC")} = ${formatFraction("MN", "BC")}`
                            }),
                            () => ({
                                question: "Citer les conditions d'application du th√©or√®me de Thal√®s",
                                answer: "Deux droites parall√®les coup√©es par deux s√©cantes"
                            })
                        ];
                        return randChoice(questions)();
                    }
                },
                {
                    desc: "Trigonom√©trie - Cosinus",
                    generator: () => {
                        const ops = [
                            () => {
                                // Paire th√©orie + pratique
                                const adj = randInt(3, 8);
                                const hyp = randInt(adj + 2, 12);
                                const cos = adj / hyp;
                                return [
                                    {
                                        question: "Dans un triangle rectangle, quelle est la formule du cosinus d'un angle aigu ?",
                                        answer: `cos(angle) = ${formatFraction("c√¥t√© adjacent", "hypot√©nuse")}`
                                    },
                                    {
                                        question: `Application : Dans un triangle rectangle, le c√¥t√© adjacent mesure ${adj} cm et l'hypot√©nuse ${hyp} cm. Calculer le cosinus de l'angle`,
                                        answer: `cos = ${formatFraction(adj + " cm", hyp + " cm")} = ${formatFraction(adj, hyp)} ‚âà ${toFrenchNumber(cos.toFixed(3))}`
                                    }
                                ];
                            },
                            () => ({
                                question: "D√©finir le cosinus d'un angle aigu dans un triangle rectangle",
                                answer: `cos(angle) = ${formatFraction("c√¥t√© adjacent", "hypot√©nuse")}`
                            }),
                            () => {
                                const adj = randInt(3, 8);
                                const hyp = randInt(adj + 2, 12);
                                const cos = adj / hyp;
                                return {
                                    question: `Dans un triangle rectangle, le c√¥t√© adjacent mesure ${adj} cm et l'hypot√©nuse ${hyp} cm. Calculer le cosinus de l'angle`,
                                    answer: `cos = ${formatFraction(adj + " cm", hyp + " cm")} = ${formatFraction(adj, hyp)} ‚âà ${toFrenchNumber(cos.toFixed(3))}`
                                };
                            },
                            // QCM style DNB Sujet B Q6
                            () => {
                                const options = [
                                    {text: formatFraction("AB", "BC"), correct: true, label: "c√¥t√© adjacent √∑ hypot√©nuse"},
                                    {text: formatFraction("AB", "AC"), correct: false, label: "c√¥t√© adjacent √∑ c√¥t√© oppos√©"},
                                    {text: formatFraction("AC", "BC"), correct: false, label: "c√¥t√© oppos√© √∑ hypot√©nuse"},
                                    {text: formatFraction("BC", "AB"), correct: false, label: "hypot√©nuse √∑ c√¥t√© adjacent"}
                                ];
                                const shuffled = options.sort(() => Math.random() - 0.5);
                                const correctAnswer = options.find(o => o.correct);
                                
                                return {
                                    question: `Dans le triangle ABC, rectangle en A, quel calcul doit-on effectuer pour d√©terminer le cosinus de l'angle ABC ?<br>
A. ${shuffled[0].text} &nbsp;&nbsp; B. ${shuffled[1].text} &nbsp;&nbsp; C. ${shuffled[2].text} &nbsp;&nbsp; D. ${shuffled[3].text}`,
                                    answer: `${correctAnswer.text} (${correctAnswer.label})<br><em>cos(ABC) = ${formatFraction("c√¥t√© adjacent √† ABC", "hypot√©nuse")} = ${formatFraction("AB", "BC")}</em>`
                                };
                            },
                            () => {
                                return {
                                    question: `Dans le triangle ABC, rectangle en A, quel calcul doit-on effectuer pour d√©terminer le cosinus de l'angle ABC ?<br>
A. ${formatFraction("AC", "BC")} &nbsp;&nbsp; B. ${formatFraction("AB", "BC")} &nbsp;&nbsp; C. ${formatFraction("AB", "AC")} &nbsp;&nbsp; D. ${formatFraction("BC", "AB")}`,
                                    answer: `B. ${formatFraction("AB", "BC")}<br><em>cos(ABC) = ${formatFraction("c√¥t√© adjacent", "hypot√©nuse")} = ${formatFraction("AB", "BC")}</em>`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Trigonom√©trie - Sinus et Tangente",
                    generator: () => {
                        const ops = [
                            // SINUS
                            () => {
                                // Paire th√©orie + pratique sinus
                                const opp = randInt(3, 8);
                                const hyp = randInt(opp + 2, 12);
                                const sin = opp / hyp;
                                return [
                                    {
                                        question: "Dans un triangle rectangle, quelle est la formule du sinus d'un angle aigu ?",
                                        answer: `sin(angle) = ${formatFraction("c√¥t√© oppos√©", "hypot√©nuse")}`
                                    },
                                    {
                                        question: `Application : Dans un triangle rectangle, le c√¥t√© oppos√© mesure ${opp} cm et l'hypot√©nuse ${hyp} cm. Calculer le sinus de l'angle`,
                                        answer: `sin = ${formatFraction(opp + " cm", hyp + " cm")} = ${formatFraction(opp, hyp)} ‚âà ${toFrenchNumber(sin.toFixed(3))}`
                                    }
                                ];
                            },
                            () => ({
                                question: "D√©finir le sinus d'un angle aigu dans un triangle rectangle",
                                answer: `sin(angle) = ${formatFraction("c√¥t√© oppos√©", "hypot√©nuse")}`
                            }),
                            () => {
                                const opp = randInt(3, 8);
                                const hyp = randInt(opp + 2, 12);
                                const sin = opp / hyp;
                                return {
                                    question: `Dans un triangle rectangle, le c√¥t√© oppos√© mesure ${opp} cm et l'hypot√©nuse ${hyp} cm. Calculer le sinus de l'angle`,
                                    answer: `sin = ${formatFraction(opp + " cm", hyp + " cm")} = ${formatFraction(opp, hyp)} ‚âà ${toFrenchNumber(sin.toFixed(3))}`
                                };
                            },
                            // TANGENTE
                            () => {
                                // Paire th√©orie + pratique tangente
                                const opp = randInt(3, 8);
                                const adj = randInt(3, 8);
                                const tan = opp / adj;
                                return [
                                    {
                                        question: "Dans un triangle rectangle, quelle est la formule de la tangente d'un angle aigu ?",
                                        answer: `tan(angle) = ${formatFraction("c√¥t√© oppos√©", "c√¥t√© adjacent")}`
                                    },
                                    {
                                        question: `Application : Dans un triangle rectangle, le c√¥t√© oppos√© mesure ${opp} cm et le c√¥t√© adjacent ${adj} cm. Calculer la tangente de l'angle`,
                                        answer: `tan = ${formatFraction(opp + " cm", adj + " cm")} = ${formatFraction(opp, adj)} ‚âà ${toFrenchNumber(tan.toFixed(3))}`
                                    }
                                ];
                            },
                            () => ({
                                question: "D√©finir la tangente d'un angle aigu dans un triangle rectangle",
                                answer: `tan(angle) = ${formatFraction("c√¥t√© oppos√©", "c√¥t√© adjacent")}`
                            }),
                            () => {
                                const opp = randInt(3, 8);
                                const adj = randInt(3, 8);
                                const tan = opp / adj;
                                return {
                                    question: `Dans un triangle rectangle, le c√¥t√© oppos√© mesure ${opp} cm et le c√¥t√© adjacent ${adj} cm. Calculer la tangente de l'angle`,
                                    answer: `tan = ${formatFraction(opp + " cm", adj + " cm")} = ${formatFraction(opp, adj)} ‚âà ${toFrenchNumber(tan.toFixed(3))}`
                                };
                            },
                            // RELATIONS
                            () => ({
                                question: "Quelle relation existe entre sinus, cosinus et tangente ?",
                                answer: `tan(angle) = ${formatFraction("sin(angle)", "cos(angle)")}`
                            }),
                            () => ({
                                question: "Quelle est la relation fondamentale entre sinus et cosinus ?",
                                answer: "sin<sup>2</sup>(angle) + cos<sup>2</sup>(angle) = 1"
                            }),
                            // MNEMOTECHNIQUE
                            () => ({
                                question: "Donner le moyen mn√©motechnique pour retenir les formules trigonom√©triques (SOH-CAH-TOA)",
                                answer: "SOH : Sin = Oppos√© / Hypot√©nuse<br>CAH : Cos = Adjacent / Hypot√©nuse<br>TOA : Tan = Oppos√© / Adjacent"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Sym√©tries et transformations",
                    generator: () => {
                        const ops = [
                            // Sym√©trie centrale
                            () => {
                                const x = randInt(-5, 5);
                                const y = randInt(-5, 5);
                                return {
                                    question: `Quel est le sym√©trique du point A(${x}; ${y}) par rapport √† l'origine ?`,
                                    answer: `A'(${-x}; ${-y})`
                                };
                            },
                            () => ({
                                question: "Quelles sont les propri√©t√©s conserv√©es par une sym√©trie centrale ?",
                                answer: "Les distances, les angles, les aires, l'alignement et le parall√©lisme"
                            }),
                            // Sym√©trie axiale
                            () => ({
                                question: "Comment construire le sym√©trique d'un point par rapport √† une droite ?",
                                answer: "Tracer la perpendiculaire √† la droite passant par le point, puis reporter la distance de l'autre c√¥t√©"
                            }),
                            () => ({
                                question: "Quelles sont les propri√©t√©s conserv√©es par une sym√©trie axiale ?",
                                answer: "Les distances, les angles, les aires. ATTENTION : le sens de parcours est invers√©"
                            }),
                            // Translation
                            () => {
                                const x = randInt(-5, 5);
                                const y = randInt(-5, 5);
                                const vx = randInt(1, 5);
                                const vy = randInt(1, 5);
                                const resX = x + vx;
                                const resY = y + vy;
                                return {
                                    question: `Par la translation de vecteur (${vx}; ${vy}), quelle est l'image du point A(${x}; ${y}) ?`,
                                    answer: `A'(${resX}; ${resY})<br>On ajoute les coordonn√©es du vecteur : (${x} + ${vx}; ${y} + ${vy})`
                                };
                            },
                            () => ({
                                question: "Quelles sont les propri√©t√©s conserv√©es par une translation ?",
                                answer: "Les distances, les angles, les aires, l'alignement, le parall√©lisme et les directions"
                            }),
                            () => ({
                                question: "Quelle transformation permet de passer d'un point A √† un point B par un glissement ?",
                                answer: "La translation de vecteur AB"
                            }),
                            () => ({
                                question: "Dans une translation, que peut-on dire de l'image d'une droite ?",
                                answer: "L'image d'une droite par translation est une droite parall√®le (ou confondue)"
                            }),
                            () => {
                                const x1 = randInt(-5, 5);
                                const y1 = randInt(-5, 5);
                                const x2 = randInt(-5, 5);
                                const y2 = randInt(-5, 5);
                                const vx = x2 - x1;
                                const vy = y2 - y1;
                                return {
                                    question: `Quelles sont les coordonn√©es du vecteur de translation qui transforme A(${x1}; ${y1}) en B(${x2}; ${y2}) ?`,
                                    answer: `(${vx}; ${vy})<br>Calcul : (${x2} - ${x1}; ${y2} - ${y1})`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                }
            ],

            "Organisation et gestion de donn√©es": [
                {
                    desc: "Probabilit√©s simples",
                    generator: () => {
                        const ops = [
                            () => ({
                                question: "On lance un d√© √©quilibr√©. Quelle est la probabilit√© d'obtenir un 6 ?",
                                answer: formatFraction(1, 6)
                            }),
                            () => {
                                const r = randInt(2, 6);
                                const b = randInt(3, 8);
                                const total = r + b;
                                return {
                                    question: `Dans un sac, il y a ${r} boules rouges et ${b} boules bleues. Quelle est la probabilit√© de tirer une boule rouge ?`,
                                    answer: formatFraction(r, total)
                                };
                            },
                            () => ({
                                question: "On lance une pi√®ce √©quilibr√©e. Quelle est la probabilit√© d'obtenir pile ?",
                                answer: `${formatFraction(1, 2)} ou 0,5 ou 50%`
                            }),
                            () => ({
                                question: "Calculer la probabilit√© d'obtenir un nombre pair en lan√ßant un d√©",
                                answer: `${formatFraction(3, 6)} = ${formatFraction(1, 2)}`
                            }),
                            () => {
                                const n = randInt(4, 8);
                                return {
                                    question: `Dans une situation d'√©quiprobabilit√© avec ${n} issues, quelle est la probabilit√© de chaque issue ?`,
                                    answer: formatFraction(1, n)
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Fr√©quence",
                    generator: () => {
                        const ops = [
                            () => {
                                const total = randInt(30, 60);
                                const occur = randInt(10, Math.floor(total * 0.6));
                                const freq = occur / total;
                                return {
                                    question: `Sur ${total} lancers, on obtient ${occur} fois pile. Calculer la fr√©quence de pile`,
                                    answer: `${formatFraction(occur, total)} = ${toFrenchNumber(freq.toFixed(3))}`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const total = randInt(40, 60);
                                const occur = randInt(15, 30);
                                const freq = occur / total;
                                return [
                                    {
                                        question: "Comment calculer une fr√©quence ?",
                                        answer: `Fr√©quence = ${formatFraction("nombre de fois o√π l'√©v√©nement se produit", "nombre total d'essais")}`
                                    },
                                    {
                                        question: `Application : Calculer la fr√©quence d'un √©v√©nement qui s'est produit ${occur} fois sur ${total} essais`,
                                        answer: `Fr√©quence = ${formatFraction(occur, total)} = ${toFrenchNumber(freq.toFixed(3))}`
                                    }
                                ];
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Moyenne",
                    generator: () => {
                        const ops = [
                            () => {
                                const notes = Array.from({length: 4}, () => randInt(8, 18));
                                const sum = notes.reduce((a, b) => a + b, 0);
                                const avg = sum / notes.length;
                                return {
                                    question: `Calculer la moyenne de : ${notes.join(', ')}`,
                                    answer: `${formatFraction("(" + notes.join(' + ') + ")", notes.length)} = ${formatFraction(sum, notes.length)} = ${toFrenchNumber(avg.toFixed(2))}`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const notes = Array.from({length: 3}, () => randInt(10, 18));
                                const sum = notes.reduce((a, b) => a + b, 0);
                                const avg = sum / notes.length;
                                return [
                                    {
                                        question: "Quelle est la formule de la moyenne ?",
                                        answer: `Moyenne = ${formatFraction("somme des valeurs", "nombre de valeurs")}`
                                    },
                                    {
                                        question: `Application : Calculer la moyenne de ${notes.join(', ')}`,
                                        answer: `Moyenne = ${formatFraction("(" + notes.join(' + ') + ")", notes.length)} = ${formatFraction(sum, notes.length)} = ${toFrenchNumber(avg.toFixed(2))}`
                                    }
                                ];
                            },
                            () => {
                                const n = randInt(4, 6);
                                const moy = randInt(10, 15);
                                const sum = n * moy;
                                return {
                                    question: `La moyenne de ${n} notes est ${moy}. Quelle est la somme des notes ?`,
                                    answer: `${n} √ó ${moy} = ${sum}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "M√©diane",
                    generator: () => {
                        const ops = [
                            () => {
                                const serie = Array.from({length: 5}, () => randInt(1, 20)).sort((a,b) => a-b);
                                const median = serie[2];
                                return {
                                    question: `D√©terminer la m√©diane de la s√©rie : ${serie.join(', ')}`,
                                    answer: `${median} (valeur centrale)`
                                };
                            },
                            () => {
                                // S√©rie NON ordonn√©e - comme dans sujet B
                                const serie = Array.from({length: 5}, () => randInt(6, 19));
                                const serieSorted = [...serie].sort((a,b) => a-b);
                                const median = serieSorted[2];
                                return {
                                    question: `Quelle est la m√©diane de cette s√©rie de notes : ${serie.join(' ; ')} ?`,
                                    answer: `On ordonne d'abord : ${serieSorted.join(' < ')}<br>M√©diane = ${median} (valeur centrale, 3·µâ valeur sur 5)`
                                };
                            },
                            () => {
                                // Paire th√©orie + pratique
                                const serie = Array.from({length: 5}, () => randInt(5, 18)).sort((a,b) => a-b);
                                const median = serie[2];
                                return [
                                    {
                                        question: "Comment calculer la m√©diane d'une s√©rie ?",
                                        answer: "Pour une s√©rie ordonn√©e : si impair, prendre la valeur du milieu ; si pair, faire la moyenne des 2 valeurs centrales"
                                    },
                                    {
                                        question: `Application : D√©terminer la m√©diane de ${serie.join(', ')}`,
                                        answer: `S√©rie d√©j√† ordonn√©e avec ${serie.length} valeurs (impair), m√©diane = ${median} (valeur centrale)`
                                    }
                                ];
                            },
                            () => {
                                const serie = Array.from({length: 4}, () => randInt(5, 15)).sort((a,b) => a-b);
                                const median = (serie[1] + serie[2]) / 2;
                                return {
                                    question: `Quelle est la m√©diane de : ${serie.join(', ')} ?`,
                                    answer: `${formatFraction("(" + serie[1] + " + " + serie[2] + ")", 2)} = ${formatFraction(serie[1] + serie[2], 2)} = ${toFrenchNumber(median)}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Effectif total et diagrammes",
                    generator: () => {
                        const ops = [
                            () => {
                                // Calculer effectif total √† partir d'un diagramme
                                const effectifs = [
                                    randInt(25, 45),
                                    randInt(25, 40),
                                    randInt(20, 35),
                                    randInt(15, 30),
                                    randInt(10, 25)
                                ];
                                const total = effectifs.reduce((a, b) => a + b, 0);
                                return {
                                    question: `Un diagramme en barres indique les effectifs suivants : ${effectifs.join(', ')}. Quel est l'effectif total ?`,
                                    answer: `${effectifs.join(' + ')} = ${total}`
                                };
                            },
                            () => {
                                // Question style DNB sur pourcentage d'un diagramme
                                const effectifs = [randInt(30, 50), randInt(25, 40), randInt(20, 35), randInt(15, 30)];
                                const total = effectifs.reduce((a, b) => a + b, 0);
                                const seuil = randInt(effectifs[2] + effectifs[3] - 5, effectifs[2] + effectifs[3] + 5);
                                const pct = (seuil / total * 100).toFixed(1);
                                return {
                                    question: `Dans un coll√®ge de ${total} √©l√®ves, ${seuil} font du v√©lo. Quel est le pourcentage d'√©l√®ves qui font du v√©lo ?`,
                                    answer: `${formatFraction(seuil, total)} √ó 100 = ${toFrenchNumber(pct)}%`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Lire tableaux et graphiques",
                    generator: () => {
                        const questions = [
                            {
                                question: "Comment interpr√©ter un diagramme en barres ?",
                                answer: "La hauteur de chaque barre repr√©sente la valeur ou l'effectif de la cat√©gorie"
                            },
                            {
                                question: "Qu'est-ce qu'un diagramme circulaire ?",
                                answer: "Graphique en forme de cercle divis√© en secteurs, chaque secteur repr√©sentant une proportion du total"
                            },
                            {
                                question: "Comment extraire une donn√©e d'un tableau statistique ?",
                                answer: "Identifier la ligne et la colonne correspondant √† la donn√©e recherch√©e, puis lire la valeur √† leur intersection"
                            }
                        ];
                        return randChoice(questions);
                    }
                }
            ],

            "Proportionnalit√© et fonctions": [
                {
                    desc: "Reconna√Ætre une situation de proportionnalit√©",
                    generator: () => {
                        const ops = [
                            () => {
                                const p1 = randInt(2, 5);
                                const c1 = p1 * randInt(2, 4);
                                const p2 = randInt(6, 10);
                                const c2 = p2 * (c1 / p1);
                                const coef = c1/p1;
                                const questionTable = generateProportionalityTable([p1, p2], [c1, c2], "Poids (kg)", "Prix (‚Ç¨)");
                                return {
                                    question: `Ce tableau repr√©sente-t-il une situation de proportionnalit√© ?<br>${questionTable}`,
                                    answer: `Oui, car ${c1}√∑${p1} = ${c2}√∑${p2} = ${toFrenchNumber(coef)} (coefficient de proportionnalit√© constant)`
                                };
                            },
                            () => ({
                                question: "Comment v√©rifier si un tableau repr√©sente une situation de proportionnalit√© ?",
                                answer: "V√©rifier que tous les rapports entre valeurs correspondantes sont √©gaux (coefficient de proportionnalit√© constant)"
                            }),
                            () => ({
                                question: "Est-ce que le p√©rim√®tre d'un carr√© est proportionnel √† son c√¥t√© ?",
                                answer: "Oui, P = 4 √ó c√¥t√© (coefficient 4)"
                            }),
                            () => ({
                                question: "L'√¢ge et la taille sont-ils proportionnels ?",
                                answer: "Non, la taille ne cro√Æt pas proportionnellement √† l'√¢ge"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Reconna√Ætre fonctions lin√©aire, affine, constante - par formule",
                    generator: () => {
                        const ops = [
                            // Reconna√Ætre fonction lin√©aire
                            () => {
                                const a = randInt(2, 8);
                                return {
                                    question: `La fonction f(x) = ${a}x est-elle lin√©aire, affine ou constante ?`,
                                    answer: `Lin√©aire<br><em>Forme f(x) = ax avec a ‚â† 0, la courbe passe par l'origine</em>`
                                };
                            },
                            () => {
                                const a = randInt(-8, -2);
                                return {
                                    question: `Quelle est la nature de la fonction f(x) = ${a}x ?`,
                                    answer: `Fonction lin√©aire<br><em>Forme f(x) = ax, elle repr√©sente une situation de proportionnalit√©</em>`
                                };
                            },
                            // Reconna√Ætre fonction affine
                            () => {
                                const a = randInt(2, 8);
                                const b = randInt(1, 10);
                                return {
                                    question: `La fonction f(x) = ${a}x + ${b} est-elle lin√©aire, affine ou constante ?`,
                                    answer: `Affine (non lin√©aire)<br><em>Forme f(x) = ax + b avec a ‚â† 0 et b ‚â† 0</em>`
                                };
                            },
                            () => {
                                const a = randInt(2, 6);
                                const b = randInt(-10, -1);
                                return {
                                    question: `Quelle est la nature de la fonction f(x) = ${a}x ${b} ?`,
                                    answer: `Fonction affine (non lin√©aire)<br><em>Forme f(x) = ax + b avec b ‚â† 0, la courbe ne passe pas par l'origine</em>`
                                };
                            },
                            // Reconna√Ætre fonction constante
                            () => {
                                const b = randInt(1, 15);
                                return {
                                    question: `La fonction f(x) = ${b} est-elle lin√©aire, affine ou constante ?`,
                                    answer: `Constante<br><em>Forme f(x) = b, la repr√©sentation graphique est une droite horizontale</em>`
                                };
                            },
                            () => {
                                const b = randInt(-15, -1);
                                return {
                                    question: `Quelle est la nature de la fonction f(x) = ${b} ?`,
                                    answer: `Fonction constante<br><em>La fonction prend toujours la m√™me valeur quel que soit x</em>`
                                };
                            },
                            // QCM reconnaissance
                            () => {
                                const a = randInt(3, 7);
                                return {
                                    question: `La fonction f(x) = ${a}x est :<br>
A. Constante &nbsp;&nbsp; B. Lin√©aire &nbsp;&nbsp; C. Affine non lin√©aire &nbsp;&nbsp; D. Aucune des trois`,
                                    answer: `B. Lin√©aire<br>Forme f(x) = ax, elle repr√©sente une proportionnalit√©`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(3, 9);
                                return {
                                    question: `La fonction f(x) = ${a}x + ${b} est :<br>
A. Constante &nbsp;&nbsp; B. Lin√©aire &nbsp;&nbsp; C. Affine non lin√©aire &nbsp;&nbsp; D. Aucune des trois`,
                                    answer: `C. Affine non lin√©aire<br>Forme f(x) = ax + b avec a ‚â† 0 et b ‚â† 0`
                                };
                            },
                            // D√©finitions th√©oriques
                            () => ({
                                question: "Quelle est la forme d'une fonction lin√©aire ?",
                                answer: "f(x) = ax avec a ‚â† 0<br><em>Sa repr√©sentation graphique est une droite passant par l'origine</em>"
                            }),
                            () => ({
                                question: "Quelle est la forme d'une fonction affine ?",
                                answer: "f(x) = ax + b avec a ‚â† 0<br><em>Si b = 0, la fonction est lin√©aire ; si b ‚â† 0, elle est affine non lin√©aire</em>"
                            }),
                            () => ({
                                question: "Quelle est la forme d'une fonction constante ?",
                                answer: "f(x) = b<br><em>Sa repr√©sentation graphique est une droite horizontale</em>"
                            }),
                            () => ({
                                question: "Une fonction lin√©aire repr√©sente-t-elle une situation de proportionnalit√© ?",
                                answer: "Oui<br><em>f(x) = ax signifie que y est proportionnel √† x avec coefficient a</em>"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Reconna√Ætre fonctions lin√©aire, affine, constante - par graphique",
                    generator: () => {
                        const ops = [
                            // Droite passant par l'origine
                            () => ({
                                question: "Une droite passe par l'origine du rep√®re (0 ; 0). Quelle est la nature de la fonction repr√©sent√©e ?",
                                answer: "Fonction lin√©aire<br><em>Une droite passant par l'origine repr√©sente toujours une fonction lin√©aire f(x) = ax</em>"
                            }),
                            () => ({
                                question: "Sur un graphique, la droite repr√©sentant une fonction passe par le point (0 ; 0). Que peut-on en d√©duire ?",
                                answer: "C'est une fonction lin√©aire (de la forme f(x) = ax)"
                            }),
                            // Droite ne passant pas par l'origine
                            () => ({
                                question: "Une droite ne passe pas par l'origine et n'est pas horizontale. Quelle fonction repr√©sente-t-elle ?",
                                answer: "Fonction affine non lin√©aire<br><em>Forme f(x) = ax + b avec a ‚â† 0 et b ‚â† 0</em>"
                            }),
                            () => {
                                const b = randInt(2, 8);
                                return {
                                    question: `Une droite coupe l'axe des ordonn√©es au point (0 ; ${b}) et n'est pas horizontale. Quelle fonction ?`,
                                    answer: `Fonction affine non lin√©aire<br><em>L'ordonn√©e √† l'origine est ${b}, donc f(x) = ax + ${b} avec a ‚â† 0</em>`
                                };
                            },
                            // Droite horizontale
                            () => ({
                                question: "Une droite est horizontale sur un graphique. Quelle fonction repr√©sente-t-elle ?",
                                answer: "Fonction constante<br><em>Forme f(x) = b, tous les points ont la m√™me ordonn√©e</em>"
                            }),
                            () => {
                                const b = randInt(1, 10);
                                return {
                                    question: `Une droite horizontale passe par tous les points d'ordonn√©e ${b}. Quelle fonction ?`,
                                    answer: `Fonction constante f(x) = ${b}<br><em>Pour tout x, f(x) = ${b}</em>`
                                };
                            },
                            // QCM avec description graphique
                            () => ({
                                question: `Une droite passe par les points (0 ; 0) et (2 ; 6). La fonction est :<br>
A. Constante &nbsp;&nbsp; B. Lin√©aire &nbsp;&nbsp; C. Affine non lin√©aire &nbsp;&nbsp; D. Aucune`,
                                answer: `B. Lin√©aire<br>Elle passe par l'origine, donc f(x) = ax avec a = 3`
                            }),
                            () => ({
                                question: `Une droite passe par (0 ; 3) et (2 ; 7). La fonction est :<br>
A. Constante &nbsp;&nbsp; B. Lin√©aire &nbsp;&nbsp; C. Affine non lin√©aire &nbsp;&nbsp; D. Aucune`,
                                answer: `C. Affine non lin√©aire<br>Elle ne passe pas par l'origine, donc f(x) = ax + b avec b = 3`
                            }),
                            () => ({
                                question: `Une droite passe par (1 ; 5) et (3 ; 5). La fonction est :<br>
A. Constante &nbsp;&nbsp; B. Lin√©aire &nbsp;&nbsp; C. Affine non lin√©aire &nbsp;&nbsp; D. Aucune`,
                                answer: `A. Constante<br>Droite horizontale, tous les points ont ordonn√©e 5, donc f(x) = 5`
                            }),
                            // Caract√©ristiques graphiques
                            () => ({
                                question: "Comment reconna√Ætre graphiquement une fonction lin√©aire ?",
                                answer: "Sa repr√©sentation est une droite passant par l'origine (0 ; 0)"
                            }),
                            () => ({
                                question: "Comment reconna√Ætre graphiquement une fonction constante ?",
                                answer: "Sa repr√©sentation est une droite horizontale (parall√®le √† l'axe des abscisses)"
                            }),
                            () => ({
                                question: "Quelle est l'ordonn√©e √† l'origine d'une fonction lin√©aire ?",
                                answer: "0 (z√©ro)<br><em>Une fonction lin√©aire passe toujours par (0 ; 0)</em>"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "R√©soudre un probl√®me de proportionnalit√©",
                    generator: () => {
                        const ops = [
                            () => {
                                const p1 = randInt(2, 5);
                                const c1 = p1 * randInt(3, 6);
                                const p2 = randInt(6, 10);
                                const c2 = (c1 / p1) * p2;
                                const coef = c1/p1;
                                const questionTable = generateProportionalityTable([p1, p2], [c1, "?"], "Poids (kg)", "Prix (‚Ç¨)");
                                const answerTable = generateProportionalityTable([p1, p2], [c1, c2], "Poids (kg)", "Prix (‚Ç¨)");
                                return {
                                    question: `Compl√©ter le tableau de proportionnalit√© :<br>${questionTable}`,
                                    answer: `${toFrenchNumber(c2)}‚Ç¨<br>Calcul : coefficient = ${c1}√∑${p1} = ${toFrenchNumber(coef)}, donc ${p2} √ó ${toFrenchNumber(coef)} = ${toFrenchNumber(c2)}<br>${answerTable}`
                                };
                            },
                            () => {
                                const art1 = randInt(2, 5);
                                const total1 = art1 * randInt(3, 6);
                                const art2 = randInt(6, 10);
                                const unitPrice = total1 / art1;
                                const total2 = art2 * unitPrice;
                                const questionTable = generateProportionalityTable([art1, art2], [total1, "?"], "Nombre d'articles", "Prix (‚Ç¨)");
                                const answerTable = generateProportionalityTable([art1, art2], [total1, total2], "Nombre d'articles", "Prix (‚Ç¨)");
                                return {
                                    question: `Compl√©ter le tableau de proportionnalit√© :<br>${questionTable}`,
                                    answer: `${toFrenchNumber(total2)}‚Ç¨<br>Calcul : ${total1}√∑${art1} = ${toFrenchNumber(unitPrice)}‚Ç¨ par article, donc ${art2} √ó ${toFrenchNumber(unitPrice)} = ${toFrenchNumber(total2)}<br>${answerTable}`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const coef = randInt(2, 5);
                                const b = a * coef;
                                const c = randInt(6, 10);
                                const d = c * coef;
                                const questionTable = generateProportionalityTable([a, c], [b, "?"]);
                                const answerTable = generateProportionalityTable([a, c], [b, d]);
                                return {
                                    question: `Compl√©ter le tableau de proportionnalit√© :<br>${questionTable}`,
                                    answer: `${d}<br>Calcul : coefficient = ${b}√∑${a} = ${coef}, donc ${c} √ó ${coef} = ${d}<br>${answerTable}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Pourcentages - calcul mental",
                    generator: () => {
                        const ops = [
                            // 10% facile
                            () => {
                                const nombre = randChoice([20, 30, 40, 50, 60, 80, 100, 120]);
                                const result = nombre * 0.1;
                                return {
                                    question: `Calculer 10% de ${nombre}`,
                                    answer: `${nombre} √∑ 10 = ${result}`
                                };
                            },
                            // 50% facile
                            () => {
                                const nombre = randChoice([20, 40, 60, 80, 100, 120, 160, 200]);
                                const result = nombre / 2;
                                return {
                                    question: `Calculer 50% de ${nombre}`,
                                    answer: `${nombre} √∑ 2 = ${result}`
                                };
                            },
                            // 25% facile
                            () => {
                                const nombre = randChoice([20, 40, 60, 80, 100, 120, 200]);
                                const result = nombre / 4;
                                return {
                                    question: `Calculer 25% de ${nombre}`,
                                    answer: `${nombre} √∑ 4 = ${result}`
                                };
                            },
                            // 20% facile
                            () => {
                                const nombre = randChoice([20, 40, 50, 60, 80, 100]);
                                const result = nombre / 5;
                                return {
                                    question: `Calculer 20% de ${nombre}`,
                                    answer: `${nombre} √∑ 5 = ${result}`
                                };
                            },
                            // 1% facile
                            () => {
                                const nombre = randChoice([100, 200, 300, 500]);
                                const result = nombre / 100;
                                return {
                                    question: `Calculer 1% de ${nombre}`,
                                    answer: `${nombre} √∑ 100 = ${result}`
                                };
                            },
                            // Augmenter de 10%
                            () => {
                                const prix = randChoice([10, 20, 30, 40, 50]);
                                const result = prix * 1.1;
                                return {
                                    question: `Augmenter ${prix}‚Ç¨ de 10%`,
                                    answer: `${prix} + ${prix / 10} = ${result}‚Ç¨`
                                };
                            },
                            // Augmenter de 50%
                            () => {
                                const prix = randChoice([10, 20, 40, 60, 80]);
                                const result = prix * 1.5;
                                return {
                                    question: `Augmenter ${prix}‚Ç¨ de 50%`,
                                    answer: `${prix} + ${prix / 2} = ${result}‚Ç¨`
                                };
                            },
                            // R√©duction de 50%
                            () => {
                                const prix = randChoice([20, 40, 60, 80, 100]);
                                const result = prix / 2;
                                return {
                                    question: `Appliquer une r√©duction de 50% sur ${prix}‚Ç¨`,
                                    answer: `${prix} √∑ 2 = ${result}‚Ç¨`
                                };
                            },
                            // Questions tr√®s simples
                            () => ({
                                question: `Calculer 10% de 50`,
                                answer: `50 √∑ 10 = 5`
                            }),
                            () => ({
                                question: `Calculer 25% de 100`,
                                answer: `100 √∑ 4 = 25`
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Pourcentages - augmentation et diminution",
                    generator: () => {
                        const ops = [
                            () => {
                                const prix = randInt(50, 150);
                                const pct = randChoice([10, 20, 25, 30]);
                                const augmentation = (prix * pct) / 100;
                                const result = prix + augmentation;
                                return {
                                    question: `Augmenter ${prix}‚Ç¨ de ${pct}%`,
                                    answer: `${prix} + (${prix} √ó ${formatFraction(pct, 100)}) = ${prix} + ${augmentation} = ${result}‚Ç¨`
                                };
                            },
                            () => {
                                const prix = randInt(60, 180);
                                const pct = randChoice([10, 15, 20, 25]);
                                const pctRestant = 100 - pct;
                                const result = (prix * pctRestant) / 100;
                                return {
                                    question: `Diminuer ${prix}‚Ç¨ de ${pct}%`,
                                    answer: `Avec ${pct}% de r√©duction, il reste ${pctRestant}% √† payer :<br>${prix} √ó ${formatFraction(pctRestant, 100)} = ${result}‚Ç¨`
                                };
                            },
                            () => {
                                const prix = randInt(40, 120);
                                const pct = randChoice([15, 20, 30]);
                                const pctRestant = 100 - pct;
                                const result = (prix * pctRestant) / 100;
                                return {
                                    question: `Appliquer une r√©duction de ${pct}% sur ${prix}‚Ç¨`,
                                    answer: `Avec ${pct}% de r√©duction, il reste ${pctRestant}% √† payer :<br>${prix} √ó ${formatFraction(pctRestant, 100)} = ${result}‚Ç¨`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Exploiter un graphique",
                    generator: () => {
                        const ops = [
                            () => {
                                // Graphique distance/temps (ligne droite)
                                const vitesse = randChoice([10, 15, 20, 25]);
                                const temps = randInt(3, 6);
                                const points = [];
                                for (let t = 0; t <= 6; t++) {
                                    points.push({x: t, y: vitesse * t});
                                }
                                const distance = vitesse * temps;
                                const questionGraph = generateGraph(points, "", "Temps (h)", "Distance (km)", null);
                                const answerGraph = generateGraph(points, "", "Temps (h)", "Distance (km)", {x: temps, y: distance});
                                return {
                                    question: `Sur ce graphique distance/temps, lire la distance parcourue apr√®s ${temps} heures :<br>${questionGraph}`,
                                    answer: `${distance} km<br>${answerGraph}`
                                };
                            },
                            () => {
                                // Lecture d'ordonn√©e
                                const coef = randInt(3, 8);
                                const x = randInt(2, 5);
                                const points = [];
                                for (let t = 0; t <= 7; t++) {
                                    points.push({x: t, y: coef * t});
                                }
                                const y = coef * x;
                                const questionGraph = generateGraph(points, "", "x", "y", null);
                                const answerGraph = generateGraph(points, "", "x", "y", {x: x, y: y});
                                return {
                                    question: `Lire l'ordonn√©e correspondant √† l'abscisse ${x} :<br>${questionGraph}`,
                                    answer: `y = ${y}<br>${answerGraph}`
                                };
                            },
                            () => ({
                                question: "Comment interpr√©ter la pente d'une droite sur un graphique ?",
                                answer: "La pente repr√©sente le taux de variation (vitesse, coefficient de proportionnalit√©, etc.)"
                            }),
                            () => ({
                                question: "Comment identifier un maximum sur un graphique ?",
                                answer: "Le maximum est le point le plus haut de la courbe (ordonn√©e la plus grande)"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Calculer une image par une fonction",
                    generator: () => {
                        const ops = [
                            // Fonction lin√©aire
                            () => {
                                const a = randInt(2, 8);
                                const x = randInt(2, 10);
                                const y = a * x;
                                return {
                                    question: `La fonction f est d√©finie par f(x) = ${a}x. Calculer f(${x})`,
                                    answer: `f(${x}) = ${a} √ó ${x} = ${y}`
                                };
                            },
                            () => {
                                const a = randInt(-8, -2);
                                const x = randInt(2, 8);
                                const y = a * x;
                                return {
                                    question: `Pour f(x) = ${a}x, calculer l'image de ${x}`,
                                    answer: `f(${x}) = ${a} √ó ${x} = ${y}`
                                };
                            },
                            // Fonction affine
                            () => {
                                const a = randInt(2, 6);
                                const b = randInt(1, 10);
                                const x = randInt(2, 8);
                                const y = a * x + b;
                                return {
                                    question: `La fonction f est d√©finie par f(x) = ${a}x + ${b}. Calculer f(${x})`,
                                    answer: `f(${x}) = ${a} √ó ${x} + ${b} = ${a * x} + ${b} = ${y}`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(-10, -1);
                                const x = randInt(3, 10);
                                const y = a * x + b;
                                return {
                                    question: `Pour f(x) = ${a}x ${b}, calculer l'image de ${x}`,
                                    answer: `f(${x}) = ${a} √ó ${x} ${b} = ${a * x} ${b} = ${y}`
                                };
                            },
                            // Fonction constante
                            () => {
                                const b = randInt(1, 15);
                                const x = randInt(2, 20);
                                return {
                                    question: `La fonction f est d√©finie par f(x) = ${b}. Calculer f(${x})`,
                                    answer: `f(${x}) = ${b}<br><em>Une fonction constante donne toujours la m√™me valeur</em>`
                                };
                            },
                            // Avec notation f: x ‚Ü¶
                            () => {
                                const a = randInt(3, 7);
                                const b = randInt(2, 9);
                                const x = randInt(2, 8);
                                const y = a * x + b;
                                return {
                                    question: `Soit la fonction f : x ‚Ü¶ ${a}x + ${b}. Calculer f(${x})`,
                                    answer: `f(${x}) = ${a} √ó ${x} + ${b} = ${y}`
                                };
                            },
                            // Fonction au carr√©
                            () => {
                                const x = randInt(2, 8);
                                const y = x * x;
                                return {
                                    question: `Pour f(x) = x¬≤, calculer f(${x})`,
                                    answer: `f(${x}) = ${x}¬≤ = ${y}`
                                };
                            },
                            () => {
                                const a = randInt(2, 5);
                                const x = randInt(2, 6);
                                const y = a * x * x;
                                return {
                                    question: `Pour f(x) = ${a}x¬≤, calculer l'image de ${x}`,
                                    answer: `f(${x}) = ${a} √ó ${x}¬≤ = ${a} √ó ${x * x} = ${y}`
                                };
                            },
                            // Vocabulaire
                            () => {
                                const x = randInt(3, 10);
                                return {
                                    question: `Que repr√©sente f(${x}) dans la notation d'une fonction ?`,
                                    answer: `L'image de ${x} par la fonction f (la valeur de sortie quand on entre ${x})`
                                };
                            },
                            () => ({
                                question: "Comment calcule-t-on l'image d'un nombre par une fonction ?",
                                answer: "On remplace x par le nombre dans la formule de la fonction et on calcule"
                            })
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Calcul d'ant√©c√©dent",
                    generator: () => {
                        const ops = [
                            // Fonction lin√©aire simple
                            () => {
                                const a = randInt(2, 8);
                                const y = randInt(10, 40);
                                const x = y / a;
                                return {
                                    question: `Pour f(x) = ${a}x, quel nombre a pour image ${y} ?`,
                                    answer: `On cherche x tel que ${a}x = ${y}<br>x = ${y} √∑ ${a} = ${toFrenchNumber(x)}<br><em>L'ant√©c√©dent de ${y} est ${toFrenchNumber(x)}</em>`
                                };
                            },
                            () => {
                                const a = randInt(3, 7);
                                const x = randInt(2, 10);
                                const y = a * x;
                                return {
                                    question: `Soit f(x) = ${a}x. Trouver l'ant√©c√©dent de ${y}`,
                                    answer: `On r√©sout ${a}x = ${y}<br>x = ${y} √∑ ${a} = ${x}`
                                };
                            },
                            // Fonction affine simple
                            () => {
                                const a = randInt(2, 5);
                                const b = randInt(1, 8);
                                const x = randInt(3, 10);
                                const y = a * x + b;
                                return {
                                    question: `Pour f(x) = ${a}x + ${b}, quel nombre a pour image ${y} ?`,
                                    answer: `On r√©sout ${a}x + ${b} = ${y}<br>${a}x = ${y} - ${b} = ${y - b}<br>x = ${y - b} √∑ ${a} = ${x}`
                                };
                            },
                            () => {
                                const a = randInt(2, 4);
                                const b = randInt(2, 6);
                                const x = randInt(4, 12);
                                const y = a * x + b;
                                return {
                                    question: `Soit f(x) = ${a}x + ${b}. Trouver l'ant√©c√©dent de ${y}`,
                                    answer: `${a}x + ${b} = ${y}<br>${a}x = ${y - b}<br>x = ${toFrenchNumber((y - b) / a)}`
                                };
                            },
                            // Fonction constante (pas d'ant√©c√©dent ou tous les nombres)
                            () => {
                                const b = randInt(5, 15);
                                const wrongValue = randInt(1, 4);
                                return {
                                    question: `Pour f(x) = ${b}, quel est l'ant√©c√©dent de ${wrongValue} ?`,
                                    answer: `Il n'existe pas d'ant√©c√©dent<br><em>La fonction ne prend que la valeur ${b}, jamais ${wrongValue}</em>`
                                };
                            },
                            () => {
                                const b = randInt(5, 15);
                                return {
                                    question: `Pour f(x) = ${b}, quel est l'ant√©c√©dent de ${b} ?`,
                                    answer: `Tous les nombres r√©els<br><em>Chaque valeur de x donne f(x) = ${b}</em>`
                                };
                            },
                            // Vocabulaire
                            () => ({
                                question: "Qu'est-ce qu'un ant√©c√©dent ?",
                                answer: "Un ant√©c√©dent d'un nombre y est une valeur x telle que f(x) = y"
                            }),
                            () => ({
                                question: "Comment cherche-t-on un ant√©c√©dent de y par la fonction f ?",
                                answer: "On r√©sout l'√©quation f(x) = y"
                            }),
                            () => {
                                const y = randInt(10, 30);
                                return {
                                    question: `Si f(5) = ${y}, que peut-on dire de 5 et ${y} ?`,
                                    answer: `5 est un ant√©c√©dent de ${y}, et ${y} est l'image de 5`
                                };
                            },
                            // QCM
                            () => {
                                const a = randInt(3, 6);
                                const x = randInt(4, 8);
                                const y = a * x;
                                const wrong1 = y / 2;
                                const wrong2 = y - a;
                                const wrong3 = y + a;
                                return {
                                    question: `Pour f(x) = ${a}x, l'ant√©c√©dent de ${y} est :<br>
A. ${wrong1} &nbsp;&nbsp; B. ${x} &nbsp;&nbsp; C. ${wrong2} &nbsp;&nbsp; D. ${wrong3}`,
                                    answer: `B. ${x}<br>On r√©sout ${a}x = ${y}, donc x = ${y} √∑ ${a} = ${x}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                }
            ],

            "Algorithmique et programmation": [
                {
                    desc: "Variables et affectations",
                    generator: () => {
                        const ops = [
                            () => {
                                // Variable simple
                                const x = randInt(5, 15);
                                const scratchCode = `mettre [x v] √† (${x})`;
                                return {
                                    question: `Que vaut la variable x apr√®s l'ex√©cution de ce programme ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `x = ${x}`
                                };
                            },
                            () => {
                                // Addition √† une variable
                                const x = randInt(3, 8);
                                const add = randInt(3, 7);
                                const result = x + add;
                                const scratchCode = `mettre [x v] √† (${x})
ajouter (${add}) √† [x v]`;
                                return {
                                    question: `Que vaut la variable x √† la fin du programme ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `x = ${x} + ${add} = ${result}`
                                };
                            },
                            () => {
                                // Deux op√©rations successives
                                const x = randInt(2, 5);
                                const mult = randInt(2, 4);
                                const add = randInt(5, 10);
                                const result = x * mult + add;
                                // TEST : Essayer en fran√ßais pur
                                const scratchCode = `mettre [x v] √† (${x})
mettre [x v] √† ((x) * (${mult}))
ajouter (${add}) √† [x v]`;
                                return {
                                    question: `Quelle est la valeur finale de x ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `x = ${x} √ó ${mult} + ${add} = ${x * mult} + ${add} = ${result}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Conditions (Si...alors...sinon)",
                    generator: () => {
                        const ops = [
                            () => {
                                // Test simple
                                const x = randInt(5, 20);
                                const threshold = 10;
                                const result = x > threshold ? "Grand" : "Petit";
                                const scratchCode = `mettre [x v] √† (${x})
si <(x) > (10)> alors
  dire [Grand] pendant (2) secondes
sinon
  dire [Petit] pendant (2) secondes
fin`;
                                return {
                                    question: `Qu'affiche ce programme ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `Le programme affiche "${result}" car x = ${x} ${x > threshold ? '>' : '‚â§'} 10`
                                };
                            },
                            () => {
                                // Test pair/impair
                                const x = randInt(3, 15);
                                const isPair = x % 2 === 0;
                                const result = isPair ? "pair" : "impair";
                                const scratchCode = `mettre [x v] √† (${x})
si <((x) modulo (2)) = (0)> alors
  dire [pair] pendant (2) secondes
sinon
  dire [impair] pendant (2) secondes
fin`;
                                return {
                                    question: `Qu'affiche ce programme ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `Le programme affiche "${result}" car ${x} est ${result}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Programmes de calcul",
                    generator: () => {
                        const ops = [
                            // Programme tr√®s facile : juste multiplier
                            () => {
                                const x = randInt(3, 10);
                                const mult = randInt(2, 5);
                                const result = x * mult;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre</li><li>Multiplier par ${mult}</li></ul>Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `<ul style="margin: 10px 0; padding-left: 25px;"><li>Nombre choisi : ${x}</li><li>Multiplier par ${mult} : ${x} √ó ${mult} = ${result}</li></ul><strong>R√©sultat : ${result}</strong>`
                                };
                            },
                            // Programme tr√®s facile : juste ajouter
                            () => {
                                const x = randInt(3, 10);
                                const add = randInt(5, 15);
                                const result = x + add;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre</li><li>Ajouter ${add}</li></ul>Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `<ul style="margin: 10px 0; padding-left: 25px;"><li>Nombre choisi : ${x}</li><li>Ajouter ${add} : ${x} + ${add} = ${result}</li></ul><strong>R√©sultat : ${result}</strong>`
                                };
                            },
                            // Programme tr√®s facile : juste le carr√©
                            () => {
                                const x = randInt(2, 8);
                                const result = x * x;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre</li><li>√âlever au carr√©</li></ul>Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `<ul style="margin: 10px 0; padding-left: 25px;"><li>Nombre choisi : ${x}</li><li>√âlever au carr√© : ${x}¬≤ = ${result}</li></ul><strong>R√©sultat : ${result}</strong>`
                                };
                            },
                            // Programme simple : multiplier par a, ajouter b
                            () => {
                                const x = randInt(3, 10);
                                const mult = randInt(2, 5);
                                const add = randInt(3, 8);
                                const step1 = x * mult;
                                const result = step1 + add;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre</li><li>Multiplier par ${mult}</li><li>Ajouter ${add}</li></ul>Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `<ul style="margin: 10px 0; padding-left: 25px;"><li>Nombre choisi : ${x}</li><li>Multiplier par ${mult} : ${x} √ó ${mult} = ${step1}</li><li>Ajouter ${add} : ${step1} + ${add} = ${result}</li></ul><strong>R√©sultat : ${result}</strong>`
                                };
                            },
                            // Programme avec nombre de d√©part : multiplier par a, ajouter le nombre de d√©part
                            () => {
                                const x = randInt(3, 10);
                                const mult = randInt(2, 5);
                                const step1 = x * mult;
                                const result = step1 + x;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre</li><li>Multiplier par ${mult}</li><li>Ajouter le nombre de d√©part</li></ul>Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `<ul style="margin: 10px 0; padding-left: 25px;"><li>Nombre choisi : ${x}</li><li>Multiplier par ${mult} : ${x} √ó ${mult} = ${step1}</li><li>Ajouter le nombre de d√©part : ${step1} + ${x} = ${result}</li></ul><strong>R√©sultat : ${result}</strong>`
                                };
                            },
                            // Programme avec carr√© : multiplier par a, ajouter le carr√© du nombre
                            () => {
                                const x = randInt(2, 6);
                                const mult = randInt(2, 4);
                                const step1 = x * mult;
                                const step2 = x * x;
                                const result = step1 + step2;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre</li><li>Multiplier par ${mult}</li><li>Ajouter le carr√© du nombre de d√©part</li></ul>Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `<ul style="margin: 10px 0; padding-left: 25px;"><li>Nombre choisi : ${x}</li><li>Multiplier par ${mult} : ${x} √ó ${mult} = ${step1}</li><li>Carr√© du nombre de d√©part : ${x}¬≤ = ${step2}</li><li>Ajouter le carr√© : ${step1} + ${step2} = ${result}</li></ul><strong>R√©sultat : ${result}</strong>`
                                };
                            },
                            // Programme plus complexe : au carr√©, multiplier par a, soustraire le nombre de d√©part
                            () => {
                                const x = randInt(2, 6);
                                const mult = randInt(2, 4);
                                const step1 = x * x;
                                const step2 = step1 * mult;
                                const result = step2 - x;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre</li><li>√âlever au carr√©</li><li>Multiplier par ${mult}</li><li>Soustraire le nombre de d√©part</li></ul>Pour x = ${x}, quel est le r√©sultat ?`,
                                    answer: `<ul style="margin: 10px 0; padding-left: 25px;"><li>Nombre choisi : ${x}</li><li>√âlever au carr√© : ${x}¬≤ = ${step1}</li><li>Multiplier par ${mult} : ${step1} √ó ${mult} = ${step2}</li><li>Soustraire le nombre de d√©part : ${step2} - ${x} = ${result}</li></ul><strong>R√©sultat : ${result}</strong>`
                                };
                            },
                            // Expression litt√©rale : demander l'expression finale
                            () => {
                                const mult = randInt(2, 5);
                                const add = randInt(3, 8);
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre x</li><li>Multiplier par ${mult}</li><li>Ajouter ${add}</li></ul>Quelle est l'expression finale en fonction de x ?`,
                                    answer: `${mult}x + ${add}`
                                };
                            },
                            // Expression litt√©rale avec nombre de d√©part
                            () => {
                                const mult = randInt(2, 5);
                                const coef = mult + 1;
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre x</li><li>Multiplier par ${mult}</li><li>Ajouter le nombre de d√©part</li></ul>Quelle est l'expression finale en fonction de x ?`,
                                    answer: `${mult}x + x = ${coef}x`
                                };
                            },
                            // Expression litt√©rale avec carr√©
                            () => {
                                const mult = randInt(2, 4);
                                return {
                                    question: `Programme :<ul style="margin: 10px 0; padding-left: 25px;"><li>Choisir un nombre x</li><li>Multiplier par ${mult}</li><li>Ajouter le carr√© du nombre de d√©part</li></ul>Quelle est l'expression finale en fonction de x ?`,
                                    answer: `${mult}x + x<sup>2</sup>`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "Boucles et r√©p√©titions",
                    generator: () => {
                        const ops = [
                            () => {
                                // Boucle simple
                                const x = randInt(0, 3);
                                const repeat = randInt(4, 8);
                                const result = x + repeat;
                                const scratchCode = `mettre [x v] √† (${x})
r√©p√©ter (${repeat}) fois
  ajouter (1) √† [x v]
fin`;
                                return {
                                    question: `Quelle est la valeur finale de x ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `x = ${x} + ${repeat} = ${result}`
                                };
                            },
                            () => {
                                // Boucle avec multiplication
                                const x = randInt(1, 3);
                                const repeat = randInt(3, 6);
                                const add = randInt(2, 4);
                                const result = x + (repeat * add);
                                const scratchCode = `mettre [x v] √† (${x})
r√©p√©ter (${repeat}) fois
  ajouter (${add}) √† [x v]
fin`;
                                return {
                                    question: `Que vaut x √† la fin ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `x = ${x} + (${repeat} √ó ${add}) = ${x} + ${repeat * add} = ${result}`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                },
                {
                    desc: "G√©om√©trie avec Scratch",
                    generator: () => {
                        const ops = [
                            () => {
                                // Dessiner un carr√© - compl√©ter le programme
                                const cote = randInt(50, 150);
                                const scratchCode = `stylo en position d'√©criture
r√©p√©ter (4) fois
  avancer de (${cote}) pas
  tourner droite de (?) degr√©s
fin`;
                                return {
                                    question: `Compl√©ter ce programme Scratch pour dessiner un carr√© de c√¥t√© ${cote} :<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `90 degr√©s<br><em>Explication : Un carr√© a 4 angles droits de 90¬∞</em>`
                                };
                            },
                            () => {
                                // Dessiner un triangle √©quilat√©ral
                                const cote = randInt(60, 120);
                                const scratchCode = `stylo en position d'√©criture
r√©p√©ter (3) fois
  avancer de (${cote}) pas
  tourner droite de (?) degr√©s
fin`;
                                return {
                                    question: `Compl√©ter ce programme pour dessiner un triangle √©quilat√©ral :<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `120 degr√©s<br><em>Explication : Angle ext√©rieur = 360¬∞ √∑ 3 = 120¬∞</em>`
                                };
                            },
                            () => {
                                // Calculer l'angle pour un polygone r√©gulier
                                const nbCotes = randChoice([5, 6, 8, 10]);
                                const angle = 360 / nbCotes;
                                const noms = {5: "pentagone", 6: "hexagone", 8: "octogone", 10: "d√©cagone"};
                                return {
                                    question: `Pour dessiner un ${noms[nbCotes]} r√©gulier avec Scratch, de quel angle doit-on tourner √† chaque sommet ?`,
                                    answer: `360¬∞ √∑ ${nbCotes} = ${angle}¬∞`
                                };
                            },
                            () => {
                                // Calculer le p√©rim√®tre d'un carr√© avec Scratch
                                const cote = randInt(5, 15);
                                const perimetre = 4 * cote;
                                const scratchCode = `mettre [c√¥t√© v] √† (${cote})
mettre [p√©rim√®tre v] √† ((c√¥t√©) * (?))`;
                                return {
                                    question: `Compl√©ter ce programme qui calcule le p√©rim√®tre d'un carr√© :<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `4<br>P√©rim√®tre = ${cote} cm √ó 4 = ${perimetre} cm`
                                };
                            },
                            () => {
                                // Calculer l'aire d'un rectangle
                                const longueur = randInt(8, 15);
                                const largeur = randInt(4, 10);
                                const aire = longueur * largeur;
                                const scratchCode = `mettre [longueur v] √† (${longueur})
mettre [largeur v] √† (${largeur})
mettre [aire v] √† ((longueur) * (?))`;
                                return {
                                    question: `Compl√©ter ce programme qui calcule l'aire d'un rectangle :<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `largeur<br>Aire = ${longueur} cm √ó ${largeur} cm = ${aire} cm¬≤`
                                };
                            },
                            () => {
                                // Dessiner un hexagone - quel est l'angle ?
                                const cote = randInt(60, 100);
                                return {
                                    question: `Pour dessiner un hexagone r√©gulier (6 c√¥t√©s) de c√¥t√© ${cote} avec Scratch, quel angle de rotation faut-il utiliser ?`,
                                    answer: `360¬∞ √∑ 6 = 60¬∞`
                                };
                            },
                            () => {
                                // P√©rim√®tre d'un triangle √©quilat√©ral
                                const cote = randInt(6, 12);
                                const perimetre = 3 * cote;
                                const scratchCode = `mettre [c√¥t√© v] √† (${cote})
mettre [p√©rim√®tre v] √† ((c√¥t√©) * (3))
say (join [Le p√©rim√®tre est ] (join (p√©rim√®tre) [ cm]))`;
                                return {
                                    question: `Quelle valeur affichera ce programme ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `Le p√©rim√®tre est ${perimetre} cm<br>Calcul : ${cote} cm √ó 3 = ${perimetre} cm`
                                };
                            },
                            () => {
                                // Aire d'un carr√©
                                const cote = randInt(5, 12);
                                const aire = cote * cote;
                                const scratchCode = `mettre [c√¥t√© v] √† (${cote})
mettre [aire v] √† ((c√¥t√©) * (c√¥t√©))`;
                                return {
                                    question: `Quelle sera la valeur de la variable "aire" ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `${aire} cm¬≤<br>Aire = ${cote} cm √ó ${cote} cm = ${aire} cm¬≤`
                                };
                            },
                            () => {
                                // Dessiner une √©toile √† 5 branches
                                const scratchCode = `stylo en position d'√©criture
r√©p√©ter (5) fois
  avancer de (100) pas
  tourner droite de (?) degr√©s
fin`;
                                return {
                                    question: `Pour dessiner une √©toile √† 5 branches, on doit tourner de combien de degr√©s √† chaque pointe ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `144 degr√©s<br><em>Explication : Pour une √©toile √† 5 branches, on fait 2 tours complets : 720¬∞ √∑ 5 = 144¬∞</em>`
                                };
                            },
                            () => {
                                // P√©rim√®tre d'un rectangle
                                const longueur = randInt(10, 18);
                                const largeur = randInt(5, 9);
                                const perimetre = 2 * (longueur + largeur);
                                const scratchCode = `mettre [longueur v] √† (${longueur})
mettre [largeur v] √† (${largeur})
mettre [p√©rim√®tre v] √† (((longueur) + (largeur)) * (2))`;
                                return {
                                    question: `Quelle sera la valeur de "p√©rim√®tre" ?<br>${generateScratchBlocks(scratchCode)}`,
                                    answer: `${perimetre} cm<br>P√©rim√®tre = (${longueur} cm + ${largeur} cm) √ó 2 = ${longueur + largeur} cm √ó 2 = ${perimetre} cm`
                                };
                            }
                        ];
                        return randChoice(ops)();
                    }
                }
            ]
        };

        let questionsGenerated = 0;

        // Initialiser l'interface avec la structure hi√©rarchique
        function initThemes() {
            const grid = document.getElementById('themesGrid');
            let checkboxId = 0;
            
            // Parcourir chaque cat√©gorie principale
            Object.entries(themesHierarchie).forEach(([categorie, data]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'theme-category';
                
                // En-t√™te de cat√©gorie
                const headerHTML = `
                    <div class="theme-category-header" onclick="toggleCategory(this)">
                        <span class="theme-category-icon">${data.icon}</span>
                        <span class="theme-category-title">${categorie}</span>
                        <span class="theme-category-toggle">‚ñº</span>
                    </div>
                `;
                
                categoryDiv.innerHTML = headerHTML;
                
                // Container pour les sous-th√®mes
                const sousThemesContainer = document.createElement('div');
                sousThemesContainer.className = 'sous-themes-container';
                
                // Parcourir chaque sous-th√®me
                Object.entries(data.sousThemes).forEach(([sousTheme, descriptions]) => {
                    const sousThemeDiv = document.createElement('div');
                    sousThemeDiv.className = 'sous-theme-group';
                    
                    let sousThemeHTML = `<div class="sous-theme-title">${sousTheme}</div>`;
                    
                    // Ajouter chaque description (checkbox)
                    descriptions.forEach(desc => {
                        // V√©rifier si cette description existe dans automatismes
                        const exists = checkDescriptionExists(desc);
                        if (exists) {
                            sousThemeHTML += `
                                <div class="theme-checkbox">
                                    <input type="checkbox" id="theme${checkboxId}" value="${desc}" checked>
                                    <label for="theme${checkboxId}">${desc}</label>
                                </div>
                            `;
                            checkboxId++;
                        }
                    });
                    
                    sousThemeDiv.innerHTML = sousThemeHTML;
                    sousThemesContainer.appendChild(sousThemeDiv);
                });
                
                categoryDiv.appendChild(sousThemesContainer);
                grid.appendChild(categoryDiv);
            });
        }

        // V√©rifier si une description existe dans les automatismes
        function checkDescriptionExists(descToFind) {
            for (const theme in automatismes) {
                const found = automatismes[theme].find(auto => auto.desc === descToFind);
                if (found) return true;
            }
            return false;
        }

        // Fonction pour replier/d√©plier une cat√©gorie
        function toggleCategory(header) {
            const container = header.nextElementSibling;
            const toggle = header.querySelector('.theme-category-toggle');
            
            if (container.style.display === 'none') {
                container.style.display = 'grid';
                toggle.textContent = '‚ñº';
            } else {
                container.style.display = 'none';
                toggle.textContent = '‚ñ∂';
            }
        }

        function selectAllThemes() {
            document.querySelectorAll('.theme-checkbox input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
        }

        function deselectAllThemes() {
            document.querySelectorAll('.theme-checkbox input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
        }

        // Fonction helper pour normaliser le retour des g√©n√©rateurs
        // Retourne toujours un tableau de {question, answer}
        function normalizeGeneratorOutput(output) {
            if (typeof output === 'string') {
                // Ancien format : juste une question
                return [{ question: output, answer: "√Ä calculer" }];
            }
            // Si c'est d√©j√† un tableau de paires th√©orie-pratique, le retourner tel quel
            if (Array.isArray(output)) {
                return output;
            }
            // Format objet simple : le mettre dans un tableau
            return [output];
        }

        function generateQuestions() {
            const selectedDescriptions = Array.from(document.querySelectorAll('.theme-checkbox input[type="checkbox"]:checked'))
                .map(cb => cb.value);

            if (selectedDescriptions.length === 0) {
                alert('Veuillez s√©lectionner au moins un type de question !');
                return;
            }

            const count = parseInt(document.getElementById('questionCount').value) || 1;
            if (count < 1 || count > 50) {
                alert('Veuillez choisir un nombre de questions entre 1 et 50 !');
                return;
            }

            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            // Cr√©er un pool de g√©n√©rateurs bas√© sur les descriptions s√©lectionn√©es
            const generatorPool = [];
            for (const theme in automatismes) {
                automatismes[theme].forEach(auto => {
                    if (selectedDescriptions.includes(auto.desc)) {
                        generatorPool.push({
                            desc: auto.desc,
                            generator: auto.generator
                        });
                    }
                });
            }

            if (generatorPool.length === 0) {
                alert('Aucun g√©n√©rateur trouv√© pour les s√©lections !');
                return;
            }

            // Ensemble pour stocker les questions d√©j√† g√©n√©r√©es et √©viter les doublons
            const generatedQuestions = new Set();
            const maxAttempts = 1000; // Limite pour √©viter une boucle infinie
            let totalQuestionsAdded = 0;
            let questionNumber = 1;

            // G√©n√©rer jusqu'√† atteindre le nombre de questions demand√©
            while (totalQuestionsAdded < count) {
                let questionsArray = null;
                let attempts = 0;
                let selectedAuto = null;

                // G√©n√©rer une ou plusieurs questions uniques (paire th√©orie-pratique possible)
                do {
                    // Choisir un automatisme al√©atoire dans le pool
                    selectedAuto = generatorPool[Math.floor(Math.random() * generatorPool.length)];

                    // G√©n√©rer la ou les questions avec le g√©n√©rateur
                    const rawOutput = selectedAuto.generator();
                    questionsArray = normalizeGeneratorOutput(rawOutput);
                    attempts++;

                    // Si on a essay√© trop de fois, on sort de la boucle
                    if (attempts >= maxAttempts) {
                        console.warn('Nombre maximum de tentatives atteint pour g√©n√©rer une question unique');
                        break;
                    }

                    // V√©rifier qu'aucune des questions du tableau n'est un doublon
                    const hasNoDuplicate = questionsArray.every(q => !generatedQuestions.has(q.question));
                    if (hasNoDuplicate) break;
                } while (true);

                // Ajouter chaque question du tableau (peut √™tre 1 ou 2 questions)
                for (const questionData of questionsArray) {
                    // Ne pas d√©passer le nombre demand√©
                    if (totalQuestionsAdded >= count) break;

                    // Ajouter la question √† l'ensemble pour √©viter les doublons
                    generatedQuestions.add(questionData.question);

                    // Cr√©er l'√©l√©ment de question
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item';
                    questionDiv.innerHTML = `
                        <span class="question-number">Question ${questionNumber}</span>
                        <span class="theme-badge">${selectedAuto.desc}</span>
                        <div class="question-text">${questionData.question}</div>
                        <div class="answer-section">
                            <strong>‚úì Correction :</strong>
                            <div class="answer-text">${questionData.answer}</div>
                        </div>
                    `;
                    container.appendChild(questionDiv);

                    totalQuestionsAdded++;
                    questionNumber++;
                }
            }

            questionsGenerated = totalQuestionsAdded;

            // Afficher le conteneur et les stats
            container.classList.add('active');
            document.getElementById('statsSection').style.display = 'flex';
            document.getElementById('questionsCount').textContent = questionsGenerated;
            document.getElementById('printButtons').classList.add('active');

            // Rendre tous les blocs Scratch - EXACTEMENT comme dans scratch/4e/4-activite1-correction.html
            scratchblocks.renderMatching('pre.blocks', {
                languages: ['fr'],
                style: 'scratch3'
            });
        }

        function toggleAnswers() {
            document.querySelectorAll('.answer-section').forEach(section => {
                section.classList.toggle('visible');
            });
        }

        function printQuestions() {
            // Masquer les r√©ponses et retirer les espaces de correction
            document.querySelectorAll('.answer-section').forEach(el => el.classList.remove('visible', 'print-mode'));
            document.querySelectorAll('.correction-space').forEach(el => el.remove());
            window.print();
        }

        function printWithCorrection() {
            // Masquer les r√©ponses
            document.querySelectorAll('.answer-section').forEach(el => el.classList.remove('visible', 'print-mode'));
            // Retirer tous les espaces de correction existants
            document.querySelectorAll('.correction-space').forEach(el => el.remove());

            // Ajouter un espace de correction √† chaque question
            document.querySelectorAll('.question-item').forEach(questionItem => {
                const correctionSpace = document.createElement('div');
                correctionSpace.className = 'correction-space';
                questionItem.appendChild(correctionSpace);
            });

            // Lancer l'impression
            window.print();
        }

        function printAnswers() {
            // Retirer les espaces de correction
            document.querySelectorAll('.correction-space').forEach(el => el.remove());
            // Activer les r√©ponses pour l'impression
            document.querySelectorAll('.answer-section').forEach(el => {
                el.classList.remove('visible');
                el.classList.add('print-mode');
            });
            window.print();
            // Nettoyer apr√®s l'impression
            document.querySelectorAll('.answer-section').forEach(el => el.classList.remove('print-mode'));
        }

        function resetStats() {
            // Si le mode examen est actif, l'arr√™ter d'abord
            if (examModeActive) {
                stopExamMode();
            }

            questionsGenerated = 0;
            document.getElementById('questionsCount').textContent = '0';
            document.getElementById('questionsContainer').innerHTML = '';
            document.getElementById('questionsContainer').classList.remove('active');
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('printButtons').classList.remove('active');
            document.getElementById('questionCount').value = '1';
        }

        // Variables pour le mode examen
        let examTimerInterval = null;
        let examTimeRemaining = 0; // En secondes
        let examModeActive = false;

        function startExamMode() {
            if (examModeActive) {
                return;
            }

            // Demander confirmation
            const confirmed = confirm('Le mode examen blanc va g√©n√©rer 12 questions al√©atoires avec un chronom√®tre de 20 minutes.\n\nVoulez-vous commencer ?');
            if (!confirmed) {
                return;
            }

            // Activer le mode examen
            examModeActive = true;
            document.body.classList.add('exam-mode-active');

            // S√©lectionner tous les th√®mes
            selectAllThemes();

            // Configurer 12 questions
            document.getElementById('questionCount').value = '12';

            // G√©n√©rer les questions
            generateQuestions();

            // Cacher le bouton "Mode Examen" et afficher "Arr√™ter l'examen"
            document.getElementById('examButton').style.display = 'none';
            document.getElementById('stopExamButton').style.display = 'inline-block';

            // D√©marrer le chronom√®tre de 20 minutes
            examTimeRemaining = 20 * 60; // 20 minutes en secondes
            document.getElementById('examTimer').classList.add('active');
            updateTimerDisplay();

            examTimerInterval = setInterval(() => {
                examTimeRemaining--;
                updateTimerDisplay();

                // V√©rifier les seuils d'alerte
                if (examTimeRemaining === 5 * 60) {
                    // 5 minutes restantes
                    document.getElementById('examTimer').classList.add('warning');
                    alert('‚ö†Ô∏è Il vous reste 5 minutes !');
                } else if (examTimeRemaining === 1 * 60) {
                    // 1 minute restante
                    document.getElementById('examTimer').classList.remove('warning');
                    document.getElementById('examTimer').classList.add('critical');
                    alert('üö® Il vous reste 1 minute !');
                } else if (examTimeRemaining === 0) {
                    // Temps √©coul√©
                    clearInterval(examTimerInterval);
                    alert('‚è∞ Temps √©coul√© ! L\'examen est termin√©.');
                    stopExamMode();
                }
            }, 1000);
        }

        function stopExamMode() {
            // Arr√™ter le chronom√®tre
            if (examTimerInterval) {
                clearInterval(examTimerInterval);
                examTimerInterval = null;
            }

            // D√©sactiver le mode examen
            examModeActive = false;
            document.body.classList.remove('exam-mode-active');

            // Masquer le timer
            const timer = document.getElementById('examTimer');
            timer.classList.remove('active', 'warning', 'critical');

            // R√©afficher le bouton "Mode Examen" et masquer "Arr√™ter l'examen"
            document.getElementById('examButton').style.display = 'inline-block';
            document.getElementById('stopExamButton').style.display = 'none';

            // R√©initialiser le temps
            examTimeRemaining = 0;
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(examTimeRemaining / 60);
            const seconds = examTimeRemaining % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        // Initialiser au chargement
        window.onload = initThemes;
    </script>

    <!-- Indicateur de version pour v√©rifier le cache -->
    <div style="position: fixed; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 5px; font-size: 11px; z-index: 9999;">
        v2024-12-08-SOUS-THEMES-DNB
    </div>
</body>
</html>

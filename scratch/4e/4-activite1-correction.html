<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrections Scratch 4√®me - Figures g√©om√©triques</title>

    <!-- Scratchblocks CSS -->
    <link rel="stylesheet" href="../lib/scratchblocks.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #E5F0FF;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #40BF4A 0%, #0FBD8C 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
        }

        .correction-badge {
            background: rgba(255,255,255,0.3);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .exercise-nav {
            background: white;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            overflow-x: auto;
            align-items: center;
        }

        .exercise-nav span {
            font-weight: bold;
            color: #666;
            white-space: nowrap;
        }

        .exercise-btn {
            padding: 10px 20px;
            border: 2px solid #40BF4A;
            background: white;
            color: #40BF4A;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .exercise-btn:hover {
            background: #E8F5E9;
            transform: translateY(-2px);
        }

        .exercise-btn.active {
            background: #40BF4A;
            color: white;
            box-shadow: 0 4px 8px rgba(64, 191, 74, 0.4);
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 480px;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        .solution-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 25px;
        }

        .solution-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #40BF4A;
        }

        .solution-title h2 {
            color: #2E7D32;
            font-size: 24px;
        }

        .solution-title .check {
            font-size: 32px;
        }

        .explanation-box {
            background: #E8F5E9;
            border-left: 4px solid #40BF4A;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .explanation-box h3 {
            color: #2E7D32;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .explanation-box ul {
            margin: 10px 0;
            padding-left: 25px;
        }

        .explanation-box li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .scratch-blocks-container {
            background: #F9F9F9;
            border: 2px solid #D0D0D0;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .scratch-blocks-title {
            color: #4C97FF;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .canvas-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .canvas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .canvas-header h3 {
            color: #4C97FF;
            font-size: 20px;
        }

        .btn-run {
            background: #40BF4A;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-run:hover {
            background: #389438;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .stage-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        #canvas {
            border: 2px solid #D0D0D0;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .sprite {
            position: absolute;
            font-size: 30px;
            transform-origin: center;
            transition: all 0.05s linear;
            pointer-events: none;
        }

        .coords {
            position: absolute;
            bottom: 25px;
            right: 25px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 11px;
            color: #666;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .tip-box {
            background: #FFF9E6;
            border-left: 4px solid #FFD500;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .tip-box h4 {
            color: #CC9900;
            margin-bottom: 8px;
        }

        /* Style pour les blocs Scratchblocks */
        pre.blocks {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚úÖ Corrections Scratch 4√®me - Figures g√©om√©triques</h1>
        <div class="correction-badge">SOLUTIONS</div>
    </div>

    <div class="exercise-nav">
        <span>Exercices :</span>
        <button class="exercise-btn active" data-ex="1">1. Carr√©</button>
        <button class="exercise-btn" data-ex="2">2. Triangle</button>
        <button class="exercise-btn" data-ex="3">3. Rectangle</button>
        <button class="exercise-btn" data-ex="4">4. Hexagone</button>
        <button class="exercise-btn" data-ex="5">5. Polygone</button>
        <button class="exercise-btn" data-ex="6">6. Carr√©s embo√Æt√©s</button>
        <button class="exercise-btn" data-ex="7">7. √âtoile</button>
        <button class="exercise-btn" data-ex="8">8. Rosace</button>
        <button class="exercise-btn" data-ex="9">9. Spirale</button>
        <button class="exercise-btn" data-ex="10">10. Maison</button>
        <button class="exercise-btn" data-ex="11">11. Flocon</button>
        <button class="exercise-btn" data-ex="12">12. Cr√©atif</button>
    </div>

    <div class="main-container">
        <div class="solution-panel">
            <div class="solution-title">
                <span class="check">‚úÖ</span>
                <h2 id="exerciseTitle">Exercice 1 : Carr√©</h2>
            </div>

            <div class="explanation-box" id="explanation">
                <h3>üìê Explication math√©matique</h3>
                <ul>
                    <li>Un carr√© a <strong>4 c√¥t√©s √©gaux</strong></li>
                    <li>Angle de rotation : <strong>360¬∞ √∑ 4 = 90¬∞</strong></li>
                    <li>On r√©p√®te 4 fois : avancer de 100 pas, tourner de 90¬∞</li>
                </ul>
            </div>

            <div class="scratch-blocks-container">
                <div class="scratch-blocks-title">üß© Programme Scratch</div>
                <div id="scratchBlocks"></div>
            </div>

            <div class="tip-box" id="tipBox">
                <h4>üí° Astuce</h4>
                <p>N'oublie pas de mettre le bloc "stylo en position d'√©criture" avant la boucle, sinon le lutin ne dessinera rien !</p>
            </div>
        </div>

        <div class="canvas-panel">
            <div class="canvas-header">
                <h3>üñºÔ∏è R√©sultat</h3>
                <button class="btn-run" id="runBtn">‚ñ∂ Voir le r√©sultat</button>
            </div>
            <div class="stage-wrapper">
                <canvas id="canvas" width="400" height="400"></canvas>
                <div class="sprite" id="sprite">üê±</div>
                <div class="coords" id="coords">x: 0, y: 0</div>
            </div>
        </div>
    </div>

    <!-- Scratchblocks JS (local) -->
    <script src="../lib/scratchblocks.min.js"></script>
    <script src="../lib/translations-all.js"></script>

    <script>
        const exercises = {
            1: {
                title: "Exercice 1 : Carr√©",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Un carr√© a <strong>4 c√¥t√©s √©gaux</strong></li>
                        <li>Angle de rotation : <strong>360¬∞ √∑ 4 = 90¬∞</strong></li>
                        <li>On r√©p√®te 4 fois : avancer de 100 pas, tourner de 90¬∞</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
stylo en position d'√©criture
r√©p√©ter (4) fois
  avancer de (100) pas
  tourner droite de (90) degr√©s
fin`,
                tip: "N'oublie pas de mettre le bloc \"stylo en position d'√©criture\" avant la boucle, sinon le lutin ne dessinera rien !",
                draw: function(ctx, sprite, coords) {
                    drawPolygon(ctx, sprite, coords, 100, 90, 4);
                }
            },
            2: {
                title: "Exercice 2 : Triangle √©quilat√©ral",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Un triangle √©quilat√©ral a <strong>3 c√¥t√©s √©gaux</strong></li>
                        <li>Angle de rotation : <strong>360¬∞ √∑ 3 = 120¬∞</strong></li>
                        <li>On r√©p√®te 3 fois : avancer de 120 pas, tourner de 120¬∞</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
stylo en position d'√©criture
r√©p√©ter (3) fois
  avancer de (120) pas
  tourner droite de (120) degr√©s
fin`,
                tip: "Pour un triangle √©quilat√©ral, on tourne de 120¬∞ et non de 60¬∞ ! C'est l'angle ext√©rieur qui compte.",
                draw: function(ctx, sprite, coords) {
                    drawPolygon(ctx, sprite, coords, 120, 120, 3);
                }
            },
            3: {
                title: "Exercice 3 : Rectangle",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Un rectangle a <strong>2 longueurs et 2 largeurs</strong></li>
                        <li>Angle √† chaque coin : <strong>90¬∞</strong></li>
                        <li>On r√©p√®te 2 fois : longueur, tourner 90¬∞, largeur, tourner 90¬∞</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
stylo en position d'√©criture
r√©p√©ter (2) fois
  avancer de (150) pas
  tourner droite de (90) degr√©s
  avancer de (80) pas
  tourner droite de (90) degr√©s
fin`,
                tip: "On met 4 blocs dans la boucle \"r√©p√©ter 2 fois\" pour tracer les 2 paires de c√¥t√©s.",
                draw: function(ctx, sprite, coords) {
                    drawRectangle(ctx, sprite, coords);
                }
            },
            4: {
                title: "Exercice 4 : Hexagone r√©gulier",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Un hexagone a <strong>6 c√¥t√©s √©gaux</strong></li>
                        <li>Angle de rotation : <strong>360¬∞ √∑ 6 = 60¬∞</strong></li>
                        <li>On r√©p√®te 6 fois : avancer de 80 pas, tourner de 60¬∞</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
stylo en position d'√©criture
r√©p√©ter (6) fois
  avancer de (80) pas
  tourner droite de (60) degr√©s
fin`,
                tip: "Formule g√©n√©rale : Angle = 360¬∞ √∑ nombre de c√¥t√©s",
                draw: function(ctx, sprite, coords) {
                    drawPolygon(ctx, sprite, coords, 80, 60, 6);
                }
            },
            5: {
                title: "Exercice 5 : Polygone param√©tr√©",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>On utilise des <strong>variables</strong> pour rendre le programme flexible</li>
                        <li>Variable <strong>c√¥t√©s</strong> : nombre de c√¥t√©s du polygone</li>
                        <li>Variable <strong>longueur</strong> : longueur des c√¥t√©s</li>
                        <li>Variable <strong>angle</strong> : calcul√©e avec 360 √∑ c√¥t√©s</li>
                        <li>Exemple montr√© : pentagone (5 c√¥t√©s, 80 pas, 72¬∞)</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
demander [Combien de c√¥t√©s ?] et attendre
mettre [c√¥t√©s v] √† (r√©ponse)
demander [Quelle longueur ?] et attendre
mettre [longueur v] √† (r√©ponse)
mettre [angle v] √† ((360) / (c√¥t√©s))
stylo en position d'√©criture
r√©p√©ter (c√¥t√©s) fois
  avancer de (longueur) pas
  tourner droite de (angle) degr√©s
fin`,
                tip: "Avec des variables, un seul programme peut dessiner n'importe quel polygone !",
                draw: async function(ctx, sprite, coords) {
                    // Poser les questions comme dans Scratch
                    const cotes = prompt("Combien de c√¥t√©s ?") || "5";
                    const nbCotes = parseInt(cotes);

                    const longueur = prompt("Quelle longueur ?") || "80";
                    const longueurVal = parseInt(longueur);

                    const angle = 360 / nbCotes;

                    await drawPolygon(ctx, sprite, coords, longueurVal, angle, nbCotes);
                }
            },
            6: {
                title: "Exercice 6 : Carr√©s embo√Æt√©s",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Variable <strong>taille</strong> qui augmente √† chaque carr√©</li>
                        <li>Boucle ext√©rieure : <strong>4 carr√©s</strong></li>
                        <li>Boucle int√©rieure : <strong>dessiner un carr√©</strong></li>
                        <li>On revient au centre entre chaque carr√©</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
mettre [taille v] √† (50)
r√©p√©ter (4) fois
  stylo en position d'√©criture
  r√©p√©ter (4) fois
    avancer de (taille) pas
    tourner droite de (90) degr√©s
  fin
  ajouter (30) √† [taille v]
  relever le stylo
  aller √† x: (0) y: (0)
fin`,
                tip: "Boucles imbriqu√©es : une boucle DANS une autre boucle !",
                draw: function(ctx, sprite, coords) {
                    drawNestedSquares(ctx, sprite, coords);
                }
            },
            7: {
                title: "Exercice 7 : √âtoile √† 5 branches",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Pour une √©toile √† 5 branches, on <strong>saute un sommet</strong> √† chaque fois</li>
                        <li>On fait donc <strong>2 tours complets</strong> pour tracer l'√©toile</li>
                        <li>Formule : <strong>360¬∞ √ó 2 √∑ 5 = 144¬∞</strong></li>
                        <li>On r√©p√®te 5 fois : avancer de 100 pas, tourner de 144¬∞</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
stylo en position d'√©criture
r√©p√©ter (5) fois
  avancer de (100) pas
  tourner droite de (144) degr√©s
fin`,
                tip: "L'angle d'une √©toile est diff√©rent d'un polygone r√©gulier !",
                draw: function(ctx, sprite, coords) {
                    drawPolygon(ctx, sprite, coords, 100, 144, 5);
                }
            },
            8: {
                title: "Exercice 8 : Rosace de 12 carr√©s",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Boucle ext√©rieure : <strong>12 fois</strong> (nombre de carr√©s)</li>
                        <li>Boucle int√©rieure : <strong>4 fois</strong> (dessiner un carr√©)</li>
                        <li>On tourne de <strong>30¬∞</strong> entre chaque carr√© (360¬∞ √∑ 12)</li>
                        <li>Deux boucles imbriqu√©es cr√©ent ce beau motif !</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
stylo en position d'√©criture
r√©p√©ter (12) fois
  r√©p√©ter (4) fois
    avancer de (50) pas
    tourner droite de (90) degr√©s
  fin
  tourner droite de (30) degr√©s
fin`,
                tip: "C'est l'exercice le plus complexe avec deux boucles imbriqu√©es !",
                draw: function(ctx, sprite, coords) {
                    drawRosace(ctx, sprite, coords);
                }
            },
            9: {
                title: "Exercice 9 : Spirale carr√©e",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Une spirale augmente progressivement la <strong>distance parcourue</strong></li>
                        <li>On tourne de <strong>90¬∞</strong> √† chaque fois (angles droits)</li>
                        <li>Variable <strong>distance</strong> qui commence √† 10 et augmente de 5 √† chaque √©tape</li>
                        <li>S√©quence : 10 pas, puis 15 pas, puis 20 pas, puis 25 pas, etc.</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
mettre [distance v] √† (10)
stylo en position d'√©criture
r√©p√©ter (20) fois
  avancer de (distance) pas
  tourner droite de (90) degr√©s
  ajouter (5) √† [distance v]
fin`,
                tip: "La spirale se forme car on augmente la distance √† chaque it√©ration !",
                draw: function(ctx, sprite, coords) {
                    drawSpiral(ctx, sprite, coords);
                }
            },
            10: {
                title: "Exercice 10 : Maison",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Combinaison de plusieurs figures : <strong>carr√© + triangle</strong></li>
                        <li>Carr√© pour la base (100 pas de c√¥t√©)</li>
                        <li>Triangle √©quilat√©ral pour le toit (100 pas de c√¥t√©, angle 120¬∞)</li>
                        <li>Utilisation de <strong>aller √† x: y:</strong> pour se repositionner</li>
                        <li>Utilisation de <strong>relever le stylo</strong> pour se d√©placer sans tracer</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
stylo en position d'√©criture
r√©p√©ter (4) fois
  avancer de (100) pas
  tourner droite de (90) degr√©s
fin
relever le stylo
aller √† x: (0) y: (100)
s'orienter √† (90)
stylo en position d'√©criture
r√©p√©ter (3) fois
  avancer de (100) pas
  tourner droite de (120) degr√©s
fin`,
                tip: "Pense √† relever le stylo pour te d√©placer sans tracer !",
                draw: function(ctx, sprite, coords) {
                    drawHouse(ctx, sprite, coords);
                }
            },
            11: {
                title: "Exercice 11 : Flocon de neige",
                explanation: `
                    <h3>üìê Explication math√©matique</h3>
                    <ul>
                        <li>Un flocon a <strong>6 branches</strong> sym√©triques</li>
                        <li>Angle entre chaque branche : <strong>360¬∞ √∑ 6 = 60¬∞</strong></li>
                        <li>Pour chaque branche : avancer, reculer au centre, tourner</li>
                        <li>Utilisation de <strong>aller √† x: 0 y: 0</strong> pour revenir au centre</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
s'orienter √† (0)
r√©p√©ter (6) fois
  stylo en position d'√©criture
  avancer de (80) pas
  relever le stylo
  aller √† x: (0) y: (0)
  tourner droite de (60) degr√©s
fin`,
                tip: "Reviens au centre apr√®s chaque branche pour cr√©er la sym√©trie !",
                draw: function(ctx, sprite, coords) {
                    drawSnowflake(ctx, sprite, coords);
                }
            },
            12: {
                title: "Exercice 12 : Cr√©ation libre",
                explanation: `
                    <h3>üé® Explication</h3>
                    <ul>
                        <li>Cet exercice est <strong>libre et cr√©atif</strong> !</li>
                        <li>Utilise au moins <strong>2 boucles imbriqu√©es</strong></li>
                        <li>Utilise au moins <strong>1 variable</strong></li>
                        <li>Combine plusieurs polygones ou cr√©e des motifs r√©p√©t√©s</li>
                        <li>Exemple : une rosace d'√©toiles, un damier, etc.</li>
                    </ul>
                `,
                scratchCode: `quand @greenFlag est cliqu√©
effacer tout
mettre [taille v] √† (20)
stylo en position d'√©criture
r√©p√©ter (8) fois
  r√©p√©ter (6) fois
    avancer de (taille) pas
    tourner droite de (60) degr√©s
  fin
  ajouter (10) √† [taille v]
  tourner droite de (45) degr√©s
fin`,
                tip: "Laisse libre cours √† ton imagination pour cr√©er un motif unique !",
                draw: function(ctx, sprite, coords) {
                    drawFreeCreation(ctx, sprite, coords);
                }
            }
        };

        // Fonctions de dessin
        function clearCanvas(ctx) {
            ctx.clearRect(0, 0, 400, 400);
            // Grille
            ctx.strokeStyle = '#E0E0E0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 400; i += 40) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, 400);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(400, i);
                ctx.stroke();
            }
            // Axes
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(200, 0);
            ctx.lineTo(200, 400);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, 200);
            ctx.lineTo(400, 200);
            ctx.stroke();
        }

        async function drawPolygon(ctx, sprite, coords, length, angle, sides) {
            clearCanvas(ctx);
            let x = 0, y = 0, dir = 0;

            ctx.strokeStyle = '#4C97FF';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(200, 200);

            for (let i = 0; i < sides; i++) {
                await sleep(300);
                const rad = dir * Math.PI / 180;
                const newX = x + length * Math.cos(rad);
                const newY = y + length * Math.sin(rad);

                ctx.lineTo(200 + newX, 200 - newY);
                ctx.stroke();

                x = newX;
                y = newY;
                dir = (dir + angle) % 360;

                sprite.style.left = (200 + x - 15) + 'px';
                sprite.style.top = (200 - y - 15) + 'px';
                sprite.style.transform = `rotate(${dir}deg)`;
                coords.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;
            }
        }

        async function drawRectangle(ctx, sprite, coords) {
            clearCanvas(ctx);
            let x = 0, y = 0, dir = 0;
            const dimensions = [150, 80, 150, 80];

            ctx.strokeStyle = '#4C97FF';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(200, 200);

            for (let i = 0; i < 4; i++) {
                await sleep(300);
                const length = dimensions[i];
                const rad = dir * Math.PI / 180;
                const newX = x + length * Math.cos(rad);
                const newY = y + length * Math.sin(rad);

                ctx.lineTo(200 + newX, 200 - newY);
                ctx.stroke();

                x = newX;
                y = newY;
                dir = (dir + 90) % 360;

                sprite.style.left = (200 + x - 15) + 'px';
                sprite.style.top = (200 - y - 15) + 'px';
                sprite.style.transform = `rotate(${dir}deg)`;
                coords.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;
            }
        }

        async function drawNestedSquares(ctx, sprite, coords) {
            clearCanvas(ctx);
            let taille = 50;

            ctx.strokeStyle = '#4C97FF';
            ctx.lineWidth = 2;

            for (let s = 0; s < 4; s++) {
                let x = 0, y = 0, dir = 0;
                ctx.beginPath();
                ctx.moveTo(200, 200);

                for (let i = 0; i < 4; i++) {
                    await sleep(200);
                    const rad = dir * Math.PI / 180;
                    const newX = x + taille * Math.cos(rad);
                    const newY = y + taille * Math.sin(rad);

                    ctx.lineTo(200 + newX, 200 - newY);
                    ctx.stroke();

                    x = newX;
                    y = newY;
                    dir = (dir + 90) % 360;

                    sprite.style.left = (200 + x - 15) + 'px';
                    sprite.style.top = (200 - y - 15) + 'px';
                }
                taille += 30;
            }
        }

        async function drawRosace(ctx, sprite, coords) {
            clearCanvas(ctx);
            let globalDir = 0;

            ctx.strokeStyle = '#4C97FF';
            ctx.lineWidth = 2;

            for (let r = 0; r < 12; r++) {
                let x = 0, y = 0;
                let dir = globalDir;

                ctx.beginPath();
                ctx.moveTo(200, 200);

                for (let i = 0; i < 4; i++) {
                    await sleep(50);
                    const rad = dir * Math.PI / 180;
                    const newX = x + 50 * Math.cos(rad);
                    const newY = y + 50 * Math.sin(rad);

                    ctx.lineTo(200 + newX, 200 - newY);
                    ctx.stroke();

                    x = newX;
                    y = newY;
                    dir = (dir + 90) % 360;
                }

                globalDir += 30;
                sprite.style.transform = `rotate(${globalDir}deg)`;
            }
        }

        async function drawSpiral(ctx, sprite, coords) {
            clearCanvas(ctx);
            let x = 0, y = 0, dir = 0;
            let distance = 10;

            ctx.strokeStyle = '#0FBD8C';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(200, 200);

            for (let i = 0; i < 20; i++) {
                await sleep(150);
                const rad = dir * Math.PI / 180;
                const newX = x + distance * Math.cos(rad);
                const newY = y + distance * Math.sin(rad);

                ctx.lineTo(200 + newX, 200 - newY);
                ctx.stroke();

                x = newX;
                y = newY;
                dir = (dir + 90) % 360;
                distance += 5;

                sprite.style.left = (200 + x - 15) + 'px';
                sprite.style.top = (200 - y - 15) + 'px';
                sprite.style.transform = `rotate(${dir}deg)`;
                coords.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;
            }
        }

        async function drawHouse(ctx, sprite, coords) {
            clearCanvas(ctx);
            let x = 0, y = 0, dir = 0;

            ctx.strokeStyle = '#4C97FF';
            ctx.lineWidth = 3;

            // Dessiner le carr√© (base)
            ctx.beginPath();
            ctx.moveTo(200, 200);

            for (let i = 0; i < 4; i++) {
                await sleep(300);
                const rad = dir * Math.PI / 180;
                const newX = x + 100 * Math.cos(rad);
                const newY = y + 100 * Math.sin(rad);

                ctx.lineTo(200 + newX, 200 - newY);
                ctx.stroke();

                x = newX;
                y = newY;
                dir = (dir + 90) % 360;

                sprite.style.left = (200 + x - 15) + 'px';
                sprite.style.top = (200 - y - 15) + 'px';
                sprite.style.transform = `rotate(${dir}deg)`;
                coords.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;
            }

            // Relever le stylo et aller √† (0, 100)
            await sleep(300);
            x = 0;
            y = 100;
            sprite.style.left = (200 + x - 15) + 'px';
            sprite.style.top = (200 - y - 15) + 'px';
            coords.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;

            // S'orienter √† 90¬∞ (vers le haut)
            dir = 90;
            sprite.style.transform = `rotate(${dir}deg)`;

            // Dessiner le triangle (toit)
            await sleep(300);
            ctx.strokeStyle = '#FF6B35';
            ctx.beginPath();
            ctx.moveTo(200 + x, 200 - y);

            for (let i = 0; i < 3; i++) {
                await sleep(300);
                const rad = dir * Math.PI / 180;
                const newX = x + 100 * Math.cos(rad);
                const newY = y + 100 * Math.sin(rad);

                ctx.lineTo(200 + newX, 200 - newY);
                ctx.stroke();

                x = newX;
                y = newY;
                dir = (dir + 120) % 360;

                sprite.style.left = (200 + x - 15) + 'px';
                sprite.style.top = (200 - y - 15) + 'px';
                sprite.style.transform = `rotate(${dir}deg)`;
                coords.textContent = `x: ${Math.round(x)}, y: ${Math.round(y)}`;
            }
        }

        async function drawSnowflake(ctx, sprite, coords) {
            clearCanvas(ctx);

            ctx.strokeStyle = '#5CB1D6';
            ctx.lineWidth = 3;

            for (let i = 0; i < 6; i++) {
                const angle = (i * 60) * Math.PI / 180;
                const endX = 80 * Math.cos(angle);
                const endY = 80 * Math.sin(angle);

                ctx.beginPath();
                ctx.moveTo(200, 200);
                ctx.lineTo(200 + endX, 200 - endY);
                ctx.stroke();

                await sleep(200);

                sprite.style.left = (200 + endX - 15) + 'px';
                sprite.style.top = (200 - endY - 15) + 'px';
                sprite.style.transform = `rotate(${i * 60}deg)`;
            }

            coords.textContent = 'Flocon de neige !';
        }

        async function drawFreeCreation(ctx, sprite, coords) {
            clearCanvas(ctx);
            let taille = 20;
            let globalDir = 0;

            ctx.strokeStyle = '#9966FF';
            ctx.lineWidth = 2;

            for (let r = 0; r < 8; r++) {
                let x = 0, y = 0;
                let dir = globalDir;

                ctx.beginPath();
                ctx.moveTo(200, 200);

                // Dessiner un hexagone
                for (let i = 0; i < 6; i++) {
                    await sleep(30);
                    const rad = dir * Math.PI / 180;
                    const newX = x + taille * Math.cos(rad);
                    const newY = y + taille * Math.sin(rad);

                    ctx.lineTo(200 + newX, 200 - newY);
                    ctx.stroke();

                    x = newX;
                    y = newY;
                    dir = (dir + 60) % 360;
                }

                taille += 10;
                globalDir += 45;
                sprite.style.transform = `rotate(${globalDir}deg)`;
            }

            coords.textContent = 'Cr√©ation libre !';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Gestion de la navigation
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const sprite = document.getElementById('sprite');
        const coords = document.getElementById('coords');

        function loadExercise(num) {
            const ex = exercises[num];
            document.getElementById('exerciseTitle').textContent = ex.title;
            document.getElementById('explanation').innerHTML = ex.explanation;

            // Afficher les blocs Scratch avec scratchblocks
            const blocksContainer = document.getElementById('scratchBlocks');
            blocksContainer.innerHTML = `<pre class="blocks">${ex.scratchCode}</pre>`;
            scratchblocks.renderMatching('pre.blocks', {
                languages: ['fr'],
                style: 'scratch3'
            });

            document.getElementById('tipBox').innerHTML = `<h4>üí° Astuce</h4><p>${ex.tip}</p>`;
            clearCanvas(ctx);
            sprite.style.left = '185px';
            sprite.style.top = '185px';
            sprite.style.transform = 'rotate(0deg)';
            coords.textContent = 'x: 0, y: 0';
        }

        document.querySelectorAll('.exercise-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.exercise-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const exNum = parseInt(this.dataset.ex);
                loadExercise(exNum);
            });
        });

        document.getElementById('runBtn').addEventListener('click', async function() {
            const activeBtn = document.querySelector('.exercise-btn.active');
            const exNum = parseInt(activeBtn.dataset.ex);
            const ex = exercises[exNum];
            await ex.draw(ctx, sprite, coords);
        });

        // Initialisation
        clearCanvas(ctx);
        loadExercise(1);
    </script>
</body>
</html>

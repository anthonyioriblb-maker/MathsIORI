<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrections Scratch 4√®me - Interface Interactive</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #E5F0FF;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #40BF4A 0%, #0FBD8C 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-run {
            background: #40BF4A;
            color: white;
        }

        .btn-run:hover {
            background: #389438;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn-stop {
            background: #FF6B35;
            color: white;
        }

        .btn-stop:hover {
            background: #E55A2A;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn-clear {
            background: white;
            color: #40BF4A;
        }

        .btn-clear:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        .main-container {
            display: flex;
            height: calc(100vh - 70px);
        }

        .workspace-panel {
            flex: 1;
            background: white;
            position: relative;
            border-right: 2px solid #D0D0D0;
        }

        #blocklyDiv {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .stage-panel {
            width: 480px;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .stage-header {
            background: #F2F2F2;
            padding: 10px 15px;
            border-bottom: 1px solid #D0D0D0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stage-header h2 {
            font-size: 16px;
            color: #575E75;
        }

        .stage-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            padding: 20px;
        }

        #stage {
            border: 1px solid #D0D0D0;
            background: white;
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);
        }

        .exercise-info {
            background: #E6F7FF;
            border-top: 2px solid #4C97FF;
            padding: 15px;
            min-height: 150px;
            max-height: 250px;
            overflow-y: auto;
        }

        .exercise-info h3 {
            color: #2E5C8A;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .exercise-info p {
            font-size: 12px;
            color: #333;
            line-height: 1.4;
        }

        .exercise-info ul {
            margin: 8px 0;
            padding-left: 20px;
            font-size: 12px;
        }

        .exercise-info li {
            margin: 4px 0;
        }

        .sprite {
            position: absolute;
            width: 30px;
            height: 30px;
            font-size: 24px;
            transform-origin: center;
            transition: none;
        }

        .coordinates {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 10px;
            color: #888;
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
        }

        .exercise-selector {
            background: white;
            padding: 10px 15px;
            border-bottom: 1px solid #D0D0D0;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .exercise-btn {
            padding: 6px 12px;
            border: 2px solid #40BF4A;
            background: white;
            color: #40BF4A;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .exercise-btn:hover {
            background: #E8F5E9;
        }

        .exercise-btn.active {
            background: #40BF4A;
            color: white;
        }

        .correction-badge {
            background: #40BF4A;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <h1>‚úÖ Corrections Scratch 4√®me - Figures g√©om√©triques</h1>
            <span class="correction-badge">SOLUTIONS</span>
        </div>
        <div class="header-buttons">
            <button class="btn btn-run" id="runBtn">‚ñ∂ Ex√©cuter</button>
            <button class="btn btn-stop" id="stopBtn">‚èπ Stop</button>
            <button class="btn btn-clear" id="clearBtn">üóëÔ∏è Effacer</button>
        </div>
    </div>

    <div class="exercise-selector">
        <button class="exercise-btn active" data-exercise="1">Ex 1: Carr√©</button>
        <button class="exercise-btn" data-exercise="2">Ex 2: Triangle</button>
        <button class="exercise-btn" data-exercise="3">Ex 3: Rectangle</button>
        <button class="exercise-btn" data-exercise="4">Ex 4: Hexagone</button>
        <button class="exercise-btn" data-exercise="5">Ex 5: Polygone</button>
        <button class="exercise-btn" data-exercise="6">Ex 6: Carr√©s embo√Æt√©s</button>
        <button class="exercise-btn" data-exercise="7">Ex 7: √âtoile</button>
        <button class="exercise-btn" data-exercise="8">Ex 8: Rosace</button>
    </div>

    <div class="main-container">
        <div class="workspace-panel">
            <div id="blocklyDiv"></div>
        </div>

        <div class="stage-panel">
            <div class="stage-header">
                <h2>üñºÔ∏è R√©sultat</h2>
            </div>
            <div class="stage-container">
                <div style="position: relative;">
                    <canvas id="stage" width="360" height="360"></canvas>
                    <div class="sprite" id="sprite">üê±</div>
                    <div class="coordinates" id="coords">x: 0, y: 0</div>
                </div>
            </div>
            <div class="exercise-info" id="exerciseInfo">
                <h3>‚úÖ Solution Exercice 1 : Carr√©</h3>
                <p><strong>Explication :</strong></p>
                <ul>
                    <li>Un carr√© a 4 c√¥t√©s √©gaux</li>
                    <li>Angle de rotation : 360¬∞ √∑ 4 = 90¬∞</li>
                    <li>On r√©p√®te 4 fois : avancer de 100 pas, tourner de 90¬∞</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Configuration Blockly identique √† l'interface d'exercice
        const toolbox = {
            "kind": "categoryToolbox",
            "contents": [
                {
                    "kind": "category",
                    "name": "√âv√©nements",
                    "colour": "#FFD500",
                    "contents": [{"kind": "block", "type": "when_flag_clicked"}]
                },
                {
                    "kind": "category",
                    "name": "Mouvement",
                    "colour": "#4C97FF",
                    "contents": [
                        {"kind": "block", "type": "move_steps"},
                        {"kind": "block", "type": "turn_right"},
                        {"kind": "block", "type": "turn_left"},
                        {"kind": "block", "type": "goto_xy"}
                    ]
                },
                {
                    "kind": "category",
                    "name": "Stylo",
                    "colour": "#0FBD8C",
                    "contents": [
                        {"kind": "block", "type": "pen_down"},
                        {"kind": "block", "type": "pen_up"},
                        {"kind": "block", "type": "pen_clear"},
                        {"kind": "block", "type": "pen_color"},
                        {"kind": "block", "type": "pen_size"}
                    ]
                },
                {
                    "kind": "category",
                    "name": "Contr√¥le",
                    "colour": "#FFAB19",
                    "contents": [
                        {"kind": "block", "type": "repeat"},
                        {"kind": "block", "type": "wait"}
                    ]
                },
                {
                    "kind": "category",
                    "name": "Variables",
                    "colour": "#FF8C1A",
                    "contents": [
                        {"kind": "block", "type": "set_variable"},
                        {"kind": "block", "type": "change_variable"},
                        {"kind": "block", "type": "get_variable"}
                    ]
                },
                {
                    "kind": "category",
                    "name": "Op√©rateurs",
                    "colour": "#40BF4A",
                    "contents": [
                        {"kind": "block", "type": "math_number"},
                        {"kind": "block", "type": "math_arithmetic"}
                    ]
                },
                {
                    "kind": "category",
                    "name": "Capteurs",
                    "colour": "#4CBFE6",
                    "contents": [
                        {"kind": "block", "type": "ask_and_wait"},
                        {"kind": "block", "type": "answer"}
                    ]
                }
            ]
        };

        // D√©finition des blocs (identique)
        Blockly.Blocks['when_flag_clicked'] = {
            init: function() {
                this.appendDummyInput().appendField("quand ‚öë cliqu√©");
                this.setNextStatement(true, null);
                this.setColour("#FFD500");
            }
        };

        Blockly.Blocks['move_steps'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("avancer de")
                    .appendField(new Blockly.FieldNumber(100, 0), "STEPS")
                    .appendField("pas");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#4C97FF");
            }
        };

        Blockly.Blocks['turn_right'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("tourner ‚Üª de")
                    .appendField(new Blockly.FieldNumber(90, 0, 360), "DEGREES")
                    .appendField("degr√©s");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#4C97FF");
            }
        };

        Blockly.Blocks['turn_left'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("tourner ‚Ü∫ de")
                    .appendField(new Blockly.FieldNumber(90, 0, 360), "DEGREES")
                    .appendField("degr√©s");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#4C97FF");
            }
        };

        Blockly.Blocks['goto_xy'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("aller √† x:")
                    .appendField(new Blockly.FieldNumber(0, -180, 180), "X")
                    .appendField("y:")
                    .appendField(new Blockly.FieldNumber(0, -180, 180), "Y");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#4C97FF");
            }
        };

        Blockly.Blocks['pen_down'] = {
            init: function() {
                this.appendDummyInput().appendField("stylo en position d'√©criture");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#0FBD8C");
            }
        };

        Blockly.Blocks['pen_up'] = {
            init: function() {
                this.appendDummyInput().appendField("relever le stylo");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#0FBD8C");
            }
        };

        Blockly.Blocks['pen_clear'] = {
            init: function() {
                this.appendDummyInput().appendField("effacer tout");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#0FBD8C");
            }
        };

        Blockly.Blocks['pen_color'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("mettre la couleur du stylo √†")
                    .appendField(new Blockly.FieldColour("#ff0000"), "COLOR");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#0FBD8C");
            }
        };

        Blockly.Blocks['pen_size'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("mettre la taille du stylo √†")
                    .appendField(new Blockly.FieldNumber(2, 1, 20), "SIZE");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#0FBD8C");
            }
        };

        Blockly.Blocks['repeat'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("r√©p√©ter")
                    .appendField(new Blockly.FieldNumber(4, 1), "TIMES")
                    .appendField("fois");
                this.appendStatementInput("DO").setCheck(null);
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#FFAB19");
            }
        };

        Blockly.Blocks['wait'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("attendre")
                    .appendField(new Blockly.FieldNumber(0.1, 0), "SECONDS")
                    .appendField("secondes");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#FFAB19");
            }
        };

        Blockly.Blocks['set_variable'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("mettre")
                    .appendField(new Blockly.FieldTextInput("variable"), "VAR")
                    .appendField("√†")
                    .appendField(new Blockly.FieldNumber(0), "VALUE");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#FF8C1A");
            }
        };

        Blockly.Blocks['change_variable'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("ajouter √†")
                    .appendField(new Blockly.FieldTextInput("variable"), "VAR")
                    .appendField("la valeur")
                    .appendField(new Blockly.FieldNumber(1), "VALUE");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#FF8C1A");
            }
        };

        Blockly.Blocks['get_variable'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField(new Blockly.FieldTextInput("variable"), "VAR");
                this.setOutput(true, "Number");
                this.setColour("#FF8C1A");
            }
        };

        Blockly.Blocks['ask_and_wait'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("demander")
                    .appendField(new Blockly.FieldTextInput("Question ?"), "QUESTION")
                    .appendField("et attendre");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour("#4CBFE6");
            }
        };

        Blockly.Blocks['answer'] = {
            init: function() {
                this.appendDummyInput().appendField("r√©ponse");
                this.setOutput(true, null);
                this.setColour("#4CBFE6");
            }
        };

        // Initialisation de Blockly
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: toolbox,
            scrollbars: true,
            trashcan: true,
            zoom: {
                controls: true,
                wheel: true,
                startScale: 0.9,
                maxScale: 3,
                minScale: 0.3,
                scaleSpeed: 1.2
            },
            grid: {
                spacing: 20,
                length: 3,
                colour: '#ccc',
                snap: true
            }
        });

        // Solutions pour chaque exercice
        const solutions = {
            1: { // Carr√©
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="pen_down">
                                        <next>
                                            <block type="repeat">
                                                <field name="TIMES">4</field>
                                                <statement name="DO">
                                                    <block type="move_steps">
                                                        <field name="STEPS">100</field>
                                                        <next>
                                                            <block type="turn_right">
                                                                <field name="DEGREES">90</field>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 1 : Carr√©",
                    explanation: ["Un carr√© a 4 c√¥t√©s √©gaux", "Angle de rotation : 360¬∞ √∑ 4 = 90¬∞", "On r√©p√®te 4 fois : avancer de 100, tourner de 90¬∞"]
                }
            },
            2: { // Triangle
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="pen_down">
                                        <next>
                                            <block type="repeat">
                                                <field name="TIMES">3</field>
                                                <statement name="DO">
                                                    <block type="move_steps">
                                                        <field name="STEPS">120</field>
                                                        <next>
                                                            <block type="turn_right">
                                                                <field name="DEGREES">120</field>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 2 : Triangle √©quilat√©ral",
                    explanation: ["Un triangle √©quilat√©ral a 3 c√¥t√©s √©gaux", "Angle de rotation : 360¬∞ √∑ 3 = 120¬∞", "On r√©p√®te 3 fois : avancer de 120, tourner de 120¬∞"]
                }
            },
            3: { // Rectangle
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="pen_down">
                                        <next>
                                            <block type="repeat">
                                                <field name="TIMES">2</field>
                                                <statement name="DO">
                                                    <block type="move_steps">
                                                        <field name="STEPS">150</field>
                                                        <next>
                                                            <block type="turn_right">
                                                                <field name="DEGREES">90</field>
                                                                <next>
                                                                    <block type="move_steps">
                                                                        <field name="STEPS">80</field>
                                                                        <next>
                                                                            <block type="turn_right">
                                                                                <field name="DEGREES">90</field>
                                                                            </block>
                                                                        </next>
                                                                    </block>
                                                                </next>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 3 : Rectangle",
                    explanation: ["Un rectangle a 2 longueurs et 2 largeurs", "Angle : 90¬∞ √† chaque coin", "On r√©p√®te 2 fois : longueur 150, tourner 90¬∞, largeur 80, tourner 90¬∞"]
                }
            },
            4: { // Hexagone
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="pen_down">
                                        <next>
                                            <block type="repeat">
                                                <field name="TIMES">6</field>
                                                <statement name="DO">
                                                    <block type="move_steps">
                                                        <field name="STEPS">80</field>
                                                        <next>
                                                            <block type="turn_right">
                                                                <field name="DEGREES">60</field>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 4 : Hexagone",
                    explanation: ["Un hexagone a 6 c√¥t√©s √©gaux", "Angle de rotation : 360¬∞ √∑ 6 = 60¬∞", "On r√©p√®te 6 fois : avancer de 80, tourner de 60¬∞"]
                }
            },
            5: { // Polygone param√©tr√© (pentagone comme exemple)
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="ask_and_wait">
                                        <field name="QUESTION">Combien de c√¥t√©s ?</field>
                                        <next>
                                            <block type="set_variable">
                                                <field name="VAR">c√¥t√©s</field>
                                                <field name="VALUE">5</field>
                                                <next>
                                                    <block type="ask_and_wait">
                                                        <field name="QUESTION">Quelle longueur ?</field>
                                                        <next>
                                                            <block type="set_variable">
                                                                <field name="VAR">longueur</field>
                                                                <field name="VALUE">80</field>
                                                                <next>
                                                                    <block type="set_variable">
                                                                        <field name="VAR">angle</field>
                                                                        <field name="VALUE">72</field>
                                                                        <next>
                                                                            <block type="pen_down">
                                                                                <next>
                                                                                    <block type="repeat">
                                                                                        <field name="TIMES">5</field>
                                                                                        <statement name="DO">
                                                                                            <block type="move_steps">
                                                                                                <field name="STEPS">80</field>
                                                                                                <next>
                                                                                                    <block type="turn_right">
                                                                                                        <field name="DEGREES">72</field>
                                                                                                    </block>
                                                                                                </next>
                                                                                            </block>
                                                                                        </statement>
                                                                                    </block>
                                                                                </next>
                                                                            </block>
                                                                        </next>
                                                                    </block>
                                                                </next>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </next>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 5 : Polygone param√©tr√©",
                    explanation: ["On cr√©e 3 variables : c√¥t√©s, longueur, angle", "On demande le nombre de c√¥t√©s et la longueur", "On calcule l'angle : 360 √∑ c√¥t√©s", "Exemple montr√© : pentagone (5 c√¥t√©s, angle 72¬∞)"]
                }
            },
            6: { // Carr√©s embo√Æt√©s
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="set_variable">
                                        <field name="VAR">taille</field>
                                        <field name="VALUE">50</field>
                                        <next>
                                            <block type="repeat">
                                                <field name="TIMES">4</field>
                                                <statement name="DO">
                                                    <block type="pen_down">
                                                        <next>
                                                            <block type="repeat">
                                                                <field name="TIMES">4</field>
                                                                <statement name="DO">
                                                                    <block type="move_steps">
                                                                        <field name="STEPS">50</field>
                                                                        <next>
                                                                            <block type="turn_right">
                                                                                <field name="DEGREES">90</field>
                                                                            </block>
                                                                        </next>
                                                                    </block>
                                                                </statement>
                                                                <next>
                                                                    <block type="pen_up">
                                                                        <next>
                                                                            <block type="goto_xy">
                                                                                <field name="X">0</field>
                                                                                <field name="Y">0</field>
                                                                                <next>
                                                                                    <block type="change_variable">
                                                                                        <field name="VAR">taille</field>
                                                                                        <field name="VALUE">30</field>
                                                                                    </block>
                                                                                </next>
                                                                            </block>
                                                                        </next>
                                                                    </block>
                                                                </next>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 6 : Carr√©s embo√Æt√©s",
                    explanation: ["Variable taille = 50", "R√©p√©ter 4 fois : dessiner carr√©, ajouter 30 √† taille", "Revenir au centre (0,0) entre chaque carr√©", "Boucles imbriqu√©es : boucle externe (4) et interne (4 pour le carr√©)"]
                }
            },
            7: { // √âtoile
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="pen_down">
                                        <next>
                                            <block type="repeat">
                                                <field name="TIMES">5</field>
                                                <statement name="DO">
                                                    <block type="move_steps">
                                                        <field name="STEPS">100</field>
                                                        <next>
                                                            <block type="turn_right">
                                                                <field name="DEGREES">144</field>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 7 : √âtoile √† 5 branches",
                    explanation: ["Pour une √©toile, on ne tourne pas de 72¬∞ mais de 144¬∞", "Formule : 360¬∞ √ó 2 √∑ 5 = 144¬∞", "On r√©p√®te 5 fois : avancer de 100, tourner de 144¬∞"]
                }
            },
            8: { // Rosace
                xml: `<xml>
                    <block type="when_flag_clicked" x="20" y="20">
                        <next>
                            <block type="pen_clear">
                                <next>
                                    <block type="pen_down">
                                        <next>
                                            <block type="repeat">
                                                <field name="TIMES">12</field>
                                                <statement name="DO">
                                                    <block type="repeat">
                                                        <field name="TIMES">4</field>
                                                        <statement name="DO">
                                                            <block type="move_steps">
                                                                <field name="STEPS">50</field>
                                                                <next>
                                                                    <block type="turn_right">
                                                                        <field name="DEGREES">90</field>
                                                                    </block>
                                                                </next>
                                                            </block>
                                                        </statement>
                                                        <next>
                                                            <block type="turn_right">
                                                                <field name="DEGREES">30</field>
                                                            </block>
                                                        </next>
                                                    </block>
                                                </statement>
                                            </block>
                                        </next>
                                    </block>
                                </next>
                            </block>
                        </next>
                    </block>
                </xml>`,
                info: {
                    title: "‚úÖ Solution Exercice 8 : Rosace de 12 carr√©s",
                    explanation: ["Boucle ext√©rieure : 12 fois (nombre de carr√©s)", "Boucle int√©rieure : 4 fois (dessiner un carr√©)", "Tourner de 30¬∞ entre chaque carr√© (360¬∞ √∑ 12)", "Deux boucles imbriqu√©es !"]
                }
            }
        };

        // Moteur d'ex√©cution (identique √† l'interface d'exercice)
        const canvas = document.getElementById('stage');
        const ctx = canvas.getContext('2d');
        const sprite = document.getElementById('sprite');
        const coords = document.getElementById('coords');

        let turtle = { x: 0, y: 0, angle: 0, penDown: false, penColor: '#000000', penSize: 2 };
        let variables = {};
        let lastAnswer = '';
        let isRunning = false;

        function resetTurtle() {
            turtle = { x: 0, y: 0, angle: 0, penDown: false, penColor: '#000000', penSize: 2 };
            variables = {};
            updateSprite();
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#E0E0E0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= canvas.width; i += 30) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i <= canvas.height; i += 30) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
        }

        function toCanvasX(x) { return canvas.width / 2 + x; }
        function toCanvasY(y) { return canvas.height / 2 - y; }

        function updateSprite() {
            sprite.style.left = (toCanvasX(turtle.x) - 15) + 'px';
            sprite.style.top = (toCanvasY(turtle.y) - 15) + 'px';
            sprite.style.transform = `rotate(${turtle.angle}deg)`;
            coords.textContent = `x: ${Math.round(turtle.x)}, y: ${Math.round(turtle.y)}`;
        }

        async function executeBlock(block) {
            if (!block || !isRunning) return;
            const type = block.type;

            switch(type) {
                case 'when_flag_clicked':
                    break;
                case 'move_steps':
                    const steps = block.getFieldValue('STEPS');
                    const rad = (turtle.angle - 90) * Math.PI / 180;
                    const newX = turtle.x + steps * Math.cos(rad);
                    const newY = turtle.y + steps * Math.sin(rad);
                    if (turtle.penDown) {
                        ctx.strokeStyle = turtle.penColor;
                        ctx.lineWidth = turtle.penSize;
                        ctx.beginPath();
                        ctx.moveTo(toCanvasX(turtle.x), toCanvasY(turtle.y));
                        ctx.lineTo(toCanvasX(newX), toCanvasY(newY));
                        ctx.stroke();
                    }
                    turtle.x = newX;
                    turtle.y = newY;
                    updateSprite();
                    break;
                case 'turn_right':
                    turtle.angle = (turtle.angle + parseFloat(block.getFieldValue('DEGREES'))) % 360;
                    updateSprite();
                    break;
                case 'turn_left':
                    turtle.angle = (turtle.angle - parseFloat(block.getFieldValue('DEGREES')) + 360) % 360;
                    updateSprite();
                    break;
                case 'goto_xy':
                    turtle.x = parseFloat(block.getFieldValue('X'));
                    turtle.y = parseFloat(block.getFieldValue('Y'));
                    updateSprite();
                    break;
                case 'pen_down':
                    turtle.penDown = true;
                    break;
                case 'pen_up':
                    turtle.penDown = false;
                    break;
                case 'pen_clear':
                    clearCanvas();
                    break;
                case 'pen_color':
                    turtle.penColor = block.getFieldValue('COLOR');
                    break;
                case 'pen_size':
                    turtle.penSize = parseFloat(block.getFieldValue('SIZE'));
                    break;
                case 'repeat':
                    const times = parseInt(block.getFieldValue('TIMES'));
                    const doBlock = block.getInputTargetBlock('DO');
                    for (let i = 0; i < times && isRunning; i++) {
                        await executeBlock(doBlock);
                    }
                    break;
                case 'wait':
                    const seconds = parseFloat(block.getFieldValue('SECONDS'));
                    await new Promise(resolve => setTimeout(resolve, seconds * 1000));
                    break;
                case 'set_variable':
                    const varName = block.getFieldValue('VAR');
                    const value = parseFloat(block.getFieldValue('VALUE'));
                    variables[varName] = value;
                    break;
                case 'change_variable':
                    const changeVar = block.getFieldValue('VAR');
                    const changeValue = parseFloat(block.getFieldValue('VALUE'));
                    variables[changeVar] = (variables[changeVar] || 0) + changeValue;
                    break;
                case 'ask_and_wait':
                    const question = block.getFieldValue('QUESTION');
                    lastAnswer = prompt(question) || '';
                    break;
            }

            const nextBlock = block.getNextBlock();
            if (nextBlock && isRunning) {
                await executeBlock(nextBlock);
            }
        }

        async function runCode() {
            if (isRunning) return;
            isRunning = true;
            resetTurtle();
            clearCanvas();

            const topBlocks = workspace.getTopBlocks(false);
            const startBlock = topBlocks.find(block => block.type === 'when_flag_clicked');

            if (startBlock) {
                const firstBlock = startBlock.getNextBlock();
                if (firstBlock) {
                    await executeBlock(firstBlock);
                }
            } else {
                alert('Le bloc "quand ‚öë cliqu√©" est n√©cessaire pour d√©marrer !');
            }

            isRunning = false;
        }

        function stopCode() {
            isRunning = false;
        }

        // Charger une solution
        function loadSolution(exerciseNum) {
            workspace.clear();
            const solution = solutions[exerciseNum];
            if (solution && solution.xml) {
                const xml = Blockly.utils.xml.textToDom(solution.xml);
                Blockly.Xml.domToWorkspace(xml, workspace);

                const info = solution.info;
                document.getElementById('exerciseInfo').innerHTML = `
                    <h3>${info.title}</h3>
                    <p><strong>Explication :</strong></p>
                    <ul>
                        ${info.explanation.map(exp => `<li>${exp}</li>`).join('')}
                    </ul>
                `;
            }
        }

        // √âv√©nements
        document.getElementById('runBtn').addEventListener('click', runCode);
        document.getElementById('stopBtn').addEventListener('click', stopCode);
        document.getElementById('clearBtn').addEventListener('click', () => {
            clearCanvas();
            resetTurtle();
        });

        document.querySelectorAll('.exercise-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.exercise-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const exNum = parseInt(this.dataset.exercise);
                loadSolution(exNum);
            });
        });

        // Initialisation
        clearCanvas();
        resetTurtle();
        loadSolution(1); // Charger le carr√© par d√©faut
    </script>
</body>
</html>
